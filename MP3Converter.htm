<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>MP3 Converter</title>
    <link
      rel="icon"
      sizes="16x16"
      type="image/png"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABe0lEQVR4AYSQzUrDQBSFb/IMir+Fdt2N2CpVKCZ7BXHRnRufQH0Bp0s36ju40637RBQttBbfQMH6hz6D8X6DM01oi2FO5t5zzzmZTChjnvq+ieqHxtQOTMJuodwYqRQCMGLKAkmyTI7UELFbKMcMjfJ++QC+glEnkWLSitCgdQIbQCpfcWR+n5meyre2RouHxgZoKselL2Cc2QmcJ/xLGjl2Y3lJFudmPZwxt0d4Q73GEXNzteaNLmR3Z0sqpYWcX8tQIvsLWkq1XJLNZkP2WttSXpyH8iCEJl5bsZpWvE4rehcbIS+6aqVkQ6j/w0VyZyVBINdhoC86yOPzS0nuu/I8eIPyGLx/yG23b2dXNx3PU4TyI6nknqeXVwGYoNk7/UfLwcN5qDfsnRkCgOedCSO1HxSLFK+9xCCTdnE27D6/vodNrnIeG0CS3sVIyERzIG085NkAit6JMZoaa134He3zK0WD1pE+AILUh1MTI+JEQPmUHY4ZGuX8+gUAAP//nWsyYwAAAAZJREFUAwBiyKO+EQLivwAAAABJRU5ErkJggg=="
    >
    <meta name="theme-color" content="#000">
    <meta name="keywords" content="mp3, file, converter">
    <meta name="description" content="MP3 Converter.">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    >
    <style>
      * {
        font-family: Arial;
        font-size: 16px;
        box-sizing: border-box;
      }
      body {
        max-width: 600px;
        margin: 0 auto;
        padding: 40px 20px;
        background: #000;
      }
      .container {
        display: none;
      }
      .title {
        font-size: 30px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 20px;
      }
      .wrapper {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      label {
        display: inline-block;
        margin-top:10px;
        margin-bottom: 10px;
      }
      input[type="file"] {
        width: 100%;
        padding: 10px;
        border: 2px dashed #ccc;
        border-radius: 5px;
        cursor: pointer;
      }
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background: white;
      }
      button {
        width: 100%;
        margin-top: 15px;
        padding: 15px;
        background: #3a76b1;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:disabled {
        background: #ccc;
        cursor: default;
      }
      #downloadLink {
        display: none;
        text-align: center;
      }
      #downloadLink a {
        display: inline-block;
        margin-top:20px;
        padding: 15px 30px;
        background: #3a76b1;
        color: white;
        text-decoration: none;
        border-radius: 5px;
      }
      #progress {
        display: none;
        margin-top: 20px;
      }
      #progressBar {
        width: 100%;
        height: 20px;
        background: #e9ecef;
        border-radius: 10px;
        overflow: hidden;
      }
      #progressFill {
        height: 100%;
        background: #1e7e34;
        width: 0%;
        transition: width 0.3s;
      }
      #progressText {
        margin-top: 20px;
        text-align: center;
      }
      #fileList {
        margin-top: 15px;
        margin-bottom: 10px;
        display: none;
      }
      .file-item {
        padding: 5px 8px;
        background: #f5f5f5;
        border-radius: 4px;
        margin-bottom: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .file-item.completed {
        background: #d4edda;
        color: #155724;
      }
      .file-item.processing {
        background: #e7f3ff;
        color: #0056b3;
      }
      .file-item.error {
        background: #f8d7da;
        color: #721c24;
      }
      #conversionStatus {
        display: none;
        color: #000;
        font-size: 25px;
        font-weight: bold;
        margin-bottom: 15px;
        text-align: center;
      }
      .pleasewait{position:fixed;width:64px;height:64px;left:0;right:0;top:0;bottom:0;margin:auto auto;border:0}
      .lds-spinner{color:#fff;display:inline-block;position:relative;width:64px;height:64px}
      .lds-spinner div{transform-origin:32px 32px;animation:lds-spinner 1.2s linear infinite}
      .lds-spinner div:after{content:" ";display:block;position:absolute;top:3px;left:29px;width:5px;height:14px;border-radius:20%;background:#fff}
      .lds-spinner div:nth-child(1){transform:rotate(0deg);animation-delay:-1.1s}
      .lds-spinner div:nth-child(2){transform:rotate(30deg);animation-delay:-1s}
      .lds-spinner div:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}
      .lds-spinner div:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}
      .lds-spinner div:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}
      .lds-spinner div:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}
      .lds-spinner div:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}
      .lds-spinner div:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}
      .lds-spinner div:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}
      .lds-spinner div:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}
      .lds-spinner div:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}
      .lds-spinner div:nth-child(12){transform:rotate(330deg);animation-delay:0s}
      @keyframes lds-spinner{0%{opacity:1}to{opacity:0}}
    </style>
  </head>
  <body>
    <div class="pleasewait">
      <div class="lds-spinner">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div class="container">
      <div class="title"></div>
      <div class="wrapper">
        <div id="conversionStatus"></div>
        <div class="form-group" id="audioFileGroup">
          <label for="audioFile">&nbsp;</label>
          <input
            type="file"
            id="audioFile"
            accept=".wav,.mp3,audio/wav,audio/mpeg"
            multiple
          >
        </div>
        <div id="fileList"></div>
        <div class="form-group" id="bitrateGroup">
          <label for="bitrate">&nbsp;</label>
          <select id="bitrate">
            <option value="8">8 kbps</option>
            <option value="16">16 kbps</option>
            <option value="24">24 kbps</option>
            <option value="32">32 kbps</option>
            <option value="48">48 kbps</option>
            <option value="64">64 kbps</option>
            <option value="96">96 kbps</option>
            <option value="128" selected>128 kbps</option>
            <option value="160">160 kbps</option>
            <option value="192">192 kbps</option>
            <option value="224">224 kbps</option>
            <option value="256">256 kbps</option>
            <option value="320">320 kbps</option>
          </select>
        </div>
        <button id="convertBtn" disabled></button>
        <div id="progress">
          <div id="progressBar">
            <div id="progressFill"></div>
          </div>
          <div id="progressText"></div>
        </div>
        <div id="downloadLink"></div>
      </div>
    </div>
    <script>
      // lame.min.js
      // prettier-ignore
      // eslint-disable-next-line
      !function () {var e = { browser: "undefined" != typeof window, node: "undefined" != typeof window ? {} : global, process: "undefined" != typeof process ? process : {}, window: "undefined" != typeof window ? window : global, document: "undefined" != typeof document ? document : {} };function c() {function U0(e) {return new Int32Array(e);}function W0(e) {return new Float32Array(e);}function J0(e) {if (1 == e.length) return W0(e[0]);var t = e[0];e = e.slice(1);for (var a = [], s = 0; s < t; s++) a.push(J0(e));return a;}function M(e) {if (1 == e.length) return U0(e[0]);var t = e[0];e = e.slice(1);for (var a = [], s = 0; s < t; s++) a.push(M(e));return a;}function w(e) {if (1 == e.length) return Array(e[0]);var t = e[0];e = e.slice(1);for (var a = [], s = 0; s < t; s++) a.push(w(e));return a;}function $0(e) {this.ordinal = e;}function m0(e) {this.ordinal = e;}function ee(e) {this.ordinal = function () {return e;};}function R() {this.getLameVersion = function () {return "3.98.4";}, this.getLameShortVersion = function () {return "3.98.4";}, this.getLameVeryShortVersion = function () {return "LAME3.98r";}, this.getPsyVersion = function () {return "0.93";}, this.getLameUrl = function () {return "http://www.mp3dev.org/";}, this.getLameOsBitness = function () {return "32bits";};}function r1() {function u(e, t, a, s, n, _) {for (; 0 != n--;) a[s] = 1e-10 + e[t + 0] * _[0] - a[s - 1] * _[1] + e[t - 1] * _[2] - a[s - 2] * _[3] + e[t - 2] * _[4] - a[s - 3] * _[5] + e[t - 3] * _[6] - a[s - 4] * _[7] + e[t - 4] * _[8] - a[s - 5] * _[9] + e[t - 5] * _[10] - a[s - 6] * _[11] + e[t - 6] * _[12] - a[s - 7] * _[13] + e[t - 7] * _[14] - a[s - 8] * _[15] + e[t - 8] * _[16] - a[s - 9] * _[17] + e[t - 9] * _[18] - a[s - 10] * _[19] + e[t - 10] * _[20], ++s, ++t;}function p(e, t, a, s, n, _) {for (; 0 != n--;) a[s] = e[t + 0] * _[0] - a[s - 1] * _[1] + e[t - 1] * _[2] - a[s - 2] * _[3] + e[t - 2] * _[4], ++s, ++t;}function m(e) {return e * e;}var s = r1.RMS_WINDOW_TIME_NUMERATOR,n = r1.RMS_WINDOW_TIME_DENOMINATOR,d = [[.038575994352, -3.84664617118067, -.02160367184185, 7.81501653005538, -.00123395316851, -11.34170355132042, -9291677959e-14, 13.05504219327545, -.01655260341619, -12.28759895145294, .02161526843274, 9.4829380631979, -.02074045215285, -5.87257861775999, .00594298065125, 2.75465861874613, .00306428023191, -.86984376593551, .00012025322027, .13919314567432, .00288463683916], [.0541865640643, -3.47845948550071, -.02911007808948, 6.36317777566148, -.00848709379851, -8.54751527471874, -.00851165645469, 9.4769360780128, -.00834990904936, -8.81498681370155, .02245293253339, 6.85401540936998, -.02596338512915, -4.39470996079559, .01624864962975, 2.19611684890774, -.00240879051584, -.75104302451432, .00674613682247, .13149317958808, -.00187763777362], [.15457299681924, -2.37898834973084, -.09331049056315, 2.84868151156327, -.06247880153653, -2.64577170229825, .02163541888798, 2.23697657451713, -.05588393329856, -1.67148153367602, .04781476674921, 1.00595954808547, .00222312597743, -.45953458054983, .03174092540049, .16378164858596, -.01390589421898, -.05032077717131, .00651420667831, .0234789740702, -.00881362733839], [.30296907319327, -1.61273165137247, -.22613988682123, 1.0797749225997, -.08587323730772, -.2565625775407, .03282930172664, -.1627671912044, -.00915702933434, -.22638893773906, -.02364141202522, .39120800788284, -.00584456039913, -.22138138954925, .06276101321749, .04500235387352, -828086748e-14, .02005851806501, .00205861885564, .00302439095741, -.02950134983287], [.33642304856132, -1.49858979367799, -.2557224142557, .87350271418188, -.11828570177555, .12205022308084, .11921148675203, -.80774944671438, -.07834489609479, .47854794562326, -.0046997791438, -.12453458140019, -.0058950022444, -.04067510197014, .05724228140351, .08333755284107, .00832043980773, -.04237348025746, -.0163538138454, .02977207319925, -.0176017656815], [.4491525660845, -.62820619233671, -.14351757464547, .29661783706366, -.22784394429749, -.372563729424, -.01419140100551, .00213767857124, .04078262797139, -.42029820170918, -.12398163381748, .22199650564824, .04097565135648, .00613424350682, .10478503600251, .06747620744683, -.01863887810927, .05784820375801, -.03193428438915, .03222754072173, .00541907748707], [.56619470757641, -1.04800335126349, -.75464456939302, .29156311971249, .1624213774223, -.26806001042947, .16744243493672, .00819999645858, -.18901604199609, .45054734505008, .3093178284183, -.33032403314006, -.27562961986224, .0673936833311, .00647310677246, -.04784254229033, .08647503780351, .01639907836189, -.0378898455484, .01807364323573, -.00588215443421], [.58100494960553, -.51035327095184, -.53174909058578, -.31863563325245, -.14289799034253, -.20256413484477, .17520704835522, .1472815413433, .02377945217615, .38952639978999, .15558449135573, -.23313271880868, -.25344790059353, -.05246019024463, .01628462406333, -.02505961724053, .06920467763959, .02442357316099, -.03721611395801, .01818801111503, -.00749618797172], [.53648789255105, -.2504987195602, -.42163034350696, -.43193942311114, -.00275953611929, -.03424681017675, .04267842219415, -.04678328784242, -.10214864179676, .26408300200955, .14590772289388, .15113130533216, -.02459864859345, -.17556493366449, -.11202315195388, -.18823009262115, -.04060034127, .05477720428674, .0478866554818, .0470440968812, -.02217936801134]],g = [[.98621192462708, -1.97223372919527, -1.97242384925416, .97261396931306, .98621192462708], [.98500175787242, -1.96977855582618, -1.97000351574484, .9702284756635, .98500175787242], [.97938932735214, -1.95835380975398, -1.95877865470428, .95920349965459, .97938932735214], [.97531843204928, -1.95002759149878, -1.95063686409857, .95124613669835, .97531843204928], [.97316523498161, -1.94561023566527, -1.94633046996323, .94705070426118, .97316523498161], [.96454515552826, -1.92783286977036, -1.92909031105652, .93034775234268, .96454515552826], [.96009142950541, -1.91858953033784, -1.92018285901082, .92177618768381, .96009142950541], [.95856916599601, -1.9154210807478, -1.91713833199203, .91885558323625, .95856916599601], [.94597685600279, -1.88903307939452, -1.89195371200558, .89487434461664, .94597685600279]];this.InitGainAnalysis = function (e, t) {e: {for (var a = 0; a < MAX_ORDER; a++) e.linprebuf[a] = e.lstepbuf[a] = e.loutbuf[a] = e.rinprebuf[a] = e.rstepbuf[a] = e.routbuf[a] = 0;switch (0 | t) {case 48e3:e.reqindex = 0;break;case 44100:e.reqindex = 1;break;case 32e3:e.reqindex = 2;break;case 24e3:e.reqindex = 3;break;case 22050:e.reqindex = 4;break;case 16e3:e.reqindex = 5;break;case 12e3:e.reqindex = 6;break;case 11025:e.reqindex = 7;break;case 8e3:e.reqindex = 8;break;default:t = INIT_GAIN_ANALYSIS_ERROR;break e;}e.sampleWindow = 0 | (t * s + n - 1) / n, e.lsum = 0, e.rsum = 0, e.totsamp = 0, d0.ill(e.A, 0), t = INIT_GAIN_ANALYSIS_OK;}return t != INIT_GAIN_ANALYSIS_OK ? INIT_GAIN_ANALYSIS_ERROR : (e.linpre = MAX_ORDER, e.rinpre = MAX_ORDER, e.lstep = MAX_ORDER, e.rstep = MAX_ORDER, e.lout = MAX_ORDER, e.rout = MAX_ORDER, d0.fill(e.B, 0), INIT_GAIN_ANALYSIS_OK);}, this.AnalyzeSamples = function (e, t, a, s, n, _, r) {if (0 != _) {var i = 0,o = _;switch (r) {case 1:s = t, n = a;break;case 2:break;default:return GAIN_ANALYSIS_ERROR;}for (_ < MAX_ORDER ? (N.arraycopy(t, a, e.linprebuf, MAX_ORDER, _), N.arraycopy(s, n, e.rinprebuf, MAX_ORDER, _)) : (N.arraycopy(t, a, e.linprebuf, MAX_ORDER, MAX_ORDER), N.arraycopy(s, n, e.rinprebuf, MAX_ORDER, MAX_ORDER)); 0 < o;) {var l = o > e.sampleWindow - e.totsamp ? e.sampleWindow - e.totsamp : o;i < MAX_ORDER ? (r = e.linpre + i, f = e.linprebuf, h = e.rinpre + i, c = e.rinprebuf, l > MAX_ORDER - i && (l = MAX_ORDER - i)) : (r = a + i, f = t, h = n + i, c = s), u(f, r, e.lstepbuf, e.lstep + e.totsamp, l, d[e.reqindex]), u(c, h, e.rstepbuf, e.rstep + e.totsamp, l, d[e.reqindex]), p(e.lstepbuf, e.lstep + e.totsamp, e.loutbuf, e.lout + e.totsamp, l, g[e.reqindex]), p(e.rstepbuf, e.rstep + e.totsamp, e.routbuf, e.rout + e.totsamp, l, g[e.reqindex]), r = e.lout + e.totsamp;for (var f = e.loutbuf, h = e.rout + e.totsamp, c = e.routbuf, b = l % 8; 0 != b--;) e.lsum += m(f[r++]), e.rsum += m(c[h++]);for (b = l / 8; 0 != b--;) e.lsum += m(f[r + 0]) + m(f[r + 1]) + m(f[r + 2]) + m(f[r + 3]) + m(f[r + 4]) + m(f[r + 5]) + m(f[r + 6]) + m(f[r + 7]), r += 8, e.rsum += m(c[h + 0]) + m(c[h + 1]) + m(c[h + 2]) + m(c[h + 3]) + m(c[h + 4]) + m(c[h + 5]) + m(c[h + 6]) + m(c[h + 7]), h += 8;if (o -= l, i += l, e.totsamp += l, e.totsamp == e.sampleWindow && ((r = (r = 10 * r1.STEPS_per_dB * Math.log10((e.lsum + e.rsum) / e.totsamp * .5 + 1e-37)) <= 0 ? 0 : 0 | r) >= e.A.length && (r = e.A.length - 1), e.A[r]++, e.lsum = e.rsum = 0, N.arraycopy(e.loutbuf, e.totsamp, e.loutbuf, 0, MAX_ORDER), N.arraycopy(e.routbuf, e.totsamp, e.routbuf, 0, MAX_ORDER), N.arraycopy(e.lstepbuf, e.totsamp, e.lstepbuf, 0, MAX_ORDER), N.arraycopy(e.rstepbuf, e.totsamp, e.rstepbuf, 0, MAX_ORDER), e.totsamp = 0), e.sampleWindow < e.totsamp) return GAIN_ANALYSIS_ERROR;}_ < MAX_ORDER ? (N.arraycopy(e.linprebuf, _, e.linprebuf, 0, MAX_ORDER - _), N.arraycopy(e.rinprebuf, _, e.rinprebuf, 0, MAX_ORDER - _), N.arraycopy(t, a, e.linprebuf, MAX_ORDER - _, _), N.arraycopy(s, n, e.rinprebuf, MAX_ORDER - _, _)) : (N.arraycopy(t, a + _ - MAX_ORDER, e.linprebuf, 0, MAX_ORDER), N.arraycopy(s, n + _ - MAX_ORDER, e.rinprebuf, 0, MAX_ORDER));}return GAIN_ANALYSIS_OK;}, this.GetTitleGain = function (e) {for (var t = e.A, a = e.A.length, s = 0, n = 0; n < a; n++) s += t[n];if (0 == s) t = GAIN_NOT_ENOUGH_SAMPLES;else {for (s = 0 | Math.ceil(s * (1 - .95)), n = a; 0 < n-- && !((s -= t[n]) <= 0););t = 64.82 - n / r1.STEPS_per_dB;}for (a = 0; a < e.A.length; a++) e.B[a] += e.A[a], e.A[a] = 0;for (a = 0; a < MAX_ORDER; a++) e.linprebuf[a] = e.lstepbuf[a] = e.loutbuf[a] = e.rinprebuf[a] = e.rstepbuf[a] = e.routbuf[a] = 0;return e.totsamp = 0, e.lsum = e.rsum = 0, t;};}function A() {function e(e, t, a, s, n, _, r, i, o, l, f, h, c, b, u) {this.vbr_q = e, this.quant_comp = t, this.quant_comp_s = a, this.expY = s, this.st_lrm = n, this.st_s = _, this.masking_adj = r, this.masking_adj_short = i, this.ath_lower = o, this.ath_curve = l, this.ath_sensitivity = f, this.interch = h, this.safejoint = c, this.sfb21mod = b, this.msfix = u;}function t(e, t, a, s, n, _, r, i, o, l, f, h, c, b) {this.quant_comp = t, this.quant_comp_s = a, this.safejoint = s, this.nsmsfix = n, this.st_lrm = _, this.st_s = r, this.nsbass = i, this.scale = o, this.masking_adj = l, this.ath_lower = f, this.ath_curve = h, this.interch = c, this.sfscale = b;}function s(e, t, a) {var s = e.VBR == m0.vbr_rh ? r : i,n = e.VBR_q_frac,_ = s[t];_.st_lrm += n * ((s = s[t + 1]).st_lrm - _.st_lrm), _.st_s += n * (s.st_s - _.st_s), _.masking_adj += n * (s.masking_adj - _.masking_adj), _.masking_adj_short += n * (s.masking_adj_short - _.masking_adj_short), _.ath_lower += n * (s.ath_lower - _.ath_lower), _.ath_curve += n * (s.ath_curve - _.ath_curve), _.ath_sensitivity += n * (s.ath_sensitivity - _.ath_sensitivity), _.interch += n * (s.interch - _.interch), _.msfix += n * (s.msfix - _.msfix), e.VBR_q = 9 < (s = (s = _.vbr_q) < 0 ? 0 : s) ? 9 : s, (e.VBR_q_frac = 0) == a && 0 < Math.abs(e.quant_comp - -1) || (e.quant_comp = _.quant_comp), 0 == a && 0 < Math.abs(e.quant_comp_short - -1) || (e.quant_comp_short = _.quant_comp_s), 0 != _.expY && (e.experimentalY = 0 != _.expY), 0 == a && 0 < Math.abs(e.internal_flags.nsPsy.attackthre - -1) || (e.internal_flags.nsPsy.attackthre = _.st_lrm), 0 == a && 0 < Math.abs(e.internal_flags.nsPsy.attackthre_s - -1) || (e.internal_flags.nsPsy.attackthre_s = _.st_s), 0 == a && 0 < Math.abs(+e.maskingadjust) || (e.maskingadjust = _.masking_adj), 0 == a && 0 < Math.abs(+e.maskingadjust_short) || (e.maskingadjust_short = _.masking_adj_short), 0 == a && 0 < Math.abs(10 * -e.ATHlower) || (e.ATHlower = -_.ath_lower / 10), 0 == a && 0 < Math.abs(e.ATHcurve - -1) || (e.ATHcurve = _.ath_curve), 0 == a && 0 < Math.abs(e.athaa_sensitivity - -1) || (e.athaa_sensitivity = _.ath_sensitivity), 0 < _.interch && (0 == a && 0 < Math.abs(e.interChRatio - -1) || (e.interChRatio = _.interch)), 0 < _.safejoint && (e.exp_nspsytune |= _.safejoint), 0 < _.sfb21mod && (e.exp_nspsytune |= _.sfb21mod << 20), 0 == a && 0 < Math.abs(e.msfix - -1) || (e.msfix = _.msfix), 0 == a && (e.VBR_q = t, e.VBR_q_frac = n);}function n(e, t, a) {var s,n = _.nearestBitrateFullIndex(t);return e.VBR = m0.vbr_abr, e.VBR_mean_bitrate_kbps = t, e.VBR_mean_bitrate_kbps = Math.min(e.VBR_mean_bitrate_kbps, 320), e.VBR_mean_bitrate_kbps = Math.max(e.VBR_mean_bitrate_kbps, 8), e.brate = e.VBR_mean_bitrate_kbps, 320 < e.VBR_mean_bitrate_kbps && (e.disable_reservoir = !0), 0 < o[n].safejoint && (e.exp_nspsytune |= 2), 0 < o[n].sfscale && (e.internal_flags.noise_shaping = 2), 0 < Math.abs(o[n].nsbass) && ((s = int(4 * o[n].nsbass)) < 0 && (s += 64), e.exp_nspsytune |= s << 2), 0 == a && 0 < Math.abs(e.quant_comp - -1) || (e.quant_comp = o[n].quant_comp), 0 == a && 0 < Math.abs(e.quant_comp_short - -1) || (e.quant_comp_short = o[n].quant_comp_s), 0 == a && 0 < Math.abs(e.msfix - -1) || (e.msfix = o[n].nsmsfix), 0 == a && 0 < Math.abs(e.internal_flags.nsPsy.attackthre - -1) || (e.internal_flags.nsPsy.attackthre = o[n].st_lrm), 0 == a && 0 < Math.abs(e.internal_flags.nsPsy.attackthre_s - -1) || (e.internal_flags.nsPsy.attackthre_s = o[n].st_s), 0 == a && 0 < Math.abs(e.scale - -1) || (e.scale = o[n].scale), 0 == a && 0 < Math.abs(+e.maskingadjust) || (e.maskingadjust = o[n].masking_adj), 0 < o[n].masking_adj ? 0 == a && 0 < Math.abs(+e.maskingadjust_short) || (e.maskingadjust_short = .9 * o[n].masking_adj) : 0 == a && 0 < Math.abs(+e.maskingadjust_short) || (e.maskingadjust_short = 1.1 * o[n].masking_adj), 0 == a && 0 < Math.abs(10 * -e.ATHlower) || (e.ATHlower = -o[n].ath_lower / 10), 0 == a && 0 < Math.abs(e.ATHcurve - -1) || (e.ATHcurve = o[n].ath_curve), 0 == a && 0 < Math.abs(e.interChRatio - -1) || (e.interChRatio = o[n].interch), t;}this.setModules = function (e) {_ = e;};var _,r = [new e(0, 9, 9, 0, 5.2, 125, -4.2, -6.3, 4.8, 1, 0, 0, 2, 21, .97), new e(1, 9, 9, 0, 5.3, 125, -3.6, -5.6, 4.5, 1.5, 0, 0, 2, 21, 1.35), new e(2, 9, 9, 0, 5.6, 125, -2.2, -3.5, 2.8, 2, 0, 0, 2, 21, 1.49), new e(3, 9, 9, 1, 5.8, 130, -1.8, -2.8, 2.6, 3, -4, 0, 2, 20, 1.64), new e(4, 9, 9, 1, 6, 135, -.7, -1.1, 1.1, 3.5, -8, 0, 2, 0, 1.79), new e(5, 9, 9, 1, 6.4, 140, .5, .4, -7.5, 4, -12, 2e-4, 0, 0, 1.95), new e(6, 9, 9, 1, 6.6, 145, .67, .65, -14.7, 6.5, -19, 4e-4, 0, 0, 2.3), new e(7, 9, 9, 1, 6.6, 145, .8, .75, -19.7, 8, -22, 6e-4, 0, 0, 2.7), new e(8, 9, 9, 1, 6.6, 145, 1.2, 1.15, -27.5, 10, -23, 7e-4, 0, 0, 0), new e(9, 9, 9, 1, 6.6, 145, 1.6, 1.6, -36, 11, -25, 8e-4, 0, 0, 0), new e(10, 9, 9, 1, 6.6, 145, 2, 2, -36, 12, -25, 8e-4, 0, 0, 0)],i = [new e(0, 9, 9, 0, 4.2, 25, -7, -4, 7.5, 1, 0, 0, 2, 26, .97), new e(1, 9, 9, 0, 4.2, 25, -5.6, -3.6, 4.5, 1.5, 0, 0, 2, 21, 1.35), new e(2, 9, 9, 0, 4.2, 25, -4.4, -1.8, 2, 2, 0, 0, 2, 18, 1.49), new e(3, 9, 9, 1, 4.2, 25, -3.4, -1.25, 1.1, 3, -4, 0, 2, 15, 1.64), new e(4, 9, 9, 1, 4.2, 25, -2.2, .1, 0, 3.5, -8, 0, 2, 0, 1.79), new e(5, 9, 9, 1, 4.2, 25, -1, 1.65, -7.7, 4, -12, 2e-4, 0, 0, 1.95), new e(6, 9, 9, 1, 4.2, 25, -0, 2.47, -7.7, 6.5, -19, 4e-4, 0, 0, 2), new e(7, 9, 9, 1, 4.2, 25, .5, 2, -14.5, 8, -22, 6e-4, 0, 0, 2), new e(8, 9, 9, 1, 4.2, 25, 1, 2.4, -22, 10, -23, 7e-4, 0, 0, 2), new e(9, 9, 9, 1, 4.2, 25, 1.5, 2.95, -30, 11, -25, 8e-4, 0, 0, 2), new e(10, 9, 9, 1, 4.2, 25, 2, 2.95, -36, 12, -30, 8e-4, 0, 0, 2)],o = [new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -30, 11, .0012, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -25, 11, .001, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -20, 11, .001, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -15, 11, .001, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -10, 11, 9e-4, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -10, 11, 9e-4, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -6, 11, 8e-4, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -2, 11, 8e-4, 1), new t(0, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, 0, 8, 7e-4, 1), new t(0, 9, 9, 0, 2.5, 6.6, 145, 0, .95, 0, 1, 5.5, 6e-4, 1), new t(0, 9, 9, 0, 2.25, 6.6, 145, 0, .95, 0, 2, 4.5, 5e-4, 1), new t(0, 9, 9, 0, 1.95, 6.4, 140, 0, .95, 0, 3, 4, 2e-4, 1), new t(0, 9, 9, 1, 1.79, 6, 135, 0, .95, -2, 5, 3.5, 0, 1), new t(0, 9, 9, 1, 1.49, 5.6, 125, 0, .97, -4, 7, 3, 0, 0), new t(0, 9, 9, 1, 1.25, 5.2, 125, 0, .98, -6, 9, 2, 0, 0), new t(0, 9, 9, 1, .97, 5.2, 125, 0, 1, -8, 10, 1, 0, 0), new t(0, 9, 9, 1, .9, 5.2, 125, 0, 1, -10, 12, 0, 0, 0)];this.apply_preset = function (e, t, a) {switch (t) {case I.R3MIX:t = I.V3, e.VBR = m0.vbr_mtrh;break;case I.MEDIUM:t = I.V4, e.VBR = m0.vbr_rh;break;case I.MEDIUM_FAST:t = I.V4, e.VBR = m0.vbr_mtrh;break;case I.STANDARD:t = I.V2, e.VBR = m0.vbr_rh;break;case I.STANDARD_FAST:t = I.V2, e.VBR = m0.vbr_mtrh;break;case I.EXTREME:t = I.V0, e.VBR = m0.vbr_rh;break;case I.EXTREME_FAST:t = I.V0, e.VBR = m0.vbr_mtrh;break;case I.INSANE:return e.preset = t = 320, n(e, t, a), e.VBR = m0.vbr_off, t;}switch (e.preset = t) {case I.V9:return s(e, 9, a), t;case I.V8:return s(e, 8, a), t;case I.V7:return s(e, 7, a), t;case I.V6:return s(e, 6, a), t;case I.V5:return s(e, 5, a), t;case I.V4:return s(e, 4, a), t;case I.V3:return s(e, 3, a), t;case I.V2:return s(e, 2, a), t;case I.V1:return s(e, 1, a), t;case I.V0:return s(e, 0, a), t;}return 8 <= t && t <= 320 ? n(e, t, a) : (e.preset = 0, t);};}function E() {function m(e) {this.bits = 0 | e;}function S(e, t, a, s, n, _) {for (t = .5946 / t, e >>= 1; 0 != e--;) n[_++] = t > a[s++] ? 0 : 1, n[_++] = t > a[s++] ? 0 : 1;}function R(e, t, a, s, n, _) {var r = (e >>= 1) % 2;for (e >>= 1; 0 != e--;) {var i,o = a[s++] * t,l = a[s++] * t,f = a[s++] * t,h = a[s++] * t,c = 0 | f;o += M.adj43[0 | o], i = 0 | h, l += M.adj43[0 | l], n[_++] = 0 | o, f += M.adj43[c], n[_++] = 0 | l, h += M.adj43[i], n[_++] = 0 | f, n[_++] = 0 | h;}0 != r && (o = a[s++] * t, l = a[s++] * t, o += M.adj43[0 | o], l += M.adj43[0 | l], n[_++] = 0 | o, n[_++] = 0 | l);}function d(e, t, a, s) {var n,_ = t,r = n = 0;do {var i = e[_++],o = e[_++];} while (n < i && (n = i), r < o && (r = o), _ < a);switch (n = n < r ? r : n) {case 0:return n;case 1:for (_ = t, t = 0, n = V.ht[1].hlen; t += n[r = 2 * e[_ + 0] + e[_ + 1]], (_ += 2) < a;);return s.bits += t, 1;case 2:case 3:for (_ = t, t = b[n - 1], n = 0, r = V.ht[t].xlen, i = 2 == t ? V.table23 : V.table56; n += i[o = e[_ + 0] * r + e[_ + 1]], (_ += 2) < a;);return (e = 65535 & n) < (n >>= 16) && (n = e, t++), s.bits += n, t;case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:_ = t, t = b[n - 1];var i = r = n = 0,o = V.ht[t].xlen,l = V.ht[t].hlen,f = V.ht[t + 1].hlen,h = V.ht[t + 2].hlen;do {var c = e[_ + 0] * o + e[_ + 1];} while (n += l[c], r += f[c], i += h[c], (_ += 2) < a);return e = t, r < n && (n = r, e++), i < n && (n = i, e = t + 2), s.bits += n, e;default:if (k.IXMAX_VAL < n) return s.bits = k.LARGE_BITS, -1;for (n -= 15, _ = 24; _ < 32 && !(V.ht[_].linmax >= n); _++);for (r = _ - 8; r < 24 && !(V.ht[r].linmax >= n); r++);for (n = r, i = 65536 * V.ht[n].xlen + V.ht[_].xlen, r = 0; 0 != (o = e[t++]) && (14 < o && (o = 15, r += i), o *= 16), 0 != (l = e[t++]) && (14 < l && (l = 15, r += i), o += l), r += V.largetbl[o], t < a;);return (e = 65535 & r) < (r >>= 16) && (r = e, n = _), s.bits += r, n;}}function g(e, t, a, s, n, _, r, i) {for (var o = t.big_values, l = 2; l < te.SBMAX_l + 1; l++) {var f = e.scalefac_band.l[l];if (o <= f) break;var h = n[l - 2] + t.count1bits;if (a.part2_3_length <= h) break;f = d(s, f, o, h = new m(h)), h = h.bits, a.part2_3_length <= h || (a.assign(t), a.part2_3_length = h, a.region0_count = _[l - 2], a.region1_count = l - 2 - _[l - 2], a.table_select[0] = r[l - 2], a.table_select[1] = i[l - 2], a.table_select[2] = f);}}var M = null,n = (this.qupvt = null, this.setModules = function (e) {M = this.qupvt = e;}, [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 1], [1, 1], [1, 1], [1, 2], [2, 2], [2, 3], [2, 3], [3, 4], [3, 4], [3, 4], [4, 5], [4, 5], [4, 6], [5, 6], [5, 6], [5, 7], [6, 7], [6, 7]]),b = [1, 2, 5, 7, 7, 10, 10, 13, 13, 13, 13, 13, 13, 13, 13],l = (this.noquant_count_bits = function (e, t, a) {var s = t.l3_enc,n = Math.min(576, t.max_nonzero_coeff + 2 >> 1 << 1);for (null != a && (a.sfb_count1 = 0); 1 < n && 0 == (s[n - 1] | s[n - 2]); n -= 2);t.count1 = n;for (var _ = 0, r = 0; 3 < n && !(1 < (2147483647 & (s[n - 1] | s[n - 2] | s[n - 3] | s[n - 4]))); n -= 4) {var i = 2 * (2 * (2 * s[n - 4] + s[n - 3]) + s[n - 2]) + s[n - 1];_ += V.t32l[i], r += V.t33l[i];}if (i = _, t.count1table_select = 0, r < _ && (i = r, t.count1table_select = 1), t.count1bits = i, 0 != (t.big_values = n) && (t.block_type == te.SHORT_TYPE ? (_ = 3 * e.scalefac_band.s[3], t.big_values < _ && (_ = t.big_values), r = t.big_values) : t.block_type == te.NORM_TYPE ? (_ = t.region0_count = e.bv_scf[n - 2], r = t.region1_count = e.bv_scf[n - 1], r = e.scalefac_band.l[_ + r + 2], _ = e.scalefac_band.l[_ + 1], r < n && (i = new m(i), t.table_select[2] = d(s, r, n, i), i = i.bits)) : (t.region0_count = 7, t.region1_count = te.SBMAX_l - 1 - 7 - 1, (r = n) < (_ = e.scalefac_band.l[8]) && (_ = r)), _ = Math.min(_, n), r = Math.min(r, n), 0 < _ && (i = new m(i), t.table_select[0] = d(s, 0, _, i), i = i.bits), _ < r && (i = new m(i), t.table_select[1] = d(s, _, r, i), i = i.bits), 2 == e.use_best_huffman && (t.part2_3_length = i, best_huffman_divide(e, t), i = t.part2_3_length), null != a) && t.block_type == te.NORM_TYPE) {for (s = 0; e.scalefac_band.l[s] < t.big_values;) s++;a.sfb_count1 = s;}return i;}, this.count_bits = function (e, t, a, s) {var n = a.l3_enc,_ = k.IXMAX_VAL / M.IPOW20(a.global_gain);if (a.xrpow_max > _) return k.LARGE_BITS;for (var _ = M.IPOW20(a.global_gain), r = 0, i = 0, o = 0, l = 0, f = 0, h = n, c = 0, b = t, u = 0, p = null != s && a.global_gain == s.global_gain, m = a.block_type == te.SHORT_TYPE ? 38 : 21, d = 0; d <= m; d++) {var g = -1;if (!p && a.block_type != te.NORM_TYPE || (g = a.global_gain - (a.scalefac[d] + (0 != a.preflag ? M.pretab[d] : 0) << a.scalefac_scale + 1) - 8 * a.subblock_gain[a.window[d]]), p && s.step[d] == g) 0 != i && (R(i, _, b, u, h, c), i = 0), 0 != o && (S(o, _, b, u, h, c), o = 0);else {var v = a.width[d];if (r + a.width[d] > a.max_nonzero_coeff && (d = a.max_nonzero_coeff - r + 1, d0.fill(n, a.max_nonzero_coeff, 576, 0), (v = d) < 0 && (v = 0), d = m + 1), 0 == i && 0 == o && (h = n, c = f, b = t, u = l), null != s && 0 < s.sfb_count1 && d >= s.sfb_count1 && 0 < s.step[d] && g >= s.step[d] ? (0 != i && (R(i, _, b, u, h, c), i = 0, h = n, c = f, b = t, u = l), o += v) : (0 != o && (S(o, _, b, u, h, c), o = 0, h = n, c = f, b = t, u = l), i += v), v <= 0) {0 != o && (S(o, _, b, u, h, c), o = 0), 0 != i && (R(i, _, b, u, h, c), i = 0);break;}}d <= m && (f += a.width[d], l += a.width[d], r += a.width[d]);}if (0 != i && R(i, _, b, u, h, c), 0 != o && S(o, _, b, u, h, c), 0 != (2 & e.substep_shaping)) for (_ = 0, m = .634521682242439 / M.IPOW20(a.global_gain + a.scalefac_scale), r = 0; r < a.sfbmax; r++) if (p = a.width[r], 0 == e.pseudohalf[r]) _ += p;else for (i = _, _ += p; i < _; ++i) n[i] = t[i] >= m ? n[i] : 0;return this.noquant_count_bits(e, a, s);}, this.best_huffman_divide = function (e, t) {var a = new L(),s = t.l3_enc,n = U0(23),_ = U0(23),r = U0(23),i = U0(23);if (t.block_type != te.SHORT_TYPE || 1 != e.mode_gr) {if (a.assign(t), t.block_type == te.NORM_TYPE) {for (var o = t.big_values, l = 0; l <= 22; l++) n[l] = k.LARGE_BITS;for (l = 0; l < 16; l++) {var f = e.scalefac_band.l[l + 1];if (o <= f) break;for (var h = new m(b = 0), c = d(s, 0, f, h), b = h.bits, u = 0; u < 8; u++) {var p = e.scalefac_band.l[l + u + 2];if (o <= p) break;p = d(s, f, p, h = new m(b)), h = h.bits, n[l + u] > h && (n[l + u] = h, r[(_[l + u] = l) + u] = c, i[l + u] = p);}}g(e, a, t, s, n, _, r, i);}if (!(0 == (o = a.big_values) || 1 < (s[o - 2] | s[o - 1]) || 576 < (o = t.count1 + 2))) {for (a.assign(t), a.count1 = o, f = l = 0; o > a.big_values; o -= 4) b = 2 * (2 * (2 * s[o - 4] + s[o - 3]) + s[o - 2]) + s[o - 1], l += V.t32l[b], f += V.t33l[b];a.big_values = o, a.count1table_select = 0, f < l && (l = f, a.count1table_select = 1), a.count1bits = l, a.block_type == te.NORM_TYPE ? g(e, a, t, s, n, _, r, i) : (a.part2_3_length = l, 0 < (l = o < (l = e.scalefac_band.l[8]) ? o : l) && (e = new m(a.part2_3_length), a.table_select[0] = d(s, 0, l, e), a.part2_3_length = e.bits), l < o && (e = new m(a.part2_3_length), a.table_select[1] = d(s, l, o, e), a.part2_3_length = e.bits), t.part2_3_length > a.part2_3_length && t.assign(a));}}}, [1, 1, 1, 1, 8, 2, 2, 2, 4, 4, 4, 8, 8, 8, 16, 16]),f = [1, 2, 4, 8, 1, 2, 4, 8, 2, 4, 8, 2, 4, 8, 4, 8],h = [0, 0, 0, 0, 3, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4],c = [0, 1, 2, 3, 0, 1, 2, 3, 1, 2, 3, 1, 2, 3, 2, 3],r = (E.slen1_tab = h, E.slen2_tab = c, this.best_scalefac_store = function (e, t, a, s) {for (var n, _ = s.tt[t][a], r = 0, i = n = 0; i < _.sfbmax; i++) {var o = _.width[i];for (n += o, o = -o; o < 0 && 0 == _.l3_enc[o + n]; o++);0 == o && (_.scalefac[i] = r = -2);}if (0 == _.scalefac_scale && 0 == _.preflag) {for (i = n = 0; i < _.sfbmax; i++) 0 < _.scalefac[i] && (n |= _.scalefac[i]);if (0 == (1 & n) && 0 != n) {for (i = 0; i < _.sfbmax; i++) 0 < _.scalefac[i] && (_.scalefac[i] >>= 1);_.scalefac_scale = r = 1;}}if (0 == _.preflag && _.block_type != te.SHORT_TYPE && 2 == e.mode_gr) {for (i = 11; i < te.SBPSY_l && !(_.scalefac[i] < M.pretab[i] && -2 != _.scalefac[i]); i++);if (i == te.SBPSY_l) {for (i = 11; i < te.SBPSY_l; i++) 0 < _.scalefac[i] && (_.scalefac[i] -= M.pretab[i]);_.preflag = r = 1;}}for (i = 0; i < 4; i++) s.scfsi[a][i] = 0;if (2 == e.mode_gr && 1 == t && s.tt[0][a].block_type != te.SHORT_TYPE && s.tt[1][a].block_type != te.SHORT_TYPE) {for (t = s.tt[1][a], n = s.tt[0][a], r = 0; r < V.scfsi_band.length - 1; r++) {for (i = V.scfsi_band[r]; i < V.scfsi_band[r + 1] && !(n.scalefac[i] != t.scalefac[i] && 0 <= t.scalefac[i]); i++);if (i == V.scfsi_band[r + 1]) {for (i = V.scfsi_band[r]; i < V.scfsi_band[r + 1]; i++) t.scalefac[i] = -1;s.scfsi[a][r] = 1;}}for (i = s = a = 0; i < 11; i++) -1 != t.scalefac[i] && (s++, a < t.scalefac[i]) && (a = t.scalefac[i]);for (o = n = 0; i < te.SBPSY_l; i++) -1 != t.scalefac[i] && (o++, n < t.scalefac[i]) && (n = t.scalefac[i]);for (r = 0; r < 16; r++) a < l[r] && n < f[r] && t.part2_length > (i = h[r] * s + c[r] * o) && (t.part2_length = i, t.scalefac_compress = r);r = 0;}for (i = 0; i < _.sfbmax; i++) -2 == _.scalefac[i] && (_.scalefac[i] = 0);0 != r && (2 == e.mode_gr ? this.scale_bitcount(_) : this.scale_bitcount_lsf(e, _));}, [0, 18, 36, 54, 54, 36, 54, 72, 54, 72, 90, 72, 90, 108, 108, 126]),i = [0, 18, 36, 54, 51, 35, 53, 71, 52, 70, 88, 69, 87, 105, 104, 122],o = [0, 10, 20, 30, 33, 21, 31, 41, 32, 42, 52, 43, 53, 63, 64, 74],u = (this.scale_bitcount = function (e) {var t,a = 0,s = 0,n = e.scalefac;if (e.block_type == te.SHORT_TYPE) {var _ = r;0 != e.mixed_block_flag && (_ = i);} else if (_ = o, 0 == e.preflag) {for (t = 11; t < te.SBPSY_l && !(n[t] < M.pretab[t]); t++);if (t == te.SBPSY_l) for (e.preflag = 1, t = 11; t < te.SBPSY_l; t++) n[t] -= M.pretab[t];}for (t = 0; t < e.sfbdivide; t++) a < n[t] && (a = n[t]);for (; t < e.sfbmax; t++) s < n[t] && (s = n[t]);for (e.part2_length = k.LARGE_BITS, t = 0; t < 16; t++) a < l[t] && s < f[t] && e.part2_length > _[t] && (e.part2_length = _[t], e.scalefac_compress = t);return e.part2_length == k.LARGE_BITS;}, [[15, 15, 7, 7], [15, 15, 7, 0], [7, 3, 0, 0], [15, 31, 31, 0], [7, 7, 7, 0], [3, 3, 0, 0]]),p = (this.scale_bitcount_lsf = function (e, t) {var a,s,n = U0(4),_ = t.scalefac;for (e = 0 != t.preflag ? 2 : 0, f = 0; f < 4; f++) n[f] = 0;if (t.block_type == te.SHORT_TYPE) for (var r = 1, i = M.nr_of_sfb_block[e][r], o = s = 0; o < 4; o++) for (var l = i[o] / 3, f = 0; f < l; f++, s++) for (a = 0; a < 3; a++) _[3 * s + a] > n[o] && (n[o] = _[3 * s + a]);else for (i = M.nr_of_sfb_block[e][r = 0], o = s = 0; o < 4; o++) for (l = i[o], f = 0; f < l; f++, s++) _[s] > n[o] && (n[o] = _[s]);for (l = !1, o = 0; o < 4; o++) n[o] > u[e][o] && (l = !0);if (!l) {for (t.sfb_partition_table = M.nr_of_sfb_block[e][r], o = 0; o < 4; o++) t.slen[o] = p[n[o]];switch (r = t.slen[0], o = t.slen[1], n = t.slen[2], a = t.slen[3], e) {case 0:t.scalefac_compress = (5 * r + o << 4) + (n << 2) + a;break;case 1:t.scalefac_compress = 400 + (5 * r + o << 2) + n;break;case 2:t.scalefac_compress = 500 + 3 * r + o;break;default:N.err.printf("intensity stereo not implemented yet\n");}}if (!l) for (o = t.part2_length = 0; o < 4; o++) t.part2_length += t.slen[o] * t.sfb_partition_table[o];return l;}, [0, 1, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4]);this.huffman_init = function (e) {for (var t = 2; t <= 576; t += 2) {for (var a, s = 0; e.scalefac_band.l[++s] < t;);for (a = n[s][0]; e.scalefac_band.l[a + 1] > t;) a--;for (a < 0 && (a = n[s][0]), e.bv_scf[t - 2] = a, a = n[s][1]; e.scalefac_band.l[a + e.bv_scf[t - 2] + 2] > t;) a--;a < 0 && (a = n[s][1]), e.bv_scf[t - 1] = a;}};}function B() {var i;this.setModules = function (e) {i = e;}, this.ResvFrameBegin = function (e, t) {var a,s = e.internal_flags,n = s.l3_side,_ = i.getframebits(e),r = (t.bits = (_ - 8 * s.sideinfo_len) / s.mode_gr, 2048 * s.mode_gr - 8);return 320 < e.brate ? a = 8 * int(1e3 * e.brate / (e.out_samplerate / 1152) / 8 + .5) : (a = 11520, e.strict_ISO && (a = 8 * int(32e4 / (e.out_samplerate / 1152) / 8 + .5))), s.ResvMax = a - _, s.ResvMax > r && (s.ResvMax = r), (s.ResvMax < 0 || e.disable_reservoir) && (s.ResvMax = 0), a < (e = t.bits * s.mode_gr + Math.min(s.ResvSize, s.ResvMax)) && (e = a), n.resvDrain_pre = 0, null != s.pinfo && (s.pinfo.mean_bits = t.bits / 2, s.pinfo.resvsize = s.ResvSize), e;}, this.ResvMaxBits = function (e, t, a, s) {var n = e.internal_flags,_ = n.ResvSize,r = n.ResvMax;return 0 != s && (_ += t), 0 != (1 & n.substep_shaping) && (r *= .9), a.bits = t, 9 * r < 10 * _ ? (a.bits += s = _ - 9 * r / 10, n.substep_shaping |= 128) : (s = 0, n.substep_shaping &= 127, e.disable_reservoir || 0 != (1 & n.substep_shaping) || (a.bits -= .1 * t)), e = _ < 6 * n.ResvMax / 10 ? _ : 6 * n.ResvMax / 10, (e -= s) < 0 ? 0 : e;}, this.ResvAdjust = function (e, t) {e.ResvSize -= t.part2_3_length + t.part2_length;}, this.ResvFrameEnd = function (e, t) {var a,s = e.l3_side;e.ResvSize += t * e.mode_gr, s.resvDrain_post = t = 0, (s.resvDrain_pre = 0) != (a = e.ResvSize % 8) && (t += a), 0 < (a = e.ResvSize - t - e.ResvMax) && (t += a), a = Math.min(8 * s.main_data_begin, t) / 8, s.resvDrain_pre += 8 * a, t -= 8 * a, e.ResvSize -= 8 * a, s.main_data_begin -= a, s.resvDrain_post += t, e.ResvSize -= t;};}function i1() {function g(e, t, a) {for (; 0 < a;) {var s;0 == b && (b = 8, c++, e.header[e.w_ptr].write_timing == T && (N.arraycopy((s = e).header[s.w_ptr].buf, 0, h, c, s.sideinfo_len), c += s.sideinfo_len, T += 8 * s.sideinfo_len, s.w_ptr = s.w_ptr + 1 & o1.MAX_HEADER_BUF - 1), h[c] = 0), a -= s = Math.min(a, b), b -= s, h[c] |= t >> a << b, T += s;}}function v(e, t) {var a,s = e.internal_flags;if (8 <= t && (g(s, 76, 8), t -= 8), 8 <= t && (g(s, 65, 8), t -= 8), 8 <= t && (g(s, 77, 8), t -= 8), 8 <= t && (g(s, 69, 8), t -= 8), 32 <= t) {var n = _.getLameShortVersion();if (32 <= t) for (a = 0; a < n.length && 8 <= t; ++a) t -= 8, g(s, n.charAt(a), 8);}for (; 1 <= t; --t) g(s, s.ancillary_flag, 1), s.ancillary_flag ^= e.disable_reservoir ? 0 : 1;}function S(e, t, a) {for (var s = e.header[e.h_ptr].ptr; 0 < a;) {var n = Math.min(a, 8 - (7 & s));a -= n, e.header[e.h_ptr].buf[s >> 3] |= t >> a << 8 - (7 & s) - n, s += n;}e.header[e.h_ptr].ptr = s;}function n(e, t) {e <<= 8;for (var a = 0; a < 8; a++) 0 != (65536 & ((t <<= 1) ^ (e <<= 1))) && (t ^= 32773);return t;}function R(e, t) {for (var a = V.ht[t.count1table_select + 32], s = 0, n = t.big_values, _ = t.big_values, r = (t.count1 - t.big_values) / 4; 0 < r; --r) {var i = 0,o = 0;0 != t.l3_enc[n + 0] && (o += 8, t.xr[_ + 0] < 0) && i++, 0 != t.l3_enc[n + 1] && (o += 4, i *= 2, t.xr[_ + 1] < 0) && i++, 0 != t.l3_enc[n + 2] && (o += 2, i *= 2, t.xr[_ + 2] < 0) && i++, 0 != t.l3_enc[n + 3] && (o++, i *= 2, t.xr[_ + 3] < 0) && i++, n += 4, _ += 4, g(e, i + a.table[o], a.hlen[o]), s += a.hlen[o];}return s;}function r(e, t, a, s, n) {var _ = V.ht[t],r = 0;if (0 != t) for (; a < s; a += 2) {var i = 0,o = 0,l = _.xlen,f = _.xlen,h = 0,c = n.l3_enc[a],b = n.l3_enc[a + 1];0 != c && (n.xr[a] < 0 && h++, i--), 15 < t && (14 < c && (h |= c - 15 << 1, o = l, c = 15), 14 < b && (h = h << l | (f = b - 15), o += l, b = 15), f = 16), 0 != b && (h <<= 1, n.xr[a + 1] < 0 && h++, i--), o -= i, i += _.hlen[c = c * f + b], g(e, _.table[c], i), g(e, h, o), r += i + o;}return r;}function M(e, t) {var a = 3 * e.scalefac_band.s[3];return a > t.big_values && (a = t.big_values), r(e, t.table_select[0], 0, a, t) + r(e, t.table_select[1], a, t.big_values, t);}function A(e, t) {var a = t.big_values,s = t.region0_count + 1,n = e.scalefac_band.l[s],_ = e.scalefac_band.l[s += t.region1_count + 1];return a < _ && (_ = a), s = r(e, t.table_select[0], 0, n = a < n ? a : n, t), (s += r(e, t.table_select[1], n, _, t)) + r(e, t.table_select[2], _, a, t);}function B() {this.total = 0;}function w(e, t) {var a = e.internal_flags,s = a.w_ptr,n = a.h_ptr - 1,_ = a.header[n = -1 == n ? o1.MAX_HEADER_BUF - 1 : n].write_timing - T;return 0 <= (t.total = _) && (_ -= 8 * (n < s ? 1 + n - s + o1.MAX_HEADER_BUF : 1 + n - s) * a.sideinfo_len), _ += e = i.getframebits(e), t.total += e, t.total = 0 != t.total % 8 ? 1 + t.total / 8 : t.total / 8, t.total += c + 1, _ < 0 && N.err.println("strange error flushing buffer ... \n"), _;}var i = this,o = null,l = null,_ = null,f = null,h = (this.setModules = function (e, t, a, s) {o = e, l = t, _ = a, f = s;}, null),T = 0,c = 0,b = 0;this.getframebits = function (e) {var t = e.internal_flags;return 8 * (0 | 72e3 * (e.version + 1) * (0 != t.bitrate_index ? V.bitrate_table[e.version][t.bitrate_index] : e.brate) / e.out_samplerate + t.padding);}, this.CRC_writeheader = function (e, t) {for (var a = n(255 & t[2], 65535), a = n(255 & t[3], a), s = 6; s < e.sideinfo_len; s++) a = n(255 & t[s], a);t[4] = byte(a >> 8), t[5] = byte(255 & a);}, this.flush_bitstream = function (e) {var t,a = e.internal_flags,s = a.l3_side;(t = w(e, new B())) < 0 || (v(e, t), s.main_data_begin = a.ResvSize = 0, a.findReplayGain && (s = o.GetTitleGain(a.rgdata), a.RadioGain = 0 | Math.floor(10 * s + .5)), a.findPeakSample && (a.noclipGainChange = 0 | Math.ceil(200 * Math.log10(a.PeakSample / 32767)), 0 < a.noclipGainChange && (EQ(e.scale, 1) || EQ(e.scale, 0)) ? a.noclipScale = Math.floor(32767 / a.PeakSample * 100) / 100 : a.noclipScale = -1));}, this.add_dummy_byte = function (e, t, a) {for (e = e.internal_flags; 0 < a--;) {for (var s = t, n = 8; 0 < n;) {0 == b && (b = 8, h[++c] = 0);var _ = Math.min(n, b);n -= _, b -= _, h[c] |= s >> n << b, T += _;}for (s = 0; s < o1.MAX_HEADER_BUF; ++s) e.header[s].write_timing += 8;}}, this.format_bitstream = function (e) {var t = e.internal_flags,a = t.l3_side,s = this.getframebits(e);v(e, a.resvDrain_pre);var n,_ = (i = e.internal_flags).l3_side;if (i.header[i.h_ptr].ptr = 0, d0.fill(i.header[i.h_ptr].buf, 0, i.sideinfo_len, 0), e.out_samplerate < 16e3 ? S(i, 4094, 12) : S(i, 4095, 12), S(i, e.version, 1), S(i, 1, 2), S(i, e.error_protection ? 0 : 1, 1), S(i, i.bitrate_index, 4), S(i, i.samplerate_index, 2), S(i, i.padding, 1), S(i, e.extension, 1), S(i, e.mode.ordinal(), 2), S(i, i.mode_ext, 2), S(i, e.copyright, 1), S(i, e.original, 1), S(i, e.emphasis, 2), e.error_protection && S(i, 0, 16), 1 == e.version) {for (S(i, _.main_data_begin, 9), 2 == i.channels_out ? S(i, _.private_bits, 3) : S(i, _.private_bits, 5), n = 0; n < i.channels_out; n++) for (u = 0; u < 4; u++) S(i, _.scfsi[n][u], 1);for (u = 0; u < 2; u++) for (n = 0; n < i.channels_out; n++) {var r = _.tt[u][n];S(i, r.part2_3_length + r.part2_length, 12), S(i, r.big_values / 2, 9), S(i, r.global_gain, 8), S(i, r.scalefac_compress, 4), r.block_type != te.NORM_TYPE ? (S(i, 1, 1), S(i, r.block_type, 2), S(i, r.mixed_block_flag, 1), 14 == r.table_select[0] && (r.table_select[0] = 16), S(i, r.table_select[0], 5), 14 == r.table_select[1] && (r.table_select[1] = 16), S(i, r.table_select[1], 5), S(i, r.subblock_gain[0], 3), S(i, r.subblock_gain[1], 3), S(i, r.subblock_gain[2], 3)) : (S(i, 0, 1), 14 == r.table_select[0] && (r.table_select[0] = 16), S(i, r.table_select[0], 5), 14 == r.table_select[1] && (r.table_select[1] = 16), S(i, r.table_select[1], 5), 14 == r.table_select[2] && (r.table_select[2] = 16), S(i, r.table_select[2], 5), S(i, r.region0_count, 4), S(i, r.region1_count, 3)), S(i, r.preflag, 1), S(i, r.scalefac_scale, 1), S(i, r.count1table_select, 1);}} else for (S(i, _.main_data_begin, 8), S(i, _.private_bits, i.channels_out), n = u = 0; n < i.channels_out; n++) S(i, (r = _.tt[u][n]).part2_3_length + r.part2_length, 12), S(i, r.big_values / 2, 9), S(i, r.global_gain, 8), S(i, r.scalefac_compress, 9), r.block_type != te.NORM_TYPE ? (S(i, 1, 1), S(i, r.block_type, 2), S(i, r.mixed_block_flag, 1), 14 == r.table_select[0] && (r.table_select[0] = 16), S(i, r.table_select[0], 5), 14 == r.table_select[1] && (r.table_select[1] = 16), S(i, r.table_select[1], 5), S(i, r.subblock_gain[0], 3), S(i, r.subblock_gain[1], 3), S(i, r.subblock_gain[2], 3)) : (S(i, 0, 1), 14 == r.table_select[0] && (r.table_select[0] = 16), S(i, r.table_select[0], 5), 14 == r.table_select[1] && (r.table_select[1] = 16), S(i, r.table_select[1], 5), 14 == r.table_select[2] && (r.table_select[2] = 16), S(i, r.table_select[2], 5), S(i, r.region0_count, 4), S(i, r.region1_count, 3)), S(i, r.scalefac_scale, 1), S(i, r.count1table_select, 1);e.error_protection && CRC_writeheader(i, i.header[i.h_ptr].buf), _ = i.h_ptr, i.h_ptr = _ + 1 & o1.MAX_HEADER_BUF - 1, i.header[i.h_ptr].write_timing = i.header[_].write_timing + s, i.h_ptr == i.w_ptr && N.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n");var i = 8 * t.sideinfo_len,o = 0,l = e.internal_flags,f = l.l3_side;if (1 == e.version) for (_ = 0; _ < 2; _++) for (n = 0; n < l.channels_out; n++) {for (var h = f.tt[_][n], c = E.slen1_tab[h.scalefac_compress], b = E.slen2_tab[h.scalefac_compress], u = r = 0; u < h.sfbdivide; u++) -1 != h.scalefac[u] && (g(l, h.scalefac[u], c), r += c);for (; u < h.sfbmax; u++) -1 != h.scalefac[u] && (g(l, h.scalefac[u], b), r += b);r = h.block_type == te.SHORT_TYPE ? r + M(l, h) : r + A(l, h), o += r += R(l, h);} else for (n = _ = 0; n < l.channels_out; n++) {var p = 0,b = u = r = 0;if ((h = f.tt[_][n]).block_type == te.SHORT_TYPE) {for (; b < 4; b++) for (var m = h.sfb_partition_table[b] / 3, d = h.slen[b], c = 0; c < m; c++, u++) g(l, Math.max(h.scalefac[3 * u], 0), d), g(l, Math.max(h.scalefac[3 * u + 1], 0), d), g(l, Math.max(h.scalefac[3 * u + 2], 0), d), p += 3 * d;r += M(l, h);} else {for (; b < 4; b++) for (m = h.sfb_partition_table[b], d = h.slen[b], c = 0; c < m; c++, u++) g(l, Math.max(h.scalefac[u], 0), d), p += d;r += A(l, h);}o += p + (r += R(l, h));}if (i += o, v(e, a.resvDrain_post), i += a.resvDrain_post, a.main_data_begin += (s - i) / 8, w(e, new B()) != t.ResvSize && N.err.println("Internal buffer inconsistency. flushbits <> ResvSize"), 8 * a.main_data_begin != t.ResvSize && (N.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n", 8 * a.main_data_begin, t.ResvSize, a.resvDrain_post, a.resvDrain_pre, 8 * t.sideinfo_len, i - a.resvDrain_post - 8 * t.sideinfo_len, i, i % 8, s), N.err.println("This is a fatal error.  It has several possible causes:"), N.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"), N.err.println(" 9%%  Your system is overclocked"), N.err.println(" 1%%  bug in LAME encoding library"), t.ResvSize = 8 * a.main_data_begin), 1e9 < T) {for (e = 0; e < o1.MAX_HEADER_BUF; ++e) t.header[e].write_timing -= T;T = 0;}return 0;}, this.copy_buffer = function (e, t, a, s, n) {var _ = c + 1;if (_ <= 0) return 0;if (0 != s && s < _) return -1;if (N.arraycopy(h, 0, t, a, _), c = -1, (b = 0) != n && ((s = U0(1))[0] = e.nMusicCRC, f.updateMusicCRC(s, t, a, _), e.nMusicCRC = s[0], 0 < _ && (e.VBR_seek_table.nBytesWritten += _), e.decode_on_the_fly)) {s = J0([2, 1152]), n = _;for (var r, i = -1; 0 != i;) if (i = l.hip_decode1_unclipped(e.hip, t, a, n, s[0], s[1]), (n = 0) < (i = -1 == i ? 0 : i)) {if (e.findPeakSample) {for (r = 0; r < i; r++) s[0][r] > e.PeakSample ? e.PeakSample = s[0][r] : -s[0][r] > e.PeakSample && (e.PeakSample = -s[0][r]);if (1 < e.channels_out) for (r = 0; r < i; r++) s[1][r] > e.PeakSample ? e.PeakSample = s[1][r] : -s[1][r] > e.PeakSample && (e.PeakSample = -s[1][r]);}if (e.findReplayGain && o.AnalyzeSamples(e.rgdata, s[0], 0, s[1], 0, i, e.channels_out) == r1.GAIN_ANALYSIS_ERROR) return -6;}}return _;}, this.init_bit_stream_w = function (e) {h = new Int8Array(I.LAME_MAXMP3BUFFER), e.h_ptr = e.w_ptr = 0, e.header[e.h_ptr].write_timing = 0, c = -1, T = b = 0;};}function P() {function i(e, t) {return (((255 & e[t + 0]) << 8 | 255 & e[t + 1]) << 8 | 255 & e[t + 2]) << 8 | 255 & e[t + 3];}function B(e, t, a) {e[t + 0] = a >> 24 & 255, e[t + 1] = a >> 16 & 255, e[t + 2] = a >> 8 & 255, e[t + 3] = 255 & a;}function w(e, t, a) {e[t + 0] = a >> 8 & 255, e[t + 1] = 255 & a;}function n(e, t, a) {return 255 & (e << t | a & ~(-1 << t));}function T(e, t) {var a = e.internal_flags,s = (t[0] = n(t[0], 8, 255), t[1] = n(t[1], 3, 7), t[1] = n(t[1], 1, e.out_samplerate < 16e3 ? 0 : 1), t[1] = n(t[1], 1, e.version), t[1] = n(t[1], 2, 1), t[1] = n(t[1], 1, e.error_protection ? 0 : 1), t[2] = n(t[2], 4, a.bitrate_index), t[2] = n(t[2], 2, a.samplerate_index), t[2] = n(t[2], 1, 0), t[2] = n(t[2], 1, e.extension), t[3] = n(t[3], 2, e.mode.ordinal()), t[3] = n(t[3], 2, a.mode_ext), t[3] = n(t[3], 1, e.copyright), t[3] = n(t[3], 1, e.original), t[3] = n(t[3], 2, e.emphasis), t[0] = 255, a = 241 & t[1], 1 == e.version ? 128 : e.out_samplerate < 16e3 ? 32 : 64);e.VBR == m0.vbr_off && (s = e.brate), s = e.free_format ? 0 : 255 & 16 * _.BitrateIndex(s, e.version, e.out_samplerate), t[1] = 1 == e.version ? 255 & (10 | a) : 255 & (2 | a), t[2] = 255 & (s | 13 & t[2]);}function E(e, t) {return t >> 8 ^ a[255 & (t ^ e)];}this.setModules = function (e, t, a) {_ = e, k = t, y = a;};var _,k,y,x = P.NUMTOCENTRIES,r = P.MAXFRAMESIZE,o = x + 4 + 4 + 4 + 4 + 4 + 9 + 1 + 1 + 8 + 1 + 1 + 3 + 1 + 1 + 2 + 4 + 2 + 2,a = [0, 49345, 49537, 320, 49921, 960, 640, 49729, 50689, 1728, 1920, 51009, 1280, 50625, 50305, 1088, 52225, 3264, 3456, 52545, 3840, 53185, 52865, 3648, 2560, 51905, 52097, 2880, 51457, 2496, 2176, 51265, 55297, 6336, 6528, 55617, 6912, 56257, 55937, 6720, 7680, 57025, 57217, 8e3, 56577, 7616, 7296, 56385, 5120, 54465, 54657, 5440, 55041, 6080, 5760, 54849, 53761, 4800, 4992, 54081, 4352, 53697, 53377, 4160, 61441, 12480, 12672, 61761, 13056, 62401, 62081, 12864, 13824, 63169, 63361, 14144, 62721, 13760, 13440, 62529, 15360, 64705, 64897, 15680, 65281, 16320, 16e3, 65089, 64001, 15040, 15232, 64321, 14592, 63937, 63617, 14400, 10240, 59585, 59777, 10560, 60161, 11200, 10880, 59969, 60929, 11968, 12160, 61249, 11520, 60865, 60545, 11328, 58369, 9408, 9600, 58689, 9984, 59329, 59009, 9792, 8704, 58049, 58241, 9024, 57601, 8640, 8320, 57409, 40961, 24768, 24960, 41281, 25344, 41921, 41601, 25152, 26112, 42689, 42881, 26432, 42241, 26048, 25728, 42049, 27648, 44225, 44417, 27968, 44801, 28608, 28288, 44609, 43521, 27328, 27520, 43841, 26880, 43457, 43137, 26688, 30720, 47297, 47489, 31040, 47873, 31680, 31360, 47681, 48641, 32448, 32640, 48961, 32e3, 48577, 48257, 31808, 46081, 29888, 30080, 46401, 30464, 47041, 46721, 30272, 29184, 45761, 45953, 29504, 45313, 29120, 28800, 45121, 20480, 37057, 37249, 20800, 37633, 21440, 21120, 37441, 38401, 22208, 22400, 38721, 21760, 38337, 38017, 21568, 39937, 23744, 23936, 40257, 24320, 40897, 40577, 24128, 23040, 39617, 39809, 23360, 39169, 22976, 22656, 38977, 34817, 18624, 18816, 35137, 19200, 35777, 35457, 19008, 19968, 36545, 36737, 20288, 36097, 19904, 19584, 35905, 17408, 33985, 34177, 17728, 34561, 18368, 18048, 34369, 33281, 17088, 17280, 33601, 16640, 33217, 32897, 16448];this.addVbrFrame = function (e) {var t = e.internal_flags,a = t.VBR_seek_table;if (e = V.bitrate_table[e.version][t.bitrate_index], a.nVbrNumFrames++, a.sum += e, a.seen++, !(a.seen < a.want) && (a.pos < a.size && (a.bag[a.pos] = a.sum, a.pos++, a.seen = 0), a.pos == a.size)) {for (e = 1; e < a.size; e += 2) a.bag[e / 2] = a.bag[e];a.want *= 2, a.pos /= 2;}}, this.getVbrTag = function (e) {var t,a = new VBRTagData(),s = 0,n = (a.flags = 0, e[s + 1] >> 3 & 1),_ = e[s + 3] >> 6 & 3,r = e[s + 2] >> 4 & 15,r = V.bitrate_table[n][r];if (a.samprate = (14 == e[s + 1] >> 4 ? V.samplerate_table[2] : V.samplerate_table[n])[e[s + 2] >> 2 & 3], t = s = 0 != n ? 3 != _ ? s + 36 : s + 21 : 3 != _ ? s + 21 : s + 13, !new String(e, t, 4(), null).equals("Xing") && !new String(e, t, 4(), null).equals("Info")) return null;if (s += 4, a.hId = n, t = a.flags = i(e, s), s += 4, 0 != (1 & t) && (a.frames = i(e, s), s += 4), 0 != (2 & t) && (a.bytes = i(e, s), s += 4), 0 != (4 & t)) {if (null != a.toc) for (_ = 0; _ < x; _++) a.toc[_] = e[s + _];s += x;}return a.vbrScale = -1, 0 != (8 & t) && (a.vbrScale = i(e, s), s += 4), a.headersize = 72e3 * (1 + n) * r / a.samprate, n = e[(s += 21) + 0] << 4, r = (15 & e[s + 1]) << 8, ((r += 255 & e[s + 2]) < 0 || 3e3 < r) && (r = -1), a.encDelay = (n += e[s + 1] >> 4) < 0 || 3e3 < n ? -1 : n, a.encPadding = r, a;}, this.InitVbrTag = function (e) {var t,a = e.internal_flags,s = a.sideinfo_len + o;if ((a.VBR_seek_table.TotalFrameSize = t = 72e3 * (e.version + 1) * (e.VBR == m0.vbr_off ? e.brate : 1 == e.version ? 128 : e.out_samplerate < 16e3 ? 32 : 64) / e.out_samplerate) < s || r < t) e.bWriteVbrTag = !1;else for (a.VBR_seek_table.nVbrNumFrames = 0, a.VBR_seek_table.nBytesWritten = 0, a.VBR_seek_table.sum = 0, a.VBR_seek_table.seen = 0, a.VBR_seek_table.want = 1, a.VBR_seek_table.pos = 0, null == a.VBR_seek_table.bag && (a.VBR_seek_table.bag = new int[400](), a.VBR_seek_table.size = 400), T(e, t = new Int8Array(r)), a = a.VBR_seek_table.TotalFrameSize, s = 0; s < a; ++s) k.add_dummy_byte(e, 255 & t[s], 1);}, this.updateMusicCRC = function (e, t, a, s) {for (var n = 0; n < s; ++n) e[0] = E(t[a + n], e[0]);}, this.getLameTagFrame = function (e, t) {var a = e.internal_flags;if (!e.bWriteVbrTag || a.Class_ID != I.LAME_ID || a.VBR_seek_table.pos <= 0) return 0;if (!(t.length < a.VBR_seek_table.TotalFrameSize)) {d0.fill(t, 0, a.VBR_seek_table.TotalFrameSize, 0), T(e, t);var s = new Int8Array(x);if (e.free_format) for (var n = 1; n < x; ++n) s[n] = 255 & 255 * n / 100;else {var _ = a.VBR_seek_table;if (!(_.pos <= 0)) for (n = 1; n < x; ++n) (o = 0 | Math.floor(n / x * _.pos)) > _.pos - 1 && (o = _.pos - 1), 255 < (o = 0 | 256 * _.bag[o] / _.sum) && (o = 255), s[n] = 255 & o;}o = a.sideinfo_len, e.error_protection && (o -= 2), t[o++] = 0, t[o++] = 0, t[o++] = 0, t[o++] = 0, B(t, o, 15), B(t, o += 4, a.VBR_seek_table.nVbrNumFrames), B(t, o += 4, 0 | (_ = a.VBR_seek_table.nBytesWritten + a.VBR_seek_table.TotalFrameSize)), N.arraycopy(s, 0, t, o += 4, s.length), o += s.length, e.error_protection && k.CRC_writeheader(a, t);for (var r = 0, n = 0; n < o; n++) r = E(t[n], r);s = o, n = r;var i = e.internal_flags,o = 0,r = e.encoder_delay,l = e.encoder_padding,f = 100 - 10 * e.VBR_q - e.quality,h = y.getLameVeryShortVersion(),c = [1, 5, 3, 2, 4, 0, 3],b = 0 | (255 < e.lowpassfreq / 100 + .5 ? 255 : e.lowpassfreq / 100 + .5),u = 0,p = 0,m = e.internal_flags.noise_shaping,d = 0 != (1 & e.exp_nspsytune),g = 0 != (2 & e.exp_nspsytune),v = !1,S = e.internal_flags.nogap_total,R = e.internal_flags.nogap_current,M = e.ATHtype;switch (e.VBR) {case vbr_abr:var A = e.VBR_mean_bitrate_kbps;break;case vbr_off:A = e.brate;break;default:A = e.VBR_min_bitrate_kbps;}switch (c = 0 + (e.VBR.ordinal() < c.length ? c[e.VBR.ordinal()] : 0), i.findReplayGain && (510 < i.RadioGain && (i.RadioGain = 510), i.RadioGain < -510 && (i.RadioGain = -510), p = 11264, p = 0 <= i.RadioGain ? p | i.RadioGain : 512 | p | -i.RadioGain), i.findPeakSample && (u = Math.abs(0 | i.PeakSample / 32767 * Math.pow(2, 23) + .5)), d = M + ((d ? 1 : 0) << 4) + ((g ? 1 : 0) << 5) + ((-1 != S && (0 < R && (v = !0), R < S - 1) ? 1 : 0) << 6) + ((v ? 1 : 0) << 7), f < 0 && (f = 0), e.mode) {case MONO:g = 0;break;case STEREO:g = 1;break;case DUAL_CHANNEL:g = 2;break;case JOINT_STEREO:g = e.force_ms ? 4 : 3;break;default:g = 7;}for (m = m + (g << 2) + ((e.short_blocks == $0.short_block_forced || e.short_blocks == $0.short_block_dispensed || -1 == e.lowpassfreq && -1 == e.highpassfreq || e.scale_left < e.scale_right || e.scale_right < e.scale_left || e.disable_reservoir && e.brate < 320 || e.noATH || e.ATHonly || 0 == M || e.in_samplerate <= 32e3 ? 1 : 0) << 5) + ((e.in_samplerate <= 32e3 ? 0 : 48e3 == e.in_samplerate ? 2 : 48e3 < e.in_samplerate ? 3 : 1) << 6), i = i.nMusicCRC, B(t, s + o, f), o += 4, f = 0; f < 9; f++) t[s + o + f] = 255 & h.charAt(f);for (t[s + (o += 9)] = 255 & c, t[s + ++o] = 255 & b, B(t, s + ++o, u), w(t, s + (o += 4), p), w(t, s + (o += 2), 0), t[s + (o += 2)] = 255 & d, t[s + ++o] = 255 <= A ? 255 : 255 & A, t[s + ++o] = 255 & r >> 4, t[s + o + 1] = 255 & (r << 4) + (l >> 8), t[s + o + 2] = 255 & l, t[s + (o += 3)] = 255 & m, o++, t[s + o++] = 0, w(t, s + o, e.preset), B(t, s + (o += 2), _), w(t, s + (o += 4), i), o += 2, e = 0; e < o; e++) n = E(t[s + e], n);w(t, s + o, n);}return a.VBR_seek_table.TotalFrameSize;}, this.putVbrTag = function (e, t) {if (e.internal_flags.VBR_seek_table.pos <= 0) return -1;if (t.seek(t.length()), 0 == t.length()) return -1;t.seek(0);var a = new Int8Array(10);return t.readFully(a), a = new String(a, "ISO-8859-1").startsWith("ID3") ? 0 : ((127 & a[6]) << 21 | (127 & a[7]) << 14 | (127 & a[8]) << 7 | 127 & a[9]) + a.length, t.seek(a), a = new Int8Array(r), (e = getLameTagFrame(e, a)) > a.length ? -1 : (e < 1 || t.write(a, 0, e), 0);};}function e(e, t, a, s) {this.xlen = e, this.linmax = t, this.table = a, this.hlen = s;}function T(e) {this.bits = e;}function t() {this.setModules = function (e, t) {};}function O() {this.bits = this.over_SSD = this.over_count = this.max_noise = this.tot_noise = this.over_noise = 0;}function _() {this.scale_right = this.scale_left = this.scale = this.out_samplerate = this.in_samplerate = this.num_channels = this.num_samples = this.class_id = 0, this.decode_only = this.bWriteVbrTag = this.analysis = !1, this.quality = 0, this.mode = ee.STEREO, this.write_id3tag_automatic = this.decode_on_the_fly = this.findReplayGain = this.free_format = this.force_ms = !1, this.error_protection = this.emphasis = this.extension = this.original = this.copyright = this.compression_ratio = this.brate = 0, this.disable_reservoir = this.strict_ISO = !1, this.quant_comp_short = this.quant_comp = 0, this.experimentalY = !1, this.preset = this.exp_nspsytune = this.experimentalZ = 0, this.VBR = null, this.maskingadjust_short = this.maskingadjust = this.highpasswidth = this.lowpasswidth = this.highpassfreq = this.lowpassfreq = this.VBR_hard_min = this.VBR_max_bitrate_kbps = this.VBR_min_bitrate_kbps = this.VBR_mean_bitrate_kbps = this.VBR_q = this.VBR_q_frac = 0, this.noATH = this.ATHshort = this.ATHonly = !1, this.athaa_sensitivity = this.athaa_loudapprox = this.athaa_type = this.ATHlower = this.ATHcurve = this.ATHtype = 0, this.short_blocks = null, this.useTemporal = !1, this.msfix = this.interChRatio = 0, this.tune = !1, this.lame_allocated_gfp = this.frameNum = this.framesize = this.encoder_padding = this.encoder_delay = this.version = this.tune_value_a = 0, this.internal_flags = null;}function X() {this.linprebuf = W0(2 * r1.MAX_ORDER), this.linpre = 0, this.lstepbuf = W0(r1.MAX_SAMPLES_PER_WINDOW + r1.MAX_ORDER), this.lstep = 0, this.loutbuf = W0(r1.MAX_SAMPLES_PER_WINDOW + r1.MAX_ORDER), this.lout = 0, this.rinprebuf = W0(2 * r1.MAX_ORDER), this.rinpre = 0, this.rstepbuf = W0(r1.MAX_SAMPLES_PER_WINDOW + r1.MAX_ORDER), this.rstep = 0, this.routbuf = W0(r1.MAX_SAMPLES_PER_WINDOW + r1.MAX_ORDER), this.first = this.freqindex = this.rsum = this.lsum = this.totsamp = this.sampleWindow = this.rout = 0, this.A = U0(0 | r1.STEPS_per_dB * r1.MAX_dB), this.B = U0(0 | r1.STEPS_per_dB * r1.MAX_dB);}function Y(e) {this.quantize = e, this.iteration_loop = function (e, t, a, s) {var n = e.internal_flags,_ = W0(D.SFBMAX),r = W0(576),i = U0(2),o = n.l3_side,l = new T(0);this.quantize.rv.ResvFrameBegin(e, l);for (var l = l.bits, f = 0; f < n.mode_gr; f++) {var h = this.quantize.qupvt.on_pe(e, t, i, l, f, f);for (n.mode_ext == te.MPG_MD_MS_LR && (this.quantize.ms_convert(n.l3_side, f), this.quantize.qupvt.reduce_side(i, a[f], l, h)), h = 0; h < n.channels_out; h++) {var c = o.tt[f][h],b = c.block_type != te.SHORT_TYPE ? +n.PSY.mask_adjust : +n.PSY.mask_adjust_short;n.masking_lower = Math.pow(10, .1 * b), this.quantize.init_outer_loop(n, c), this.quantize.init_xrpow(n, c, r) && (this.quantize.qupvt.calc_xmin(e, s[f][h], c, _), this.quantize.outer_loop(e, c, _, r, h, i[h])), this.quantize.iteration_finish_one(n, f, h);}}this.quantize.rv.ResvFrameEnd(n, l);};}function q() {this.floor = this.decay = this.adjustLimit = this.adjust = this.aaSensitivityP = this.useAdjust = 0, this.l = W0(te.SBMAX_l), this.s = W0(te.SBMAX_s), this.psfb21 = W0(te.PSFB21), this.psfb12 = W0(te.PSFB12), this.cb_l = W0(te.CBANDS), this.cb_s = W0(te.CBANDS), this.eql_w = W0(te.BLKSIZE / 2);}function a(e, t, a, s) {this.l = U0(1 + te.SBMAX_l), this.s = U0(1 + te.SBMAX_s), this.psfb21 = U0(1 + te.PSFB21), this.psfb12 = U0(1 + te.PSFB12);var n = this.l,_ = this.s;4 == arguments.length && (this.arrL = e, this.arrS = t, this.arr21 = a, this.arr12 = s, N.arraycopy(this.arrL, 0, n, 0, Math.min(this.arrL.length, this.l.length)), N.arraycopy(this.arrS, 0, _, 0, Math.min(this.arrS.length, this.s.length)), N.arraycopy(this.arr21, 0, this.psfb21, 0, Math.min(this.arr21.length, this.psfb21.length)), N.arraycopy(this.arr12, 0, this.psfb12, 0, Math.min(this.arr12.length, this.psfb12.length)));}function k() {function c(e, t) {return t = s.ATHformula(t, e), Math.pow(10, (t - 100) / 10 + e.ATHlower);}function g(e) {this.s = e;}var b = null,h = null,s = null,u = (this.setModules = function (e, t, a) {b = e, h = t, s = a;}, this.IPOW20 = function (e) {return d[e];}, k.IXMAX_VAL + 2),p = k.Q_MAX,m = k.Q_MAX2,S = (this.nr_of_sfb_block = [[[6, 5, 5, 5], [9, 9, 9, 9], [6, 9, 9, 9]], [[6, 5, 7, 3], [9, 9, 12, 6], [6, 9, 12, 6]], [[11, 10, 0, 0], [18, 18, 0, 0], [15, 18, 0, 0]], [[7, 7, 7, 0], [12, 12, 12, 0], [6, 15, 12, 0]], [[6, 6, 6, 3], [12, 9, 9, 6], [6, 12, 9, 6]], [[8, 8, 5, 0], [15, 12, 9, 0], [6, 18, 9, 0]]], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 3, 3, 3, 2, 0]),v = (this.pretab = S, this.sfBandIndex = [new a([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 24, 32, 42, 56, 74, 100, 132, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 114, 136, 162, 194, 232, 278, 332, 394, 464, 540, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 136, 180, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 134, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 4, 8, 12, 16, 20, 24, 30, 36, 44, 52, 62, 74, 90, 110, 134, 162, 196, 238, 288, 342, 418, 576], [0, 4, 8, 12, 16, 22, 30, 40, 52, 66, 84, 106, 136, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 4, 8, 12, 16, 20, 24, 30, 36, 42, 50, 60, 72, 88, 106, 128, 156, 190, 230, 276, 330, 384, 576], [0, 4, 8, 12, 16, 22, 28, 38, 50, 64, 80, 100, 126, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 4, 8, 12, 16, 20, 24, 30, 36, 44, 54, 66, 82, 102, 126, 156, 194, 240, 296, 364, 448, 550, 576], [0, 4, 8, 12, 16, 22, 30, 42, 58, 78, 104, 138, 180, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 134, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 134, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new a([0, 12, 24, 36, 48, 60, 72, 88, 108, 132, 160, 192, 232, 280, 336, 400, 476, 566, 568, 570, 572, 574, 576], [0, 8, 16, 24, 36, 52, 72, 96, 124, 160, 162, 164, 166, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0])], W0(p + m + 1)),d = W0(p),R = W0(u),M = W0(u);this.adj43 = M, this.iteration_init = function (e) {var t = e.internal_flags,a = t.l3_side;if (0 == t.iteration_init_init) {t.iteration_init_init = 1, a.main_data_begin = 0;for (var a = e.internal_flags.ATH.l, s = e.internal_flags.ATH.psfb21, n = e.internal_flags.ATH.s, _ = e.internal_flags.ATH.psfb12, r = e.internal_flags, i = e.out_samplerate, o = 0; o < te.SBMAX_l; o++) {var l = r.scalefac_band.l[o],f = r.scalefac_band.l[o + 1];for (a[o] = H.MAX_VALUE; l < f; l++) {var h = c(e, h = l * i / 1152);a[o] = Math.min(a[o], h);}}for (o = 0; o < te.PSFB21; o++) for (l = r.scalefac_band.psfb21[o], f = r.scalefac_band.psfb21[o + 1], s[o] = H.MAX_VALUE; l < f; l++) h = c(e, h = l * i / 1152), s[o] = Math.min(s[o], h);for (o = 0; o < te.SBMAX_s; o++) {for (l = r.scalefac_band.s[o], f = r.scalefac_band.s[o + 1], n[o] = H.MAX_VALUE; l < f; l++) h = c(e, h = l * i / 384), n[o] = Math.min(n[o], h);n[o] *= r.scalefac_band.s[o + 1] - r.scalefac_band.s[o];}for (o = 0; o < te.PSFB12; o++) {for (l = r.scalefac_band.psfb12[o], f = r.scalefac_band.psfb12[o + 1], _[o] = H.MAX_VALUE; l < f; l++) h = c(e, h = l * i / 384), _[o] = Math.min(_[o], h);_[o] *= r.scalefac_band.s[13] - r.scalefac_band.s[12];}if (e.noATH) {for (o = 0; o < te.SBMAX_l; o++) a[o] = 1e-20;for (o = 0; o < te.PSFB21; o++) s[o] = 1e-20;for (o = 0; o < te.SBMAX_s; o++) n[o] = 1e-20;for (o = 0; o < te.PSFB12; o++) _[o] = 1e-20;}for (r.ATH.floor = 10 * Math.log10(c(e, -1)), R[0] = 0, a = 1; a < u; a++) R[a] = Math.pow(a, 4 / 3);for (a = 0; a < u - 1; a++) M[a] = a + 1 - Math.pow(.5 * (R[a] + R[a + 1]), .75);for (M[a] = .5, a = 0; a < p; a++) d[a] = Math.pow(2, -.1875 * (a - 210));for (a = 0; a <= p + m; a++) v[a] = Math.pow(2, .25 * (a - 210 - m));for (b.huffman_init(t), 32 <= (a = e.exp_nspsytune >> 2 & 63) && (a -= 64), s = Math.pow(10, a / 4 / 10), 32 <= (a = e.exp_nspsytune >> 8 & 63) && (a -= 64), n = Math.pow(10, a / 4 / 10), 32 <= (a = e.exp_nspsytune >> 14 & 63) && (a -= 64), _ = Math.pow(10, a / 4 / 10), 32 <= (a = e.exp_nspsytune >> 20 & 63) && (a -= 64), e = _ * Math.pow(10, a / 4 / 10), a = 0; a < te.SBMAX_l; a++) t.nsPsy.longfact[a] = r = a <= 6 ? s : a <= 13 ? n : a <= 20 ? _ : e;for (a = 0; a < te.SBMAX_s; a++) t.nsPsy.shortfact[a] = r = a <= 5 ? s : a <= 10 ? n : a <= 11 ? _ : e;}}, this.on_pe = function (e, t, a, s, n, _) {var r,i = e.internal_flags,o = U0(2),l = new T(0),f = (e = h.ResvMaxBits(e, s, l, _), (l = l.bits) + e);for (o1.MAX_BITS_PER_GRANULE < f && (f = o1.MAX_BITS_PER_GRANULE), r = _ = 0; r < i.channels_out; ++r) a[r] = Math.min(o1.MAX_BITS_PER_CHANNEL, l / i.channels_out), o[r] = 0 | a[r] * t[n][r] / 700 - a[r], o[r] > 3 * s / 4 && (o[r] = 3 * s / 4), o[r] < 0 && (o[r] = 0), o[r] + a[r] > o1.MAX_BITS_PER_CHANNEL && (o[r] = Math.max(0, o1.MAX_BITS_PER_CHANNEL - a[r])), _ += o[r];if (e < _) for (r = 0; r < i.channels_out; ++r) o[r] = e * o[r] / _;for (r = 0; r < i.channels_out; ++r) a[r] += o[r], e -= o[r];for (r = _ = 0; r < i.channels_out; ++r) _ += a[r];if (o1.MAX_BITS_PER_GRANULE < _) for (r = 0; r < i.channels_out; ++r) a[r] *= o1.MAX_BITS_PER_GRANULE, a[r] /= _;return f;}, this.reduce_side = function (e, t, a, s) {t = 0 | .5 * (t = .5 < (t = (t = .33 * (.5 - t) / .5) < 0 ? 0 : t) ? .5 : t) * (e[0] + e[1]), (t = o1.MAX_BITS_PER_CHANNEL - e[0] < t ? o1.MAX_BITS_PER_CHANNEL - e[0] : t) < 0 && (t = 0), 125 <= e[1] && (125 < e[1] - t ? (e[0] < a && (e[0] += t), e[1] -= t) : (e[0] += e[1] - 125, e[1] = 125)), s < (t = e[0] + e[1]) && (e[0] = s * e[0] / t, e[1] = s * e[1] / t);}, this.athAdjust = function (e, t, a) {t = ae.FAST_LOG10_X(t, 10);var s = 0;return t -= a, (s = 1e-20 < (e *= e) ? 1 + ae.FAST_LOG10_X(e, 10 / 90.30873362) : s) < 0 && (s = 0), Math.pow(10, .1 * (t * s + (a + 90.30873362 - 94.82444863)));}, this.calc_xmin = function (e, t, a, s) {for (var n = 0, _ = e.internal_flags, r = 0, i = 0, o = _.ATH, l = a.xr, f = e.VBR == m0.vbr_mtrh ? 1 : 0, h = e.VBR != m0.vbr_mtrh && e.VBR != m0.vbr_mt ? _.masking_lower : 1, c = 0; c < a.psy_lmax; c++) {var b = e.VBR == m0.vbr_rh || e.VBR == m0.vbr_mtrh ? athAdjust(o.adjust, o.l[c], o.floor) : o.adjust * o.l[c],u = b / (R = a.width[c]),p = 2220446049250313e-31,m = R >> 1,d = 0;do {var g = l[r] * l[r];} while (p += g < u ? g : u, d = (d += g) + (g = l[++r] * l[r]), p += g < u ? g : u, r++, 0 < --m);b < d && i++, c == te.SBPSY_l && p < (u = b * _.nsPsy.longfact[c]) && (p = u), 0 != f && (b = p), e.ATHonly || 0 < (p = t.en.l[c]) && (u = d * t.thm.l[c] * h / p, 0 != f && (u *= _.nsPsy.longfact[c]), b < u) && (b = u), s[n++] = 0 != f ? b : b * _.nsPsy.longfact[c];}if (d = 575, a.block_type != te.SHORT_TYPE) for (b = 576; 0 != b-- && i1.EQ(l[b], 0);) d = b;a.max_nonzero_coeff = d;for (var v = a.sfb_smin; c < a.psymax; v++, c += 3) {for (var S = e.VBR == m0.vbr_rh || e.VBR == m0.vbr_mtrh ? athAdjust(o.adjust, o.s[v], o.floor) : o.adjust * o.s[v], R = a.width[c], M = 0; M < 3; M++) {for (d = 0, m = R >> 1, u = S / R, p = 2220446049250313e-31; p += (g = l[r] * l[r]) < u ? g : u, d = (d += g) + (g = l[++r] * l[r]), p += g < u ? g : u, r++, 0 < --m;);S < d && i++, v == te.SBPSY_s && p < (u = S * _.nsPsy.shortfact[v]) && (p = u), b = 0 != f ? p : S, e.ATHonly || e.ATHshort || 0 < (p = t.en.s[v][M]) && (u = d * t.thm.s[v][M] * h / p, 0 != f && (u *= _.nsPsy.shortfact[v]), b < u) && (b = u), s[n++] = 0 != f ? b : b * _.nsPsy.shortfact[v];}e.useTemporal && (s[n - 3] > s[n - 3 + 1] && (s[n - 3 + 1] += (s[n - 3] - s[n - 3 + 1]) * _.decay), s[n - 3 + 2] < s[n - 3 + 1]) && (s[n - 3 + 2] += (s[n - 3 + 1] - s[n - 3 + 2]) * _.decay);}return i;}, this.calc_noise_core = function (e, t, a, s) {var n = 0,_ = t.s,r = e.l3_enc;if (e.count1 < _) for (; 0 != a--;) {var i = e.xr[_];n += i * i, i = e.xr[++_], _++, n += i * i;} else if (e.big_values < _) {var o = W0(2);for (o[0] = 0, o[1] = s; 0 != a--;) i = Math.abs(e.xr[_]) - o[r[_]], _++, n += i * i, i = Math.abs(e.xr[_]) - o[r[_]], _++, n += i * i;} else for (; 0 != a--;) i = Math.abs(e.xr[_]) - R[r[_]] * s, _++, n += i * i, i = Math.abs(e.xr[_]) - R[r[_]] * s, _++, n += i * i;return t.s = _, n;}, this.calc_noise = function (e, t, a, s, n) {for (var _ = 0, r = 0, i = 0, o = 0, l = 0, f = -20, h = 0, c = e.scalefac, b = 0, u = s.over_SSD = 0; u < e.psymax; u++) {var p,m,d = e.global_gain - (c[b++] + (0 != e.preflag ? S[u] : 0) << e.scalefac_scale + 1) - 8 * e.subblock_gain[e.window[u]];null != n && n.step[u] == d ? (p = n.noise[u], h += e.width[u], a[_++] = p / t[r++], p = n.noise_log[u]) : (p = v[d + k.Q_MAX2], m = e.width[u] >> 1, h + e.width[u] > e.max_nonzero_coeff && (m = 0 < (m = e.max_nonzero_coeff - h + 1) ? m >> 1 : 0), h = new g(h), p = this.calc_noise_core(e, h, m, p), h = h.s, null != n && (n.step[u] = d, n.noise[u] = p), p = a[_++] = p / t[r++], p = ae.FAST_LOG10(Math.max(p, 1e-20)), null != n && (n.noise_log[u] = p)), null != n && (n.global_gain = e.global_gain), l += p, 0 < p && (d = Math.max(0 | 10 * p + .5, 1), s.over_SSD += d * d, i++, o += p), f = Math.max(f, p);}return s.over_count = i, s.tot_noise = l, s.over_noise = o, s.max_noise = f, i;}, this.set_pinfo = function (e, t, a, s, n) {var _,r = e.internal_flags,i = 0 == t.scalefac_scale ? .5 : 1,o = t.scalefac,l = W0(D.SFBMAX),f = W0(D.SFBMAX),h = new O(),c = (calc_xmin(e, a, t, l), calc_noise(t, l, f, h, null), 0),b = t.sfb_lmax;for (t.block_type != te.SHORT_TYPE && 0 == t.mixed_block_flag && (b = 22), _ = 0; _ < b; _++) {for (var u = r.scalefac_band.l[_], p = r.scalefac_band.l[_ + 1], m = p - u, d = 0; c < p; c++) d += t.xr[c] * t.xr[c];d /= m;var g = 1e15;r.pinfo.en[s][n][_] = g * d, r.pinfo.xfsf[s][n][_] = g * l[_] * f[_] / m, d = 0 < a.en.l[_] && !e.ATHonly ? d / a.en.l[_] : 0, r.pinfo.thr[s][n][_] = g * Math.max(d * a.thm.l[_], r.ATH.l[_]), (r.pinfo.LAMEsfb[s][n][_] = 0) != t.preflag && 11 <= _ && (r.pinfo.LAMEsfb[s][n][_] = -i * S[_]), _ < te.SBPSY_l && (r.pinfo.LAMEsfb[s][n][_] -= i * o[_]);}if (t.block_type == te.SHORT_TYPE) for (b = _, _ = t.sfb_smin; _ < te.SBMAX_s; _++) for (var u = r.scalefac_band.s[_], m = (p = r.scalefac_band.s[_ + 1]) - u, v = 0; v < 3; v++) {for (d = 0, g = u; g < p; g++) d += t.xr[c] * t.xr[c], c++;d = Math.max(d / m, 1e-20), r.pinfo.en_s[s][n][3 * _ + v] = (g = 1e15) * d, r.pinfo.xfsf_s[s][n][3 * _ + v] = g * l[b] * f[b] / m, d = 0 < a.en.s[_][v] ? d / a.en.s[_][v] : 0, (e.ATHonly || e.ATHshort) && (d = 0), r.pinfo.thr_s[s][n][3 * _ + v] = g * Math.max(d * a.thm.s[_][v], r.ATH.s[_]), r.pinfo.LAMEsfb_s[s][n][3 * _ + v] = -2 * t.subblock_gain[v], _ < te.SBPSY_s && (r.pinfo.LAMEsfb_s[s][n][3 * _ + v] -= i * o[b]), b++;}r.pinfo.LAMEqss[s][n] = t.global_gain, r.pinfo.LAMEmainbits[s][n] = t.part2_3_length + t.part2_length, r.pinfo.LAMEsfbits[s][n] = t.part2_length, r.pinfo.over[s][n] = h.over_count, r.pinfo.max_noise[s][n] = 10 * h.max_noise, r.pinfo.over_noise[s][n] = 10 * h.over_noise, r.pinfo.tot_noise[s][n] = 10 * h.tot_noise, r.pinfo.over_SSD[s][n] = h.over_SSD;};}function C() {this.sfb_count1 = this.global_gain = 0, this.step = U0(39), this.noise = W0(39), this.noise_log = W0(39);}function L() {this.xr = W0(576), this.l3_enc = U0(576), this.scalefac = U0(D.SFBMAX), this.mixed_block_flag = this.block_type = this.scalefac_compress = this.global_gain = this.count1 = this.big_values = this.part2_3_length = this.xrpow_max = 0, this.table_select = U0(3), this.subblock_gain = U0(4), this.sfbdivide = this.psymax = this.sfbmax = this.psy_lmax = this.sfb_smin = this.sfb_lmax = this.part2_length = this.count1table_select = this.scalefac_scale = this.preflag = this.region1_count = this.region0_count = 0, this.width = U0(D.SFBMAX), this.window = U0(D.SFBMAX), this.count1bits = 0, this.sfb_partition_table = null, this.slen = U0(4), this.max_nonzero_coeff = 0;var t = this;this.assign = function (e) {t.xr = new Float32Array(e.xr), t.l3_enc = new Int32Array(e.l3_enc), t.scalefac = new Int32Array(e.scalefac), t.xrpow_max = e.xrpow_max, t.part2_3_length = e.part2_3_length, t.big_values = e.big_values, t.count1 = e.count1, t.global_gain = e.global_gain, t.scalefac_compress = e.scalefac_compress, t.block_type = e.block_type, t.mixed_block_flag = e.mixed_block_flag, t.table_select = new Int32Array(e.table_select), t.subblock_gain = new Int32Array(e.subblock_gain), t.region0_count = e.region0_count, t.region1_count = e.region1_count, t.preflag = e.preflag, t.scalefac_scale = e.scalefac_scale, t.count1table_select = e.count1table_select, t.part2_length = e.part2_length, t.sfb_lmax = e.sfb_lmax, t.sfb_smin = e.sfb_smin, t.psy_lmax = e.psy_lmax, t.sfbmax = e.sfbmax, t.psymax = e.psymax, t.sfbdivide = e.sfbdivide, t.width = new Int32Array(e.width), t.window = new Int32Array(e.window), t.count1bits = e.count1bits, t.sfb_partition_table = e.sfb_partition_table.slice(0), t.slen = new Int32Array(e.slen), t.max_nonzero_coeff = e.max_nonzero_coeff;};}function F() {function P(e) {this.ordinal = e;}function I(e) {for (var t = 0; t < e.sfbmax; t++) if (0 == e.scalefac[t] + e.subblock_gain[e.window[t]]) return !1;return !0;}var b, d;this.rv = null, this.qupvt = null;var H,V,n = new t();this.setModules = function (e, t, a, s) {b = e, this.rv = d = t, this.qupvt = H = a, V = s, n.setModules(H, V);}, this.ms_convert = function (e, t) {for (var a = 0; a < 576; ++a) {var s = e.tt[t][0].xr[a],n = e.tt[t][1].xr[a];e.tt[t][0].xr[a] = .5 * (s + n) * ae.SQRT2, e.tt[t][1].xr[a] = .5 * (s - n) * ae.SQRT2;}}, this.init_xrpow = function (e, t, a) {var s = 0 | t.max_nonzero_coeff;d0.fill(a, s, 576, t.xrpow_max = 0);for (var n, _ = n = 0; _ <= s; ++_) {var r = Math.abs(t.xr[_]);n += r, a[_] = Math.sqrt(r * Math.sqrt(r)), a[_] > t.xrpow_max && (t.xrpow_max = a[_]);}if (1e-20 < n) {for ((a = 0) != (2 & e.substep_shaping) && (a = 1), s = 0; s < t.psymax; s++) e.pseudohalf[s] = a;return !0;}return d0.fill(t.l3_enc, 0, 576, 0), !1;}, this.init_outer_loop = function (e, t) {t.part2_3_length = 0, t.big_values = 0, t.count1 = 0, t.global_gain = 210, t.scalefac_compress = 0, t.table_select[0] = 0, t.table_select[1] = 0, t.table_select[2] = 0, t.subblock_gain[0] = 0, t.subblock_gain[1] = 0, t.subblock_gain[2] = 0, t.subblock_gain[3] = 0, t.region0_count = 0, t.region1_count = 0, t.preflag = 0, t.scalefac_scale = 0, t.count1table_select = 0, t.part2_length = 0, t.sfb_lmax = te.SBPSY_l, t.sfb_smin = te.SBPSY_s, t.psy_lmax = e.sfb21_extra ? te.SBMAX_l : te.SBPSY_l, t.psymax = t.psy_lmax, t.sfbmax = t.sfb_lmax, t.sfbdivide = 11;for (var a = 0; a < te.SBMAX_l; a++) t.width[a] = e.scalefac_band.l[a + 1] - e.scalefac_band.l[a], t.window[a] = 3;if (t.block_type == te.SHORT_TYPE) {var s = W0(576),n = (t.sfb_smin = 0, (t.sfb_lmax = 0) != t.mixed_block_flag && (t.sfb_smin = 3, t.sfb_lmax = 2 * e.mode_gr + 4), t.psymax = t.sfb_lmax + 3 * ((e.sfb21_extra ? te.SBMAX_s : te.SBPSY_s) - t.sfb_smin), t.sfbmax = t.sfb_lmax + 3 * (te.SBPSY_s - t.sfb_smin), t.sfbdivide = t.sfbmax - 18, t.psy_lmax = t.sfb_lmax, e.scalefac_band.l[t.sfb_lmax]);for (N.arraycopy(t.xr, 0, s, 0, 576), a = t.sfb_smin; a < te.SBMAX_s; a++) for (var _ = e.scalefac_band.s[a], r = e.scalefac_band.s[a + 1], i = 0; i < 3; i++) for (var o = _; o < r; o++) t.xr[n++] = s[3 * o + i];for (s = t.sfb_lmax, a = t.sfb_smin; a < te.SBMAX_s; a++) t.width[s] = t.width[s + 1] = t.width[s + 2] = e.scalefac_band.s[a + 1] - e.scalefac_band.s[a], t.window[s] = 0, t.window[s + 1] = 1, t.window[s + 2] = 2, s += 3;}if (t.count1bits = 0, t.sfb_partition_table = H.nr_of_sfb_block[0][0], t.slen[0] = 0, t.slen[1] = 0, t.slen[2] = 0, t.slen[3] = 0, t.max_nonzero_coeff = 575, d0.fill(t.scalefac, 0), a = e.ATH, s = t.xr, t.block_type != te.SHORT_TYPE) for (t = !1, n = te.PSFB21 - 1; 0 <= n && !t; n--) for (_ = e.scalefac_band.psfb21[n], r = e.scalefac_band.psfb21[n + 1], i = H.athAdjust(a.adjust, a.psfb21[n], a.floor), 1e-12 < e.nsPsy.longfact[21] && (i *= e.nsPsy.longfact[21]), --r; _ <= r; r--) {if (!(Math.abs(s[r]) < i)) {t = !0;break;}s[r] = 0;} else for (i = 0; i < 3; i++) for (t = !1, n = te.PSFB12 - 1; 0 <= n && !t; n--) for (r = (_ = 3 * e.scalefac_band.s[12] + (e.scalefac_band.s[13] - e.scalefac_band.s[12]) * i + (e.scalefac_band.psfb12[n] - e.scalefac_band.psfb12[0])) + (e.scalefac_band.psfb12[n + 1] - e.scalefac_band.psfb12[n]), o = H.athAdjust(a.adjust, a.psfb12[n], a.floor), 1e-12 < e.nsPsy.shortfact[12] && (o *= e.nsPsy.shortfact[12]), --r; _ <= r; r--) {if (!(Math.abs(s[r]) < o)) {t = !0;break;}s[r] = 0;}}, P.BINSEARCH_NONE = new P(0), P.BINSEARCH_UP = new P(1), P.BINSEARCH_DOWN = new P(2), this.trancate_smallspectrums = function (e, t, a, s) {var n = W0(D.SFBMAX);if ((0 != (4 & e.substep_shaping) || t.block_type != te.SHORT_TYPE) && 0 == (128 & e.substep_shaping)) {H.calc_noise(t, a, n, new O(), null);for (var _ = 0; _ < 576; _++) {var r = 0;0 != t.l3_enc[_] && (r = Math.abs(t.xr[_])), s[_] = r;}_ = 0, r = 8, t.block_type == te.SHORT_TYPE && (r = 6);do {var i,o,l = t.width[r];if (_ += l, !(1 <= n[r] || (d0.sort(s, _ - l, l), i1.EQ(s[_ - 1], 0)))) {var f = (1 - n[r]) * a[r],h = i = 0;do {for (o = 1; h + o < l && !i1.NEQ(s[h + _ - l], s[h + _ + o - l]); o++);var c = s[h + _ - l] * s[h + _ - l] * o;if (f < c) {0 != h && (i = s[h + _ - l - 1]);break;}} while (f -= c, (h += o) < l);if (!i1.EQ(i, 0)) for (; Math.abs(t.xr[_ - l]) <= i && (t.l3_enc[_ - l] = 0), 0 < --l;);}} while (++r < t.psymax);t.part2_3_length = V.noquant_count_bits(e, t, null);}}, this.outer_loop = function (e, t, a, s, n, _) {var r,i = e.internal_flags,o = new L(),l = W0(576),f = W0(D.SFBMAX),h = new O(),c = new C(),b = 9999999,u = !1,p = !1,m = 0,d = i.CurrentStep[n],g = !1,v = i.OldValue[n],S = P.BINSEARCH_NONE;for (t.global_gain = v, r = _ - t.part2_length;;) {var R = V.count_bits(i, s, t, null);if (1 == d || R == r) break;R = r < R ? ((g = S == P.BINSEARCH_DOWN || g) && (d /= 2), S = P.BINSEARCH_UP, d) : ((g = S == P.BINSEARCH_UP || g) && (d /= 2), S = P.BINSEARCH_DOWN, -d), t.global_gain += R, t.global_gain < 0 && (g = !(t.global_gain = 0)), 255 < t.global_gain && (t.global_gain = 255, g = !0);}for (; r < R && t.global_gain < 255;) t.global_gain++, R = V.count_bits(i, s, t, null);if (i.CurrentStep[n] = 4 <= v - t.global_gain ? 4 : 2, i.OldValue[n] = t.global_gain, t.part2_3_length = R, 0 == i.noise_shaping) return 100;for (H.calc_noise(t, a, f, h, c), h.bits = t.part2_3_length, o.assign(t), N.arraycopy(s, n = 0, l, 0, 576); !u;) {do {if (r = new O(), g = 255, d = 0 != (2 & i.substep_shaping) ? 20 : 3, i.sfb21_extra) {if (1 < f[o.sfbmax]) break;if (o.block_type == te.SHORT_TYPE && (1 < f[o.sfbmax + 1] || 1 < f[o.sfbmax + 2])) break;}for (var v = o, R = s, S = e.internal_flags, M = v, A = f, B = R, w = e.internal_flags, T = 0 == M.scalefac_scale ? 1.2968395546510096 : 1.6817928305074292, E = 0, k = 0; k < M.sfbmax; k++) E < A[k] && (E = A[k]);switch (k = 3 == (k = w.noise_shaping_amp) ? p ? 2 : 1 : k) {case 2:break;case 1:E = 1 < E ? Math.pow(E, .5) : .95 * E;break;default:E = 1 < E ? 1 : .95 * E;}for (var y = 0, k = 0; k < M.sfbmax; k++) {var x = M.width[k];if (y += x, !(A[k] < E)) {if (0 != (2 & w.substep_shaping) && (w.pseudohalf[k] = 0 == w.pseudohalf[k] ? 1 : 0, 0 == w.pseudohalf[k]) && 2 == w.noise_shaping_amp) break;for (M.scalefac[k]++, x = -x; x < 0; x++) B[y + x] *= T, B[y + x] > M.xrpow_max && (M.xrpow_max = B[y + x]);if (2 == w.noise_shaping_amp) break;}}if (T = I(v)) v = !1;else if (T = 2 == S.mode_gr ? V.scale_bitcount(v) : V.scale_bitcount_lsf(S, v)) {if (1 < S.noise_shaping) if (d0.fill(S.pseudohalf, 0), 0 == v.scalefac_scale) {for (T = v, A = M = 0; A < T.sfbmax; A++) {if (w = T.width[A], B = T.scalefac[A], 0 != T.preflag && (B += H.pretab[A]), M += w, 0 != (1 & B)) for (B++, w = -w; w < 0; w++) R[M + w] *= 1.2968395546510096, R[M + w] > T.xrpow_max && (T.xrpow_max = R[M + w]);T.scalefac[A] = B >> 1;}T.preflag = 0, T.scalefac_scale = 1, T = !1;} else if (v.block_type == te.SHORT_TYPE && 0 < S.subblock_gain) {e: {for (T = S, A = R, B = (M = v).scalefac, R = 0; R < M.sfb_lmax; R++) if (16 <= B[R]) {R = !0;break e;}for (w = 0; w < 3; w++) {for (k = E = 0, R = M.sfb_lmax + w; R < M.sfbdivide; R += 3) E < B[R] && (E = B[R]);for (; R < M.sfbmax; R += 3) k < B[R] && (k = B[R]);if (!(E < 16 && k < 8)) {if (7 <= M.subblock_gain[w]) {R = !0;break e;}for (M.subblock_gain[w]++, E = T.scalefac_band.l[M.sfb_lmax], R = M.sfb_lmax + w; R < M.sfbmax; R += 3) if (k = M.width[R], y = B[R], 0 <= (y -= 4 >> M.scalefac_scale)) B[R] = y, E += 3 * k;else {for (B[R] = 0, y = H.IPOW20(210 + (y << M.scalefac_scale + 1)), E += k * (w + 1), x = -k; x < 0; x++) A[E + x] *= y, A[E + x] > M.xrpow_max && (M.xrpow_max = A[E + x]);E += k * (3 - w - 1);}for (y = H.IPOW20(202), E += M.width[R] * (w + 1), x = -M.width[R]; x < 0; x++) A[E + x] *= y, A[E + x] > M.xrpow_max && (M.xrpow_max = A[E + x]);}}R = !1;}T = R || I(v);}v = !(T = T || (2 == S.mode_gr ? V.scale_bitcount(v) : V.scale_bitcount_lsf(S, v)));} else v = !0;if (!v) break;if (0 != o.scalefac_scale && (g = 254), (v = _ - o.part2_length) <= 0) break;for (; (o.part2_3_length = V.count_bits(i, s, o, c)) > v && o.global_gain <= g;) o.global_gain++;if (o.global_gain > g) break;if (0 == h.over_count) {for (; (o.part2_3_length = V.count_bits(i, s, o, c)) > b && o.global_gain <= g;) o.global_gain++;if (o.global_gain > g) break;}switch (H.calc_noise(o, a, f, r, c), r.bits = o.part2_3_length, g = h, v = r, T = o, R = f, S = t.block_type != te.SHORT_TYPE ? e.quant_comp : e.quant_comp_short) {default:case 9:0 < g.over_count ? (S = v.over_SSD <= g.over_SSD, v.over_SSD == g.over_SSD && (S = v.bits < g.bits)) : S = v.max_noise < 0 && 10 * v.max_noise + v.bits <= 10 * g.max_noise + g.bits;break;case 0:S = v.over_count < g.over_count || v.over_count == g.over_count && v.over_noise < g.over_noise || v.over_count == g.over_count && i1.EQ(v.over_noise, g.over_noise) && v.tot_noise < g.tot_noise;break;case 8:for (S = v, A = 1e-37, M = 0; M < T.psymax; M++) B = R[M], A += B = ae.FAST_LOG10(.368 + .632 * B * B * B);S.max_noise = Math.max(1e-20, A);case 1:S = v.max_noise < g.max_noise;break;case 2:S = v.tot_noise < g.tot_noise;break;case 3:S = v.tot_noise < g.tot_noise && v.max_noise < g.max_noise;break;case 4:S = v.max_noise <= 0 && .2 < g.max_noise || v.max_noise <= 0 && g.max_noise < 0 && g.max_noise > v.max_noise - .2 && v.tot_noise < g.tot_noise || v.max_noise <= 0 && 0 < g.max_noise && g.max_noise > v.max_noise - .2 && v.tot_noise < g.tot_noise + g.over_noise || 0 < v.max_noise && -.05 < g.max_noise && g.max_noise > v.max_noise - .1 && v.tot_noise + v.over_noise < g.tot_noise + g.over_noise || 0 < v.max_noise && -.1 < g.max_noise && g.max_noise > v.max_noise - .15 && v.tot_noise + v.over_noise + v.over_noise < g.tot_noise + g.over_noise + g.over_noise;break;case 5:S = v.over_noise < g.over_noise || i1.EQ(v.over_noise, g.over_noise) && v.tot_noise < g.tot_noise;break;case 6:S = v.over_noise < g.over_noise || i1.EQ(v.over_noise, g.over_noise) && (v.max_noise < g.max_noise || i1.EQ(v.max_noise, g.max_noise) && v.tot_noise <= g.tot_noise);break;case 7:S = v.over_count < g.over_count || v.over_noise < g.over_noise;}if (0 != (S = (0 == g.over_count ? S && v.bits < g.bits : S) ? 1 : 0)) b = t.part2_3_length, h = r, t.assign(o), N.arraycopy(s, n = 0, l, 0, 576);else if (0 == i.full_outer_loop) {if (++n > d && 0 == h.over_count) break;if (3 == i.noise_shaping_amp && p && 30 < n) break;if (3 == i.noise_shaping_amp && p && 15 < o.global_gain - m) break;}} while (o.global_gain + o.scalefac_scale < 255);3 != i.noise_shaping_amp || p ? u = !0 : (o.assign(t), N.arraycopy(l, 0, s, 0, 576), m = o.global_gain, p = !(n = 0));}return e.VBR == m0.vbr_rh || e.VBR == m0.vbr_mtrh ? N.arraycopy(l, 0, s, 0, 576) : 0 != (1 & i.substep_shaping) && trancate_smallspectrums(i, t, a, s), h.over_count;}, this.iteration_finish_one = function (e, t, a) {var s = e.l3_side,n = s.tt[t][a];V.best_scalefac_store(e, t, a, s), 1 == e.use_best_huffman && V.best_huffman_divide(e, n), d.ResvAdjust(e, n);}, this.VBR_encode_granule = function (e, t, a, s, n, _, r) {var i = e.internal_flags,o = new L(),l = W0(576),f = r,h = (r + _) / 2,c = 0,b = i.sfb21_extra;d0.fill(o.l3_enc, 0);do {i.sfb21_extra = !(f - 42 < h) && b;var u = outer_loop(e, t, a, s, n, h);} while (u <= 0 ? (c = 1, r = t.part2_3_length, o.assign(t), N.arraycopy(s, 0, l, 0, 576), u = (r -= 32) - _, h = (r + _) / 2) : (u = r - (_ = h + 32), h = (r + _) / 2, 0 != c && (c = 2, t.assign(o), N.arraycopy(l, 0, s, 0, 576))), 12 < u);i.sfb21_extra = b, 2 == c && N.arraycopy(o.l3_enc, 0, t.l3_enc, 0, 576);}, this.get_framebits = function (e, t) {for (var a = e.internal_flags, s = (a.bitrate_index = a.VBR_min_bitrate, b.getframebits(e), a.bitrate_index = 1, b.getframebits(e)), n = 1; n <= a.VBR_max_bitrate; n++) a.bitrate_index = n, s = new T(s), t[n] = d.ResvFrameBegin(e, s), s = s.bits;}, this.VBR_old_prepare = function (e, t, a, s, n, _, r, i, o) {var l = e.internal_flags,f = 1,h = 0,c = (l.bitrate_index = l.VBR_max_bitrate, d.ResvFrameBegin(e, new T(0)) / l.mode_gr);get_framebits(e, _);for (var b = 0; b < l.mode_gr; b++) {var u = H.on_pe(e, t, i[b], c, b, 0);for (l.mode_ext == te.MPG_MD_MS_LR && (ms_convert(l.l3_side, b), H.reduce_side(i[b], a[b], c, u)), u = 0; u < l.channels_out; ++u) {var p = l.l3_side.tt[b][u],m = p.block_type != te.SHORT_TYPE ? (m = 1.28 / (1 + Math.exp(3.5 - t[b][u] / 300)) - .05, l.PSY.mask_adjust - m) : (m = 2.56 / (1 + Math.exp(3.5 - t[b][u] / 300)) - .14, l.PSY.mask_adjust_short - m);l.masking_lower = Math.pow(10, .1 * m), init_outer_loop(l, p), o[b][u] = H.calc_xmin(e, s[b][u], p, n[b][u]), 0 != o[b][u] && (f = 0), r[b][u] = 126, h += i[b][u];}}for (b = 0; b < l.mode_gr; b++) for (u = 0; u < l.channels_out; u++) h > _[l.VBR_max_bitrate] && (i[b][u] *= _[l.VBR_max_bitrate], i[b][u] /= h), r[b][u] > i[b][u] && (r[b][u] = i[b][u]);return f;}, this.bitpressure_strategy = function (e, t, a, s) {for (var n = 0; n < e.mode_gr; n++) for (var _ = 0; _ < e.channels_out; _++) {for (var r = e.l3_side.tt[n][_], i = t[n][_], o = 0, l = 0; l < r.psy_lmax; l++) i[o++] *= 1 + .029 * l * l / te.SBMAX_l / te.SBMAX_l;if (r.block_type == te.SHORT_TYPE) for (l = r.sfb_smin; l < te.SBMAX_s; l++) i[o++] *= 1 + .029 * l * l / te.SBMAX_s / te.SBMAX_s, i[o++] *= 1 + .029 * l * l / te.SBMAX_s / te.SBMAX_s, i[o++] *= 1 + .029 * l * l / te.SBMAX_s / te.SBMAX_s;s[n][_] = 0 | Math.max(a[n][_], .9 * s[n][_]);}}, this.VBR_new_prepare = function (e, t, a, s, n, _) {var r,i = e.internal_flags,o = 1,l = 0,f = 0;for (e.free_format ? (i.bitrate_index = 0, l = new T(l), r = d.ResvFrameBegin(e, l), l = l.bits, n[0] = r) : (i.bitrate_index = i.VBR_max_bitrate, l = new T(l), d.ResvFrameBegin(e, l), l = l.bits, get_framebits(e, n), r = n[i.VBR_max_bitrate]), n = 0; n < i.mode_gr; n++) {H.on_pe(e, t, _[n], l, n, 0), i.mode_ext == te.MPG_MD_MS_LR && ms_convert(i.l3_side, n);for (var h = 0; h < i.channels_out; ++h) {var c = i.l3_side.tt[n][h];i.masking_lower = Math.pow(10, .1 * i.PSY.mask_adjust), init_outer_loop(i, c), 0 != H.calc_xmin(e, a[n][h], c, s[n][h]) && (o = 0), f += _[n][h];}}for (n = 0; n < i.mode_gr; n++) for (h = 0; h < i.channels_out; h++) r < f && (_[n][h] *= r, _[n][h] /= f);return o;}, this.calc_target_bits = function (e, t, a, s, n, _) {var r = e.internal_flags,i = r.l3_side,o = (r.bitrate_index = r.VBR_max_bitrate, new T(0)),l = (_[0] = d.ResvFrameBegin(e, o), r.bitrate_index = 1, o = b.getframebits(e) - 8 * r.sideinfo_len, n[0] = o / (r.mode_gr * r.channels_out), o = e.VBR_mean_bitrate_kbps * e.framesize * 1e3, 0 != (1 & r.substep_shaping) && (o *= 1.09), o = (o = o / e.out_samplerate - 8 * r.sideinfo_len) / (r.mode_gr * r.channels_out), .93 + .07 * (11 - e.compression_ratio) / 5.5);for (1 < (l = l < .9 ? .9 : l) && (l = 1), e = 0; e < r.mode_gr; e++) {var f,h,c = 0;for (n = 0; n < r.channels_out; n++) s[e][n] = int(l * o), 700 < t[e][n] && (f = int((t[e][n] - 700) / 1.4), h = i.tt[e][n], s[e][n] = int(l * o), 3 * o / 2 < (f = h.block_type == te.SHORT_TYPE && f < o / 2 ? o / 2 : f) ? f = 3 * o / 2 : f < 0 && (f = 0), s[e][n] += f), s[e][n] > o1.MAX_BITS_PER_CHANNEL && (s[e][n] = o1.MAX_BITS_PER_CHANNEL), c += s[e][n];if (o1.MAX_BITS_PER_GRANULE < c) for (n = 0; n < r.channels_out; ++n) s[e][n] *= o1.MAX_BITS_PER_GRANULE, s[e][n] /= c;}if (r.mode_ext == te.MPG_MD_MS_LR) for (e = 0; e < r.mode_gr; e++) H.reduce_side(s[e], a[e], o * r.channels_out, o1.MAX_BITS_PER_GRANULE);for (e = t = 0; e < r.mode_gr; e++) for (n = 0; n < r.channels_out; n++) s[e][n] > o1.MAX_BITS_PER_CHANNEL && (s[e][n] = o1.MAX_BITS_PER_CHANNEL), t += s[e][n];if (t > _[0]) for (e = 0; e < r.mode_gr; e++) for (n = 0; n < r.channels_out; n++) s[e][n] *= _[0], s[e][n] /= t;};}function i() {function B(e, t, a) {for (var s = 10, n = t + 238 - 14 - 286, _ = -15; _ < 0; _++) {var r = l[s + -10],i = e[n + -224] * r,o = e[t + 224] * r;i += e[n + -160] * (r = l[s + -9]), o = o + e[t + 160] * r + e[t + 96] * (r = l[s + -8]), i = i + e[n + -96] * r + e[n + -32] * (r = l[s + -7]), o = o + e[t + 32] * r + e[t + -32] * (r = l[s + -6]), i = i + e[n + 32] * r + e[n + 96] * (r = l[s + -5]), o = o + e[t + -96] * r + e[t + -160] * (r = l[s + -4]), i = i + e[n + 160] * r + e[n + 224] * (r = l[s + -3]), o = o + e[t + -224] * r - e[n + 256] * (r = l[s + -2]), i = i + e[t + -256] * r + e[t + -192] * (r = l[s + -1]), o = o - e[n + 192] * r - e[n + 128] * (r = l[s + 0]), i = i + e[t + -128] * r + e[t + -64] * (r = l[s + 1]), o = o - e[n + 64] * r - e[n + 0] * (r = l[s + 2]), i = i + e[t + 0] * r + e[t + 64] * (r = l[s + 3]), o = o - e[n + -64] * r - e[n + -128] * (r = l[s + 4]), i = i + e[t + 128] * r + e[t + 192] * (r = l[s + 5]), r = (o -= e[n + -192] * r) - (i *= l[s + 6]), a[30 + 2 * _] = o + i, a[31 + 2 * _] = l[s + 7] * r, s += 18, t--, n++;}o = e[t + -16] * l[s + -10], i = e[t + -32] * l[s + -2], e = (i = (i = (i = (i += e[t + -96] * l[s + -1]) + e[t + -160] * l[s + 0] + e[t + -224] * l[s + 1]) - e[t + 32] * l[s + 2] - e[t + 96] * l[s + 3]) - e[t + 160] * l[s + 4] - e[t + 224]) - (o = (o = (o = (o += (e[t + -48] - e[t + 16]) * l[s + -9]) + (e[t + -80] + e[t + 48]) * l[s + -8] + (e[t + -112] - e[t + 80]) * l[s + -7]) + (e[t + -144] + e[t + 112]) * l[s + -6] + (e[t + -176] - e[t + 144]) * l[s + -5]) + (e[t + -208] + e[t + 176]) * l[s + -4] + (e[t + -240] - e[t + 208]) * l[s + -3]), t = i + o, o = a[14], i = a[15] - o, a[31] = t + o, a[30] = e + i, a[15] = e - i, a[14] = t - o, i = a[28] - a[0], a[0] += a[28], a[28] = i * l[s + -36 + 7], i = a[29] - a[1], a[1] += a[29], a[29] = i * l[s + -36 + 7], i = a[26] - a[2], a[2] += a[26], a[26] = i * l[s + -72 + 7], i = a[27] - a[3], a[3] += a[27], a[27] = i * l[s + -72 + 7], i = a[24] - a[4], a[4] += a[24], a[24] = i * l[s + -108 + 7], i = a[25] - a[5], a[5] += a[25], a[25] = i * l[s + -108 + 7], i = a[22] - a[6], a[6] += a[22], a[22] = i * ae.SQRT2, i = a[23] - a[7], a[7] += a[23], a[23] = i * ae.SQRT2 - a[7], a[7] -= a[6], a[22] -= a[7], a[23] -= a[22], a[6] = a[31] - (i = a[6]), a[31] += i, a[7] = a[30] - (i = a[7]), a[30] += i, a[22] = a[15] - (i = a[22]), a[15] += i, a[23] = a[14] - (i = a[23]), a[14] += i, i = a[20] - a[8], a[8] += a[20], a[20] = i * l[s + -180 + 7], i = a[21] - a[9], a[9] += a[21], a[21] = i * l[s + -180 + 7], i = a[18] - a[10], a[10] += a[18], a[18] = i * l[s + -216 + 7], i = a[19] - a[11], a[11] += a[19], a[19] = i * l[s + -216 + 7], i = a[16] - a[12], a[12] += a[16], a[16] = i * l[s + -252 + 7], i = a[17] - a[13], a[13] += a[17], a[17] = i * l[s + -252 + 7], i = -a[20] + a[24], a[20] += a[24], a[24] = i * l[s + -216 + 7], i = -a[21] + a[25], a[21] += a[25], a[25] = i * l[s + -216 + 7], i = a[4] - a[8], a[4] += a[8], a[8] = i * l[s + -216 + 7], i = a[5] - a[9], a[5] += a[9], a[9] = i * l[s + -216 + 7], i = a[0] - a[12], a[0] += a[12], a[12] = i * l[s + -72 + 7], i = a[1] - a[13], a[1] += a[13], a[13] = i * l[s + -72 + 7], i = a[16] - a[28], a[16] += a[28], a[28] = i * l[s + -72 + 7], i = -a[17] + a[29], a[17] += a[29], a[29] = i * l[s + -72 + 7], i = ae.SQRT2 * (a[2] - a[10]), a[2] += a[10], a[10] = i, i = ae.SQRT2 * (a[3] - a[11]), a[3] += a[11], a[11] = i, i = ae.SQRT2 * (-a[18] + a[26]), a[18] += a[26], a[26] = i - a[18], i = ae.SQRT2 * (-a[19] + a[27]), a[19] += a[27], a[27] = i - a[19], i = a[2], a[19] -= a[3], a[3] -= i, a[2] = a[31] - i, a[31] += i, i = a[3], a[11] -= a[19], a[18] -= i, a[3] = a[30] - i, a[30] += i, i = a[18], a[27] -= a[11], a[19] -= i, a[18] = a[15] - i, a[15] += i, a[10] -= i = a[19], a[19] = a[14] - i, a[14] += i, a[11] -= i = a[10], a[10] = a[23] - i, a[23] += i, a[26] -= i = a[11], a[11] = a[22] - i, a[22] += i, a[27] -= i = a[26], a[26] = a[7] - i, a[7] += i, a[27] = a[6] - (i = a[27]), a[6] += i, i = ae.SQRT2 * (a[0] - a[4]), a[0] += a[4], a[4] = i, i = ae.SQRT2 * (a[1] - a[5]), a[1] += a[5], a[5] = i, i = ae.SQRT2 * (a[16] - a[20]), a[16] += a[20], a[20] = i, i = ae.SQRT2 * (a[17] - a[21]), a[17] += a[21], a[21] = i, i = -ae.SQRT2 * (a[8] - a[12]), a[8] += a[12], a[12] = i - a[8], i = -ae.SQRT2 * (a[9] - a[13]), a[9] += a[13], a[13] = i - a[9], i = -ae.SQRT2 * (a[25] - a[29]), a[25] += a[29], a[29] = i - a[25], i = -ae.SQRT2 * (a[24] + a[28]), a[24] -= a[28], a[28] = i - a[24], a[24] = i = a[24] - a[16], a[20] = i = a[20] - i, a[28] = i = a[28] - i, a[25] = i = a[25] - a[17], a[21] = i = a[21] - i, a[29] = i = a[29] - i, a[17] = i = a[17] - a[1], a[9] = i = a[9] - i, a[25] = i = a[25] - i, a[5] = i = a[5] - i, a[21] = i = a[21] - i, a[13] = i = a[13] - i, a[29] = i = a[29] - i, a[1] = i = a[1] - a[0], a[16] = i = a[16] - i, a[17] = i = a[17] - i, a[8] = i = a[8] - i, a[9] = i = a[9] - i, a[24] = i = a[24] - i, a[25] = i = a[25] - i, a[4] = i = a[4] - i, a[5] = i = a[5] - i, a[20] = i = a[20] - i, a[21] = i = a[21] - i, a[12] = i = a[12] - i, a[13] = i = a[13] - i, a[28] = i = a[28] - i, a[29] = i = a[29] - i, i = a[0], a[0] += a[31], a[31] -= i, i = a[1], a[1] += a[30], a[30] -= i, i = a[16], a[16] += a[15], a[15] -= i, i = a[17], a[17] += a[14], a[14] -= i, i = a[8], a[8] += a[23], a[23] -= i, i = a[9], a[9] += a[22], a[22] -= i, i = a[24], a[24] += a[7], a[7] -= i, i = a[25], a[25] += a[6], a[6] -= i, i = a[4], a[4] += a[27], a[27] -= i, i = a[5], a[5] += a[26], a[26] -= i, i = a[20], a[20] += a[11], a[11] -= i, i = a[21], a[21] += a[10], a[10] -= i, i = a[12], a[12] += a[19], a[19] -= i, i = a[13], a[13] += a[18], a[18] -= i, i = a[28], a[28] += a[3], a[3] -= i, i = a[29], a[29] += a[2], a[2] -= i;}var l = [-.1482523854003001, 32.308141959636465, 296.40344946382766, 883.1344870032432, 11113.947376231741, 1057.2713659324597, 305.7402417275812, 30.825928907280012, 3.8533188138216365, 59.42900443849514, 709.5899960123345, 5281.91112291017, -5829.66483675846, -817.6293103748613, -76.91656988279972, -4.594269939176596, .9063471690191471, .1960342806591213, -.15466694054279598, 34.324387823855965, 301.8067566458425, 817.599602898885, 11573.795901679885, 1181.2520595540152, 321.59731579894424, 31.232021761053772, 3.7107095756221318, 53.650946155329365, 684.167428119626, 5224.56624370173, -6366.391851890084, -908.9766368219582, -89.83068876699639, -5.411397422890401, .8206787908286602, .3901806440322567, -.16070888947830023, 36.147034243915876, 304.11815768187864, 732.7429163887613, 11989.60988270091, 1300.012278487897, 335.28490093152146, 31.48816102859945, 3.373875931311736, 47.232241542899175, 652.7371796173471, 5132.414255594984, -6909.087078780055, -1001.9990371107289, -103.62185754286375, -6.104916304710272, .7416505462720353, .5805693545089249, -.16636367662261495, 37.751650073343995, 303.01103387567713, 627.9747488785183, 12358.763425278165, 1412.2779918482834, 346.7496836825721, 31.598286663170416, 3.1598635433980946, 40.57878626349686, 616.1671130880391, 5007.833007176154, -7454.040671756168, -1095.7960341867115, -118.24411666465777, -6.818469345853504, .6681786379192989, .7653668647301797, -.1716176790982088, 39.11551877123304, 298.3413246578966, 503.5259106886539, 12679.589408408976, 1516.5821921214542, 355.9850766329023, 31.395241710249053, 2.9164211881972335, 33.79716964664243, 574.8943997801362, 4853.234992253242, -7997.57021486075, -1189.7624067269965, -133.6444792601766, -7.7202770609839915, .5993769336819237, .9427934736519954, -.17645823955292173, 40.21879108166477, 289.9982036694474, 359.3226160751053, 12950.259102786438, 1612.1013903507662, 362.85067106591504, 31.045922092242872, 2.822222032597987, 26.988862316190684, 529.8996541764288, 4671.371946949588, -8535.899136645805, -1282.5898586244496, -149.58553632943463, -8.643494270763135, .5345111359507916, 1.111140466039205, -.36174739330527045, 41.04429910497807, 277.5463268268618, 195.6386023135583, 13169.43812144731, 1697.6433561479398, 367.40983966190305, 30.557037410382826, 2.531473372857427, 20.070154905927314, 481.50208566532336, 4464.970341588308, -9065.36882077239, -1373.62841526722, -166.1660487028118, -9.58289321133207, .4729647758913199, 1.268786568327291, -.36970682634889585, 41.393213350082036, 261.2935935556502, 12.935476055240873, 13336.131683328815, 1772.508612059496, 369.76534388639965, 29.751323653701338, 2.4023193045459172, 13.304795348228817, 430.5615775526625, 4237.0568611071185, -9581.931701634761, -1461.6913552409758, -183.12733958476446, -10.718010163869403, .41421356237309503, 1.414213562373095, -.37677560326535325, 41.619486213528496, 241.05423794991074, -187.94665032361226, 13450.063605744153, 1836.153896465782, 369.4908799925761, 29.001847876923147, 2.0714759319987186, 6.779591200894186, 377.7767837205709, 3990.386575512536, -10081.709459700915, -1545.947424837898, -200.3762958015653, -11.864482073055006, .3578057213145241, 1.546020906725474, -.3829366947518991, 41.1516456456653, 216.47684307105183, -406.1569483347166, 13511.136535077321, 1887.8076599260432, 367.3025214564151, 28.136213436723654, 1.913880671464418, .3829366947518991, 323.85365704338597, 3728.1472257487526, -10561.233882199509, -1625.2025997821418, -217.62525175416, -13.015432208941645, .3033466836073424, 1.66293922460509, -.5822628872992417, 40.35639251440489, 188.20071124269245, -640.2706748618148, 13519.21490106562, 1927.6022433578062, 362.8197642637487, 26.968821921868447, 1.7463817695935329, -5.62650678237171, 269.3016715297017, 3453.386536448852, -11016.145278780888, -1698.6569643425091, -234.7658734267683, -14.16351421663124, .2504869601913055, 1.76384252869671, -.5887180101749253, 39.23429103868072, 155.76096234403798, -889.2492977967378, 13475.470561874661, 1955.0535223723712, 356.4450994756727, 25.894952980042156, 1.5695032905781554, -11.181939564328772, 214.80884394039484, 3169.1640829158237, -11443.321309975563, -1765.1588461316153, -251.68908574481912, -15.49755935939164, .198912367379658, 1.847759065022573, -.7912582233652842, 37.39369355329111, 119.699486012458, -1151.0956593239027, 13380.446257078214, 1970.3952110853447, 348.01959814116185, 24.731487364283044, 1.3850130831637748, -16.421408865300393, 161.05030052864092, 2878.3322807850063, -11838.991423510031, -1823.985884688674, -268.2854986386903, -16.81724543849939, .1483359875383474, 1.913880671464418, -.7960642926861912, 35.2322109610459, 80.01928065061526, -1424.0212633405113, 13235.794061869668, 1973.804052543835, 337.9908651258184, 23.289159354463873, 1.3934255946442087, -21.099669467133474, 108.48348407242611, 2583.700758091299, -12199.726194855148, -1874.2780658979746, -284.2467154529415, -18.11369784385905, .09849140335716425, 1.961570560806461, -.998795456205172, 32.56307803611191, 36.958364584370486, -1706.075448829146, 13043.287458812016, 1965.3831106103316, 326.43182772364605, 22.175018750622293, 1.198638339011324, -25.371248002043963, 57.53505923036915, 2288.41886619975, -12522.674544337233, -1914.8400385312243, -299.26241273417224, -19.37805630698734, .04912684976946725, 1.990369453344394, .0178904535 * ae.SQRT2 / 2384e-9, .008938074 * ae.SQRT2 / 2384e-9, .0015673635 * ae.SQRT2 / 2384e-9, .001228571 * ae.SQRT2 / 2384e-9, .0004856585 * ae.SQRT2 / 2384e-9, 109434e-9 * ae.SQRT2 / 2384e-9, 50783e-9 * ae.SQRT2 / 2384e-9, 6914e-9 * ae.SQRT2 / 2384e-9, 12804.797818791945, 1945.5515939597317, 313.4244966442953, 20.801593959731544, 1995.1556208053692, 9.000838926174497, -29.20218120805369],w = [[2382191739347913e-28, 6423305872147834e-28, 9400849094049688e-28, 1122435026096556e-27, 1183840321267481e-27, 1122435026096556e-27, 940084909404969e-27, 6423305872147839e-28, 2382191739347918e-28, 5456116108943412e-27, 4878985199565852e-27, 4240448995017367e-27, 3559909094758252e-27, 2858043359288075e-27, 2156177623817898e-27, 1475637723558783e-27, 8371015190102974e-28, 2599706096327376e-28, -5456116108943412e-27, -4878985199565852e-27, -4240448995017367e-27, -3559909094758252e-27, -2858043359288076e-27, -2156177623817898e-27, -1475637723558783e-27, -8371015190102975e-28, -2599706096327376e-28, -2382191739347923e-28, -6423305872147843e-28, -9400849094049696e-28, -1122435026096556e-27, -1183840321267481e-27, -1122435026096556e-27, -9400849094049694e-28, -642330587214784e-27, -2382191739347918e-28], [2382191739347913e-28, 6423305872147834e-28, 9400849094049688e-28, 1122435026096556e-27, 1183840321267481e-27, 1122435026096556e-27, 9400849094049688e-28, 6423305872147841e-28, 2382191739347918e-28, 5456116108943413e-27, 4878985199565852e-27, 4240448995017367e-27, 3559909094758253e-27, 2858043359288075e-27, 2156177623817898e-27, 1475637723558782e-27, 8371015190102975e-28, 2599706096327376e-28, -5461314069809755e-27, -4921085770524055e-27, -4343405037091838e-27, -3732668368707687e-27, -3093523840190885e-27, -2430835727329465e-27, -1734679010007751e-27, -974825365660928e-27, -2797435120168326e-28, 0, 0, 0, 0, 0, 0, -2283748241799531e-28, -4037858874020686e-28, -2146547464825323e-28], [.1316524975873958, .414213562373095, .7673269879789602, 1.091308501069271, 1.303225372841206, 1.56968557711749, 1.920982126971166, 2.414213562373094, 3.171594802363212, 4.510708503662055, 7.595754112725146, 22.90376554843115, .984807753012208, .6427876096865394, .3420201433256688, .9396926207859084, -.1736481776669303, -.7660444431189779, .8660254037844387, .5, -.5144957554275265, -.4717319685649723, -.3133774542039019, -.1819131996109812, -.09457419252642064, -.04096558288530405, -.01419856857247115, -.003699974673760037, .8574929257125442, .8817419973177052, .9496286491027329, .9833145924917901, .9955178160675857, .9991605581781475, .999899195244447, .9999931550702802], [0, 0, 0, 0, 0, 0, 2283748241799531e-28, 4037858874020686e-28, 2146547464825323e-28, 5461314069809755e-27, 4921085770524055e-27, 4343405037091838e-27, 3732668368707687e-27, 3093523840190885e-27, 2430835727329466e-27, 1734679010007751e-27, 974825365660928e-27, 2797435120168326e-28, -5456116108943413e-27, -4878985199565852e-27, -4240448995017367e-27, -3559909094758253e-27, -2858043359288075e-27, -2156177623817898e-27, -1475637723558782e-27, -8371015190102975e-28, -2599706096327376e-28, -2382191739347913e-28, -6423305872147834e-28, -9400849094049688e-28, -1122435026096556e-27, -1183840321267481e-27, -1122435026096556e-27, -9400849094049688e-28, -6423305872147841e-28, -2382191739347918e-28]],T = w[te.SHORT_TYPE],E = w[te.SHORT_TYPE],k = w[te.SHORT_TYPE],y = w[te.SHORT_TYPE],x = [0, 1, 16, 17, 8, 9, 24, 25, 4, 5, 20, 21, 12, 13, 28, 29, 2, 3, 18, 19, 10, 11, 26, 27, 6, 7, 22, 23, 14, 15, 30, 31];this.mdct_sub48 = function (e, t, a) {for (var s = 286, n = 0; n < e.channels_out; n++) {for (var _ = 0; _ < e.mode_gr; _++) {for (var r, i = e.l3_side.tt[_][n], o = i.xr, l = 0, f = e.sb_sample[n][1 - _], h = 0, c = 0; c < 9; c++) for (B(t, s, f[h]), B(t, s + 32, f[h + 1]), h += 2, s += 64, r = 1; r < 32; r += 2) f[h - 1][r] *= -1;for (r = 0; r < 32; r++, l += 18) {f = i.block_type, h = e.sb_sample[n][_];var b = e.sb_sample[n][1 - _];if (0 != i.mixed_block_flag && r < 2 && (f = 0), e.amp_filter[r] < 1e-12) d0.fill(o, l + 0, l + 18, 0);else {if (e.amp_filter[r] < 1) for (c = 0; c < 18; c++) b[c][x[r]] *= e.amp_filter[r];if (f == te.SHORT_TYPE) {for (c = -3; c < 0; c++) {var u = w[te.SHORT_TYPE][c + 3];o[l + 3 * c + 9] = h[9 + c][x[r]] * u - h[8 - c][x[r]], o[l + 3 * c + 18] = h[14 - c][x[r]] * u + h[15 + c][x[r]], o[l + 3 * c + 10] = h[15 + c][x[r]] * u - h[14 - c][x[r]], o[l + 3 * c + 19] = b[2 - c][x[r]] * u + b[3 + c][x[r]], o[l + 3 * c + 11] = b[3 + c][x[r]] * u - b[2 - c][x[r]], o[l + 3 * c + 20] = b[8 - c][x[r]] * u + b[9 + c][x[r]];}for (c = o, h = l, u = 0; u < 3; u++) {var p = (v = c[h + 6] * w[te.SHORT_TYPE][0] - c[h + 15]) + (b = c[h + 0] * w[te.SHORT_TYPE][2] - c[h + 9]),m = v - b,d = (v = c[h + 15] * w[te.SHORT_TYPE][0] + c[h + 6]) + (b = c[h + 9] * w[te.SHORT_TYPE][2] + c[h + 0]),g = -v + b,b = 2069978111953089e-26 * (c[h + 3] * w[te.SHORT_TYPE][1] - c[h + 12]),v = 2069978111953089e-26 * (c[h + 12] * w[te.SHORT_TYPE][1] + c[h + 3]);c[h + 0] = 190752519173728e-25 * p + b, c[h + 15] = 190752519173728e-25 * -d + v, m *= 16519652744032674e-27, c[h + 3] = m - (d = 9537625958686404e-27 * d + v), c[h + 6] = m + d, g *= 16519652744032674e-27, c[h + 9] = (p = 9537625958686404e-27 * p - b) + g, c[h + 12] = p - g, h++;}} else {for (u = W0(18), c = -9; c < 0; c++) p = w[f][c + 27] * b[c + 9][x[r]] + w[f][c + 36] * b[8 - c][x[r]], m = w[f][c + 9] * h[c + 9][x[r]] - w[f][c + 18] * h[8 - c][x[r]], u[c + 9] = p - m * T[3 + c + 9], u[c + 18] = p * T[3 + c + 9] + m;var c = o,h = l,S = (p = u)[17] - p[9],R = p[15] - p[11],M = p[14] - p[12],g = p[0] + p[8],d = p[1] + p[7],A = (c[h + 17] = g + (v = p[2] + p[6]) - (m = p[3] + p[5]) - (d - p[4]), u = (g + v - m) * E[19] + (d - p[4]), b = (S - R - M) * E[18], c[h + 5] = b + u, c[h + 6] = b - u, (p[16] - p[10]) * E[18]);d = d * E[19] + p[4], b = S * E[12] + A + R * E[13] + M * E[14], u = -g * E[16] + d - v * E[17] + m * E[15], c[h + 1] = b + u, c[h + 2] = b - u, b = S * E[13] - A - R * E[14] + M * E[12], u = -g * E[17] + d - v * E[15] + m * E[16], c[h + 9] = b + u, c[h + 10] = b - u, b = S * E[14] - A + R * E[12] - M * E[13], u = g * E[15] - d + v * E[16] - m * E[17], c[h + 13] = b + u, c[h + 14] = b - u, S = p[8] - p[0], R = p[6] - p[2], M = p[5] - p[3], c[h + 0] = (g = p[17] + p[9]) + (v = p[15] + p[11]) + (m = p[14] + p[12]) + ((d = p[16] + p[10]) + p[13]), b = (g + v + m) * E[19] - (d + p[13]), u = (S - R + M) * E[18], c[h + 11] = b + u, c[h + 12] = b - u, A = (p[7] - p[1]) * E[18], d = p[13] - d * E[19], b = g * E[15] - d + v * E[16] + m * E[17], u = S * E[14] + A + R * E[12] + M * E[13], c[h + 3] = b + u, c[h + 4] = b - u, b = -g * E[17] + d - v * E[15] - m * E[16], u = S * E[13] + A - R * E[14] - M * E[12], c[h + 7] = b + u, c[h + 8] = b - u, b = -g * E[16] + d - v * E[17] - m * E[15], u = S * E[12] - A + R * E[13] - M * E[14], c[h + 15] = b + u, c[h + 16] = b - u;}}if (f != te.SHORT_TYPE && 0 != r) for (c = 7; 0 <= c; --c) f = o[l + c] * k[20 + c] + o[l + -1 - c] * y[28 + c], h = o[l + c] * y[28 + c] - o[l + -1 - c] * k[20 + c], o[l + -1 - c] = f, o[l + c] = h;}}if (t = a, s = 286, 1 == e.mode_gr) for (_ = 0; _ < 18; _++) N.arraycopy(e.sb_sample[n][1][_], 0, e.sb_sample[n][0][_], 0, 32);}};}function y() {this.thm = new s(), this.en = new s();}function te() {var g = te.FFTOFFSET,v = te.MPG_MD_MS_LR,S = null,R = this.psy = null,M = null,A = null,B = (this.setModules = function (e, t, a, s) {S = e, R = this.psy = t, M = s, A = a;}, new i());this.lame_encode_mp3_frame = function (e, t, a, s, n, _) {var r,i,o = w([2, 2]),l = (o[0][0] = new y(), o[0][1] = new y(), o[1][0] = new y(), o[1][1] = new y(), w([2, 2])),f = (l[0][0] = new y(), l[0][1] = new y(), l[1][0] = new y(), l[1][1] = new y(), [null, null]),h = e.internal_flags,c = J0([2, 4]),b = [.5, .5],u = [[0, 0], [0, 0]],p = [[0, 0], [0, 0]];if (f[0] = t, f[1] = a, 0 == h.lame_encode_frame_init && 0 == (t = e.internal_flags).lame_encode_frame_init) {a = W0(2014);var m = W0(2014);for (t.lame_encode_frame_init = 1, i = r = 0; r < 286 + 576 * (1 + t.mode_gr); ++r) r < 576 * t.mode_gr ? (a[r] = 0, 2 == t.channels_out && (m[r] = 0)) : (a[r] = f[0][i], 2 == t.channels_out && (m[r] = f[1][i]), ++i);for (i = 0; i < t.mode_gr; i++) for (r = 0; r < t.channels_out; r++) t.l3_side.tt[i][r].block_type = te.SHORT_TYPE;B.mdct_sub48(t, a, m);}if (h.padding = 0, (h.slot_lag -= h.frac_SpF) < 0 && (h.slot_lag += e.out_samplerate, h.padding = 1), 0 != h.psymodel) for (m = [null, null], r = 0, i = U0(2), a = 0; a < h.mode_gr; a++) {for (t = 0; t < h.channels_out; t++) m[t] = f[t], r = 576 + 576 * a - te.FFTOFFSET;if (0 != (t = e.VBR == m0.vbr_mtrh || e.VBR == m0.vbr_mt ? R.L3psycho_anal_vbr(e, m, r, a, o, l, u[a], p[a], c[a], i) : R.L3psycho_anal_ns(e, m, r, a, o, l, u[a], p[a], c[a], i))) return -4;for (e.mode == ee.JOINT_STEREO && (b[a] = c[a][2] + c[a][3], 0 < b[a]) && (b[a] = c[a][3] / b[a]), t = 0; t < h.channels_out; t++) {var d = h.l3_side.tt[a][t];d.block_type = i[t], d.mixed_block_flag = 0;}} else for (a = 0; a < h.mode_gr; a++) for (t = 0; t < h.channels_out; t++) h.l3_side.tt[a][t].block_type = te.NORM_TYPE, h.l3_side.tt[a][t].mixed_block_flag = 0, p[a][t] = u[a][t] = 700;if (0 == h.ATH.useAdjust ? h.ATH.adjust = 1 : (t = h.loudness_sq[0][0], c = h.loudness_sq[1][0], 2 == h.channels_out ? (t += h.loudness_sq[0][1], c += h.loudness_sq[1][1]) : (t += t, c += c), .03125 < (t = .5 * (t = 2 == h.mode_gr ? Math.max(t, c) : t) * h.ATH.aaSensitivityP) ? (1 <= h.ATH.adjust ? h.ATH.adjust = 1 : h.ATH.adjust < h.ATH.adjustLimit && (h.ATH.adjust = h.ATH.adjustLimit), h.ATH.adjustLimit = 1) : (h.ATH.adjust >= (c = 31.98 * t + 625e-6) ? (h.ATH.adjust *= .075 * c + .925, h.ATH.adjust < c && (h.ATH.adjust = c)) : h.ATH.adjustLimit >= c ? h.ATH.adjust = c : h.ATH.adjust < h.ATH.adjustLimit && (h.ATH.adjust = h.ATH.adjustLimit), h.ATH.adjustLimit = c)), B.mdct_sub48(h, f[0], f[1]), h.mode_ext = te.MPG_MD_LR_LR, e.force_ms) h.mode_ext = te.MPG_MD_MS_LR;else if (e.mode == ee.JOINT_STEREO) {for (a = m = c = 0; a < h.mode_gr; a++) for (t = 0; t < h.channels_out; t++) c += p[a][t], m += u[a][t];c <= +m && (c = h.l3_side.tt[0], t = h.l3_side.tt[h.mode_gr - 1], c[0].block_type == c[1].block_type) && t[0].block_type == t[1].block_type && (h.mode_ext = te.MPG_MD_MS_LR);}if (h.mode_ext == v && (o = l, u = p), e.analysis && null != h.pinfo) for (a = 0; a < h.mode_gr; a++) for (t = 0; t < h.channels_out; t++) h.pinfo.ms_ratio[a] = h.ms_ratio[a], h.pinfo.ms_ener_ratio[a] = b[a], h.pinfo.blocktype[a][t] = h.l3_side.tt[a][t].block_type, h.pinfo.pe[a][t] = u[a][t], N.arraycopy(h.l3_side.tt[a][t].xr, 0, h.pinfo.xr[a][t], 0, 576), h.mode_ext == v && (h.pinfo.ers[a][t] = h.pinfo.ers[a][t + 2], N.arraycopy(h.pinfo.energy[a][t + 2], 0, h.pinfo.energy[a][t], 0, h.pinfo.energy[a][t].length));if (e.VBR == m0.vbr_off || e.VBR == m0.vbr_abr) {for (l = 0; l < 18; l++) h.nsPsy.pefirbuf[l] = h.nsPsy.pefirbuf[l + 1];for (a = p = 0; a < h.mode_gr; a++) for (t = 0; t < h.channels_out; t++) p += u[a][t];for (h.nsPsy.pefirbuf[18] = p, p = h.nsPsy.pefirbuf[9], l = 0; l < 9; l++) p += (h.nsPsy.pefirbuf[l] + h.nsPsy.pefirbuf[18 - l]) * te.fircoef[l];for (p = 3350 * h.mode_gr * h.channels_out / p, a = 0; a < h.mode_gr; a++) for (t = 0; t < h.channels_out; t++) u[a][t] *= p;}if (h.iteration_loop.iteration_loop(e, u, b, o), S.format_bitstream(e), s = S.copy_buffer(h, s, n, _, 1), e.bWriteVbrTag && M.addVbrFrame(e), e.analysis && null != h.pinfo) {for (t = 0; t < h.channels_out; t++) {for (n = 0; n < g; n++) h.pinfo.pcmdata[t][n] = h.pinfo.pcmdata[t][n + e.framesize];for (n = g; n < 1600; n++) h.pinfo.pcmdata[t][n] = f[t][n - g];}A.set_frame_pinfo(e, o);}for (h.bitrate_stereoMode_Hist[h.bitrate_index][4]++, h.bitrate_stereoMode_Hist[15][4]++, 2 == h.channels_out && (h.bitrate_stereoMode_Hist[h.bitrate_index][h.mode_ext]++, h.bitrate_stereoMode_Hist[15][h.mode_ext]++), e = 0; e < h.mode_gr; ++e) for (f = 0; f < h.channels_out; ++f) n = 0 | h.l3_side.tt[e][f].block_type, 0 != h.l3_side.tt[e][f].mixed_block_flag && (n = 4), h.bitrate_blockType_Hist[h.bitrate_index][n]++, h.bitrate_blockType_Hist[h.bitrate_index][5]++, h.bitrate_blockType_Hist[15][n]++, h.bitrate_blockType_Hist[15][5]++;return s;};}function o() {this.size = this.pos = this.want = this.seen = this.sum = 0, this.bag = null, this.TotalFrameSize = this.nBytesWritten = this.nVbrNumFrames = 0;}function l() {this.tt = [[null, null], [null, null]], this.resvDrain_post = this.resvDrain_pre = this.private_bits = this.main_data_begin = 0, this.scfsi = [U0(4), U0(4)];for (var e = 0; e < 2; e++) for (var t = 0; t < 2; t++) this.tt[e][t] = new L();}function f() {this.last_en_subshort = J0([4, 9]), this.lastAttacks = U0(4), this.pefirbuf = W0(19), this.longfact = W0(te.SBMAX_l), this.shortfact = W0(te.SBMAX_s), this.attackthre_s = this.attackthre = 0;}function s() {this.l = W0(te.SBMAX_l), this.s = J0([te.SBMAX_s, 3]);var s = this;this.assign = function (e) {N.arraycopy(e.l, 0, s.l, 0, te.SBMAX_l);for (var t = 0; t < te.SBMAX_s; t++) for (var a = 0; a < 3; a++) s.s[t][a] = e.s[t][a];};}function o1() {function e() {this.ptr = this.write_timing = 0, this.buf = new Int8Array(40);}this.fill_buffer_resample_init = this.iteration_init_init = this.lame_encode_frame_init = this.Class_ID = 0, this.mfbuf = J0([2, o1.MFSIZE]), this.full_outer_loop = this.use_best_huffman = this.subblock_gain = this.noise_shaping_stop = this.psymodel = this.substep_shaping = this.noise_shaping_amp = this.noise_shaping = this.highpass2 = this.highpass1 = this.lowpass2 = this.lowpass1 = this.mode_ext = this.samplerate_index = this.bitrate_index = this.VBR_max_bitrate = this.VBR_min_bitrate = this.mf_size = this.mf_samples_to_encode = this.resample_ratio = this.channels_out = this.channels_in = this.mode_gr = 0, this.l3_side = new l(), this.ms_ratio = W0(2), this.slot_lag = this.frac_SpF = this.padding = 0, this.tag_spec = null, this.nMusicCRC = 0, this.OldValue = U0(2), this.CurrentStep = U0(2), this.masking_lower = 0, this.bv_scf = U0(576), this.pseudohalf = U0(D.SFBMAX), this.sfb21_extra = !1, this.inbuf_old = Array(2), this.blackfilt = Array(2 * o1.BPC + 1), this.itime = new Float64Array(2), this.sideinfo_len = 0, this.sb_sample = J0([2, 2, 18, te.SBLIMIT]), this.amp_filter = W0(32), this.header = Array(o1.MAX_HEADER_BUF), this.ResvMax = this.ResvSize = this.ancillary_flag = this.w_ptr = this.h_ptr = 0, this.scalefac_band = new a(), this.minval_l = W0(te.CBANDS), this.minval_s = W0(te.CBANDS), this.nb_1 = J0([4, te.CBANDS]), this.nb_2 = J0([4, te.CBANDS]), this.nb_s1 = J0([4, te.CBANDS]), this.nb_s2 = J0([4, te.CBANDS]), this.s3_ll = this.s3_ss = null, this.decay = 0, this.thm = Array(4), this.en = Array(4), this.tot_ener = W0(4), this.loudness_sq = J0([2, 2]), this.loudness_sq_save = W0(2), this.mld_l = W0(te.SBMAX_l), this.mld_s = W0(te.SBMAX_s), this.bm_l = U0(te.SBMAX_l), this.bo_l = U0(te.SBMAX_l), this.bm_s = U0(te.SBMAX_s), this.bo_s = U0(te.SBMAX_s), this.npart_s = this.npart_l = 0, this.s3ind = M([te.CBANDS, 2]), this.s3ind_s = M([te.CBANDS, 2]), this.numlines_s = U0(te.CBANDS), this.numlines_l = U0(te.CBANDS), this.rnumlines_l = W0(te.CBANDS), this.mld_cb_l = W0(te.CBANDS), this.mld_cb_s = W0(te.CBANDS), this.numlines_l_num1 = this.numlines_s_num1 = 0, this.pe = W0(4), this.ms_ener_ratio_old = this.ms_ratio_l_old = this.ms_ratio_s_old = 0, this.blocktype_old = U0(2), this.nsPsy = new f(), this.VBR_seek_table = new o(), this.PSY = this.ATH = null, this.nogap_current = this.nogap_total = 0, this.findPeakSample = this.findReplayGain = this.decode_on_the_fly = !0, this.AudiophileGain = this.RadioGain = this.PeakSample = 0, this.rgdata = null, this.noclipScale = this.noclipGainChange = 0, this.bitrate_stereoMode_Hist = M([16, 5]), this.bitrate_blockType_Hist = M([16, 6]), this.hip = this.pinfo = null, this.in_buffer_nsamples = 0, this.iteration_loop = this.in_buffer_1 = this.in_buffer_0 = null;for (var t = 0; t < this.en.length; t++) this.en[t] = new s();for (t = 0; t < this.thm.length; t++) this.thm[t] = new s();for (t = 0; t < this.header.length; t++) this.header[t] = new e();}function h() {function u(e, t, a) {var s = 0,n = t + (a <<= 1),_ = 4;do {var r = _ >> 1,i = _,o = _ << 1,l = o + i,_ = o << 1,f = (S = t) + r;do {var h = e[S + 0] - e[S + i],c = e[S + 0] + e[S + i],b = e[S + o] - e[S + l],u = e[S + o] + e[S + l];} while (e[S + o] = c - u, e[S + 0] = c + u, e[S + l] = h - b, e[S + i] = h + b, h = e[f + 0] - e[f + i], b = ae.SQRT2 * e[f + l], u = ae.SQRT2 * e[f + o], e[f + o] = (c = e[f + 0] + e[f + i]) - u, e[f + 0] = c + u, e[f + l] = h - b, e[f + i] = h + b, f += _, (S += _) < n);for (var p = T[s + 0], m = T[s + 1], d = 1; d < r; d++) {var g = 1 - 2 * m * m,v = 2 * m * p,S = t + d,f = t + i - d;do {var R = v * e[S + i] - g * e[f + i],u = g * e[S + i] + v * e[f + i],h = e[S + 0] - u,c = e[S + 0] + u,M = e[f + 0] - R,A = e[f + 0] + R,b = e[S + o] - (u = g * e[S + l] + v * e[f + l]),B = e[f + o] - (R = v * e[S + l] - g * e[f + l]),w = e[f + o] + R;} while (R = m * (u = e[S + o] + u) - p * B, e[S + o] = c - (u = p * u + m * B), e[S + 0] = c + u, e[f + l] = M - R, e[f + i] = M + R, R = p * w - m * b, e[f + o] = A - (u = m * w + p * b), e[f + 0] = A + u, e[S + l] = h - R, e[S + i] = h + R, f += _, (S += _) < n);p = (g = p) * T[s + 0] - m * T[s + 1], m = g * T[s + 1] + m * T[s + 0];}} while (s += 2, _ < a);}var c = W0(te.BLKSIZE),p = W0(te.BLKSIZE_s / 2),T = [.9238795325112867, .3826834323650898, .9951847266721969, .0980171403295606, .9996988186962042, .02454122852291229, .9999811752826011, .006135884649154475],m = [0, 128, 64, 192, 32, 160, 96, 224, 16, 144, 80, 208, 48, 176, 112, 240, 8, 136, 72, 200, 40, 168, 104, 232, 24, 152, 88, 216, 56, 184, 120, 248, 4, 132, 68, 196, 36, 164, 100, 228, 20, 148, 84, 212, 52, 180, 116, 244, 12, 140, 76, 204, 44, 172, 108, 236, 28, 156, 92, 220, 60, 188, 124, 252, 2, 130, 66, 194, 34, 162, 98, 226, 18, 146, 82, 210, 50, 178, 114, 242, 10, 138, 74, 202, 42, 170, 106, 234, 26, 154, 90, 218, 58, 186, 122, 250, 6, 134, 70, 198, 38, 166, 102, 230, 22, 150, 86, 214, 54, 182, 118, 246, 14, 142, 78, 206, 46, 174, 110, 238, 30, 158, 94, 222, 62, 190, 126, 254];this.fft_short = function (e, t, a, s, n) {for (e = 0; e < 3; e++) {var _ = te.BLKSIZE_s / 2,r = 65535 & 192 * (e + 1),i = te.BLKSIZE_s / 8 - 1;do {var o = 255 & m[i << 2],l = p[o] * s[a][n + o + r],f = p[127 - o] * s[a][n + o + r + 128],h = l - f,c = (l += f, p[64 + o] * s[a][n + o + r + 64]),b = c - (f = p[63 - o] * s[a][n + o + r + 192]);} while (c += f, _ -= 4, t[e][_ + 0] = l + c, t[e][_ + 2] = l - c, t[e][_ + 1] = h + b, t[e][_ + 3] = h - b, h = (l = p[1 + o] * s[a][n + o + r + 1]) - (f = p[126 - o] * s[a][n + o + r + 129]), l += f, b = (c = p[65 + o] * s[a][n + o + r + 65]) - (f = p[62 - o] * s[a][n + o + r + 193]), c += f, t[e][_ + te.BLKSIZE_s / 2 + 0] = l + c, t[e][_ + te.BLKSIZE_s / 2 + 2] = l - c, t[e][_ + te.BLKSIZE_s / 2 + 1] = h + b, t[e][_ + te.BLKSIZE_s / 2 + 3] = h - b, 0 <= --i);u(t[e], _, te.BLKSIZE_s / 2);}}, this.fft_long = function (e, t, a, s, n) {e = te.BLKSIZE / 8 - 1;var _ = te.BLKSIZE / 2;do {var r = 255 & m[e],i = c[r] * s[a][n + r],o = c[512 + r] * s[a][n + r + 512],l = i - o,f = (i += o, c[256 + r] * s[a][n + r + 256]),h = f - (o = c[768 + r] * s[a][n + r + 768]);} while (t[_ -= 4] = i + (f += o), t[_ + 2] = i - f, t[_ + 1] = l + h, t[_ + 3] = l - h, l = (i = c[1 + r] * s[a][n + r + 1]) - (o = c[513 + r] * s[a][n + r + 513]), i += o, h = (f = c[257 + r] * s[a][n + r + 257]) - (o = c[769 + r] * s[a][n + r + 769]), t[_ + te.BLKSIZE / 2 + 0] = i + (f += o), t[_ + te.BLKSIZE / 2 + 2] = i - f, t[_ + te.BLKSIZE / 2 + 1] = l + h, t[_ + te.BLKSIZE / 2 + 3] = l - h, 0 <= --e);u(t, _, te.BLKSIZE / 2);}, this.init_fft = function (e) {for (e = 0; e < te.BLKSIZE; e++) c[e] = .42 - .5 * Math.cos(2 * Math.PI * (e + .5) / te.BLKSIZE) + .08 * Math.cos(4 * Math.PI * (e + .5) / te.BLKSIZE);for (e = 0; e < te.BLKSIZE_s / 2; e++) p[e] = .5 * (1 - Math.cos(2 * Math.PI * (e + .5) / te.BLKSIZE_s));};}function x() {function N0(e, t) {for (var a = 0, s = 0; s < te.BLKSIZE / 2; ++s) a += e[s] * t.ATH.eql_w[s];return a * n;}function D0(e, t, a) {if (t < 0 && (t = 0), (e = e < 0 ? 0 : e) <= 0) return t;if (!(t <= 0)) {var s = e < t ? t / e : e / t;if (-2 <= a && a <= 2) return l0 <= s ? e + t : (a = 0 | ae.FAST_LOG10_X(s, 16), (e + t) * _[a]);if (s < f0) return e + t;e < t && (e = t);}return e;}function X0(e, t, a, s, n) {for (var _, r = 0, i = 0, o = _ = 0; o < te.SBMAX_s; ++_, ++o) {for (var l = e.bo_s[o], f = e.npart_s, l = l < f ? l : f; _ < l;) r += t[_], i += a[_], _++;if (e.en[s].s[o][n] = r, e.thm[s].s[o][n] = i, f <= _) {++o;break;}f = 1 - (i = e.PSY.bo_s_weight[o]), r = i * t[_], i *= a[_], e.en[s].s[o][n] += r, e.thm[s].s[o][n] += i, r = f * t[_], i = f * a[_];}for (; o < te.SBMAX_s; ++o) e.en[s].s[o][n] = 0, e.thm[s].s[o][n] = 0;}function Y0(e, t, a, s) {for (var n, _ = 0, r = 0, i = n = 0; i < te.SBMAX_l; ++n, ++i) {for (var o = e.bo_l[i], l = e.npart_l, o = o < l ? o : l; n < o;) _ += t[n], r += a[n], n++;if (e.en[s].l[i] = _, e.thm[s].l[i] = r, l <= n) {++i;break;}l = 1 - (r = e.PSY.bo_l_weight[i]), _ = r * t[n], r *= a[n], e.en[s].l[i] += _, e.thm[s].l[i] += r, _ = l * t[n], r = l * a[n];}for (; i < te.SBMAX_l; ++i) e.en[s].l[i] = 0, e.thm[s].l[i] = 0;}function q0(e, t, a) {return 1 <= a ? e : a <= 0 ? t : 0 < t ? Math.pow(e / t, a) * t : 0;}function C0(e, t) {for (var a = 309.07, s = 0; s < te.SBMAX_s - 1; s++) for (var n = 0; n < 3; n++) {var _,r = e.thm.s[s][n];0 < r && (r *= t) < (_ = e.en.s[s][n]) && (a = 1e10 * r < _ ? a + 23.02585092994046 * i[s] : a + i[s] * ae.FAST_LOG10(_ / r));}return a;}function F0(e, t) {for (var a = 281.0575, s = 0; s < te.SBMAX_l - 1; s++) {var n,_ = e.thm.l[s];0 < _ && (_ *= t) < (n = e.en.l[s]) && (a = 1e10 * _ < n ? a + 23.02585092994046 * r[s] : a + r[s] * ae.FAST_LOG10(n / _));}return a;}function j0(e, t, a, s, n) {for (var _, r = _ = 0; r < e.npart_l; ++r) {for (var i = 0, o = 0, l = 0; l < e.numlines_l[r]; ++l, ++_) {var f = t[_];i += f, o < f && (o = f);}a[r] = i, s[r] = o, n[r] = i * e.rnumlines_l[r];}}function G0(e, t, a, s) {var n,_ = Z0.length - 1,r = 0,i = a[r] + a[r + 1];for (0 < i ? (i = 20 * (2 * (n = (n = t[r]) < t[r + 1] ? t[r + 1] : n) - i) / (i * (e.numlines_l[r] + e.numlines_l[r + 1] - 1)), s[r] = i = _ < (i |= 0) ? _ : i) : s[r] = 0, r = 1; r < e.npart_l - 1; r++) 0 < (i = a[r - 1] + a[r] + a[r + 1]) ? (i = 20 * (3 * (n = (n = (n = t[r - 1]) < t[r] ? t[r] : n) < t[r + 1] ? t[r + 1] : n) - i) / (i * (e.numlines_l[r - 1] + e.numlines_l[r] + e.numlines_l[r + 1] - 1)), s[r] = i = _ < (i |= 0) ? _ : i) : s[r] = 0;0 < (i = a[r - 1] + a[r]) ? (i = 20 * (2 * (n = (n = t[r - 1]) < t[r] ? t[r] : n) - i) / (i * (e.numlines_l[r - 1] + e.numlines_l[r] - 1)), s[r] = i = _ < (i |= 0) ? _ : i) : s[r] = 0;}function z0(e, t, a, s, n, _, r) {var i = 2 * _;n = 0 < _ ? Math.pow(10, n) : 1;for (var o, l = 0; l < r; ++l) {var f = e[2][l],h = e[3][l],c = t[0][l],b = t[1][l],u = t[2][l],p = t[3][l],m = c <= 1.58 * b && b <= 1.58 * c ? (m = a[l] * f, o = Math.max(u, Math.min(p, a[l] * h)), Math.max(p, Math.min(u, m))) : (o = u, p);0 < _ && (p = s[l] * n, c = Math.min(Math.max(c, p), Math.max(b, p)), 0 < (b = (u = Math.max(o, p)) + (p = Math.max(m, p))) && c * i < b && (u *= c = c * i / b, p *= c), o = Math.min(u, o), m = Math.min(p, m)), f < o && (o = f), h < m && (m = h), t[2][l] = o, t[3][l] = m;}}function p(e, t) {return (e = 0 <= e ? 27 * -e : e * t) <= -72 ? 0 : Math.exp(.2302585093 * e);}function S(e) {return e < 0 && (e = 0), e *= .001, 13 * Math.atan(.76 * e) + 3.5 * Math.atan(e * e / 56.25);}function m(e, t, a, s, n, _, r, i, o, l, f, h) {for (var c = W0(te.CBANDS + 1), b = i / (15 < h ? 1152 : 384), u = U0(te.HBLKSIZE), p = (i /= o, 0), m = 0, d = 0; d < te.CBANDS; d++) {var g,v = S(i * p);for (c[d] = i * p, g = p; S(i * g) - v < .34 && g <= o / 2; g++);for (e[d] = g - p, m = d + 1; p < g;) u[p++] = d;if (o / 2 < p) {p = o / 2, ++d;break;}}for (c[d] = i * p, p = 0; p < h; p++) d = l[p], v = l[p + 1], (d = 0 | Math.floor(.5 + f * (d - .5))) < 0 && (d = 0), g = 0 | Math.floor(.5 + f * (v - .5)), a[p] = (u[d] + u[g = o / 2 < g ? o / 2 : g]) / 2, t[p] = u[g], r[p] = (b * v - c[t[p]]) / (c[t[p] + 1] - c[t[p]]), r[p] < 0 ? r[p] = 0 : 1 < r[p] && (r[p] = 1), v = S(i * l[p] * f), v = Math.min(v, 15.5) / 15.5, _[p] = Math.pow(10, 1.25 * (1 - Math.cos(Math.PI * v)) - 2.5);for (t = p = 0; t < m; t++) a = e[t], v = S(i * p), _ = S(i * (p + a - 1)), s[t] = .5 * (v + _), v = S(i * (p - .5)), _ = S(i * (p + a - .5)), n[t] = _ - v, p += a;return m;}function d(e, t, a, s, n, _) {var r = J0([te.CBANDS, te.CBANDS]),i = 0;if (_) for (var o = 0; o < t; o++) for (_ = 0; _ < t; _++) {var l = .5 <= (f = 0 <= (f = a[o] - a[_]) ? 3 * f : 1.5 * f) && f <= 2.5 ? 8 * ((l = f - .5) * l - 2 * l) : 0,f = (l = (f = 15.811389 + 7.5 * (f += .474) - 17.5 * Math.sqrt(1 + f * f)) <= -60 ? 0 : (f = Math.exp(.2302585093 * (l + f))) / .6609193) * s[_];r[o][_] = f * n[o];} else for (_ = 0; _ < t; _++) {for (var o = l = 15 + Math.min(21 / a[_], 12), h = 0; 1e-20 < p(h, o); --h);for (var c = h, b = 0; 1e-12 < Math.abs(b - c);) 0 < p(h = (b + c) / 2, o) ? b = h : c = h;for (f = c, h = 0; 1e-20 < p(h, o); h += 1);for (c = 0, b = h; 1e-12 < Math.abs(b - c);) 0 < p(h = (b + c) / 2, o) ? c = h : b = h;for (var c = b, u = 0, b = 0; b <= 1e3; ++b) u += h = p(h = f + b * (c - f) / 1e3, o);for (h = 1001 / (u * (c - f)), o = 0; o < t; o++) f = h * p(a[o] - a[_], l) * s[_], r[o][_] = f * n[o];}for (o = 0; o < t; o++) {for (_ = 0; _ < t && !(0 < r[o][_]); _++);for (e[o][0] = _, _ = t - 1; 0 < _ && !(0 < r[o][_]); _--);e[o][1] = _, i += e[o][1] - e[o][0] + 1;}for (a = W0(i), o = s = 0; o < t; o++) for (_ = e[o][0]; _ <= e[o][1]; _++) a[s++] = r[o][_];return a;}function g(e) {return e = S(e), e = Math.min(e, 15.5) / 15.5, Math.pow(10, 1.25 * (1 - Math.cos(Math.PI * e)) - 2.5);}function a(e, t) {return e < -.3 && (e = 3410), e = Math.max(.1, e / 1e3), 3.64 * Math.pow(e, -.8) - 6.8 * Math.exp(-.6 * Math.pow(e - 3.4, 2)) + 6 * Math.exp(-.15 * Math.pow(e - 8.7, 2)) + .001 * (.6 + .04 * t) * Math.pow(e, 4);}var l0,f0,h0,K0 = new h(),n = 1 / 217621504 / (te.BLKSIZE / 2),Z0 = [1, .79433, .63096, .63096, .63096, .63096, .63096, .25119, .11749],c0 = [3.3246 * 3.3246, 3.23837 * 3.23837, 9.9500500969, 9.0247369744, 8.1854926609, 7.0440875649, 2.46209 * 2.46209, 2.284 * 2.284, 4.4892710641, 1.96552 * 1.96552, 1.82335 * 1.82335, 1.69146 * 1.69146, 2.4621061921, 2.1508568964, 1.37074 * 1.37074, 1.31036 * 1.31036, 1.5691069696, 1.4555939904, 1.16203 * 1.16203, 1.2715945225, 1.09428 * 1.09428, 1.0659 * 1.0659, 1.0779838276, 1.0382591025, 1],b0 = [1.7782755904, 1.35879 * 1.35879, 1.38454 * 1.38454, 1.39497 * 1.39497, 1.40548 * 1.40548, 1.3537 * 1.3537, 1.6999465924, 1.22321 * 1.22321, 1.3169398564, 1],u0 = [5.5396212496, 2.29259 * 2.29259, 4.9868695969, 2.12675 * 2.12675, 2.02545 * 2.02545, 1.87894 * 1.87894, 1.74303 * 1.74303, 1.61695 * 1.61695, 2.2499700001, 1.39148 * 1.39148, 1.29083 * 1.29083, 1.19746 * 1.19746, 1.2339655056, 1.0779838276],_ = [1.7782755904, 1.35879 * 1.35879, 1.38454 * 1.38454, 1.39497 * 1.39497, 1.40548 * 1.40548, 1.3537 * 1.3537, 1.6999465924, 1.22321 * 1.22321, 1.3169398564, 1],i = [11.8, 13.6, 17.2, 32, 46.5, 51.3, 57.5, 67.1, 71.5, 84.6, 97.6, 130],r = [6.8, 5.8, 5.8, 6.4, 6.5, 9.9, 12.1, 14.4, 15, 18.9, 21.6, 26.9, 34.2, 40.2, 46.8, 56.5, 60.7, 73.9, 85.7, 93.4, 126.1],p0 = [-1730326e-23, -.01703172, -1349528e-23, .0418072, -673278e-22, -.0876324, -30835e-21, .1863476, -1104424e-22, -.627638],Q0 = (this.L3psycho_anal_ns = function (e, L, N, t, D, X, Y, q, C, F) {for (var a, j, s, n, _ = e.internal_flags, G = J0([2, te.BLKSIZE]), z = J0([2, 3, te.BLKSIZE_s]), K = W0(te.CBANDS + 1), Z = W0(te.CBANDS + 1), Q = W0(te.CBANDS + 2), U = U0(2), r = U0(2), W = J0([2, 576]), J = U0(te.CBANDS + 2), $ = U0(te.CBANDS + 2), e1 = (d0.fill($, 0), _.channels_out), t1 = (e.mode == ee.JOINT_STEREO && (e1 = 4), e.VBR == m0.vbr_off ? 0 == _.ResvMax ? 0 : _.ResvSize / _.ResvMax * .5 : e.VBR == m0.vbr_rh || e.VBR == m0.vbr_mtrh || e.VBR == m0.vbr_mt ? .6 : 1), i = 0; i < _.channels_out; i++) {for (var a1 = L[i], s1 = N + 576 - 350 - 21 + 192, o = 0; o < 576; o++) {for (var n1, _1 = a1[s1 + o + 10], l = n1 = 0; l < 9; l += 2) _1 += p0[l] * (a1[s1 + o + l] + a1[s1 + o + 21 - l]), n1 += p0[l + 1] * (a1[s1 + o + l + 1] + a1[s1 + o + 21 - l - 1]);W[i][o] = _1 + n1;}D[t][i].en.assign(_.en[i]), D[t][i].thm.assign(_.thm[i]), 2 < e1 && (X[t][i].en.assign(_.en[i + 2]), X[t][i].thm.assign(_.thm[i + 2]));}for (i = 0; i < e1; i++) {var f = W0(12),h = [0, 0, 0, 0],r1 = W0(12),i1 = 1,o1 = W0(te.CBANDS),l1 = W0(te.CBANDS),c = [0, 0, 0, 0],f1 = W0(te.HBLKSIZE),h1 = J0([3, te.HBLKSIZE_s]);for (o = 0; o < 3; o++) f[o] = _.nsPsy.last_en_subshort[i][o + 6], r1[o] = f[o] / _.nsPsy.last_en_subshort[i][o + 4], h[0] += f[o];if (2 == i) for (o = 0; o < 576; o++) {var c1 = W[0][o],b1 = W[1][o];W[0][o] = c1 + b1, W[1][o] = c1 - b1;}var u1 = W[1 & i],p1 = 0;for (o = 0; o < 9; o++) {for (var m1 = p1 + 64, b = 1; p1 < m1; p1++) b < Math.abs(u1[p1]) && (b = Math.abs(u1[p1]));_.nsPsy.last_en_subshort[i][o] = f[o + 3] = b, h[1 + o / 3] += b, b = b > f[o + 3 - 2] ? b / f[o + 3 - 2] : f[o + 3 - 2] > 10 * b ? f[o + 3 - 2] / (10 * b) : 0, r1[o + 3] = b;}if (e.analysis) {for (var d1 = r1[0], o = 1; o < 12; o++) d1 < r1[o] && (d1 = r1[o]);_.pinfo.ers[t][i] = _.pinfo.ers_save[i], _.pinfo.ers_save[i] = d1;}var g1 = 3 == i ? _.nsPsy.attackthre_s : _.nsPsy.attackthre;for (o = 0; o < 12; o++) 0 == c[o / 3] && r1[o] > g1 && (c[o / 3] = o % 3 + 1);for (o = 1; o < 4; o++) (h[o] < h[o - 1] ? h[o - 1] / h[o] : h[o] / h[o - 1]) < 1.7 && (c[o] = 0, 1 == o) && (c[0] = 0);0 != c[0] && 0 != _.nsPsy.lastAttacks[i] && (c[0] = 0), 3 != _.nsPsy.lastAttacks[i] && 0 == c[0] + c[1] + c[2] + c[3] || ((i1 = 0) != c[1] && 0 != c[0] && (c[1] = 0), 0 != c[2] && 0 != c[1] && (c[2] = 0), 0 != c[3] && 0 != c[2] && (c[3] = 0)), i < 2 ? r[i] = i1 : 0 == i1 && (r[0] = r[1] = 0), C[i] = _.tot_ener[i];var v1 = f1,S1 = h1,u = G,p = 1 & i,m = z,d = 1 & i,R1 = t,g = i,M1 = L,A1 = N,v = (i1 = e).internal_flags;if (g < 2) K0.fft_long(v, u[p], g, M1, A1), K0.fft_short(v, m[d], g, M1, A1);else if (2 == g) {for (var S = te.BLKSIZE - 1; 0 <= S; --S) {var B1 = u[p][S],w1 = u[1 + p][S];u[p][S] = (B1 + w1) * ae.SQRT2 * .5, u[1 + p][S] = (B1 - w1) * ae.SQRT2 * .5;}for (var R = 2; 0 <= R; --R) for (S = te.BLKSIZE_s - 1; 0 <= S; --S) B1 = m[d][R][S], w1 = m[1 + d][R][S], m[d][R][S] = (B1 + w1) * ae.SQRT2 * .5, m[1 + d][R][S] = (B1 - w1) * ae.SQRT2 * .5;}for (v1[0] = u[p][0], v1[0] *= v1[0], S = te.BLKSIZE / 2 - 1; 0 <= S; --S) {var T1 = u[p][te.BLKSIZE / 2 - S],E1 = u[p][te.BLKSIZE / 2 + S];v1[te.BLKSIZE / 2 - S] = .5 * (T1 * T1 + E1 * E1);}for (R = 2; 0 <= R; --R) for (S1[R][0] = m[d][R][0], S1[R][0] *= S1[R][0], S = te.BLKSIZE_s / 2 - 1; 0 <= S; --S) T1 = m[d][R][te.BLKSIZE_s / 2 - S], E1 = m[d][R][te.BLKSIZE_s / 2 + S], S1[R][te.BLKSIZE_s / 2 - S] = .5 * (T1 * T1 + E1 * E1);for (var k1 = 0, S = 11; S < te.HBLKSIZE; S++) k1 += v1[S];if (v.tot_ener[g] = k1, i1.analysis) {for (S = 0; S < te.HBLKSIZE; S++) v.pinfo.energy[R1][g][S] = v.pinfo.energy_save[g][S], v.pinfo.energy_save[g][S] = v1[S];v.pinfo.pe[R1][g] = v.pe[g];}for (2 == i1.athaa_loudapprox && g < 2 && (v.loudness_sq[R1][g] = v.loudness_sq_save[g], v.loudness_sq_save[g] = N0(v1, v)), j0(_, f1, K, o1, l1), G0(_, o1, l1, J), n = 0; n < 3; n++) {for (var M = void 0, y1 = void 0, x1 = h1, P1 = Z, I1 = Q, H1 = i, V1 = n, A = e.internal_flags, M = y1 = 0; M < A.npart_s; ++M) {for (var O1 = 0, L1 = 0, N1 = A.numlines_s[M], D1 = 0; D1 < N1; ++D1, ++y1) {var X1 = x1[V1][y1];O1 += X1, L1 < X1 && (L1 = X1);}P1[M] = O1;}for (y1 = M = 0; M < A.npart_s; M++) {var Y1 = A.s3ind_s[M][0],q1 = A.s3_ss[y1++] * P1[Y1];for (++Y1; Y1 <= A.s3ind_s[M][1];) q1 += A.s3_ss[y1] * P1[Y1], ++y1, ++Y1;var C1 = 2 * A.nb_s1[H1][M];I1[M] = Math.min(q1, C1), A.blocktype_old[1 & H1] == te.SHORT_TYPE && (C1 = 16 * A.nb_s2[H1][M], I1[M] = Math.min(C1, I1[M])), A.nb_s2[H1][M] = A.nb_s1[H1][M], A.nb_s1[H1][M] = q1;}for (; M <= te.CBANDS; ++M) P1[M] = 0, I1[M] = 0;for (X0(_, Z, Q, i, n), s = 0; s < te.SBMAX_s; s++) {var B = _.thm[i].s[s][n],F1 = (B *= .8, (2 <= c[n] || 1 == c[n + 1]) && (b = q0(_.thm[i].s[s][0 != n ? n - 1 : 2], B, .6 * t1), B = Math.min(B, b)), 1 == c[n] ? (b = q0(_.thm[i].s[s][0 != n ? n - 1 : 2], B, .3 * t1), B = Math.min(B, b)) : (0 != n && 3 == c[n - 1] || 0 == n && 3 == _.nsPsy.lastAttacks[i]) && (b = q0(_.thm[i].s[s][2 != n ? n + 1 : 0], B, .3 * t1), B = Math.min(B, b)), f[3 * n + 3] + f[3 * n + 4] + f[3 * n + 5]);6 * f[3 * n + 5] < F1 && (B *= .5, 6 * f[3 * n + 4] < F1) && (B *= .5), _.thm[i].s[s][n] = B;}}for (_.nsPsy.lastAttacks[i] = c[2], a = j = 0; a < _.npart_l; a++) {for (var j1 = _.s3ind[a][0], G1 = K[j1] * Z0[J[j1]], z1 = _.s3_ll[j++] * G1; ++j1 <= _.s3ind[a][1];) G1 = K[j1] * Z0[J[j1]], z1 = function (e, t, a, s, n) {if (e < t) {if (!(t < e * f0)) return e + t;var _ = t / e;} else {if (t * f0 <= e) return e + t;_ = e / t;}return e += t, s + 3 <= 6 ? l0 <= _ ? e : (s = 0 | ae.FAST_LOG10_X(_, 16), e * b0[s]) : (s = 0 | ae.FAST_LOG10_X(_, 16), t = n.ATH.cb_l[a] * n.ATH.adjust, e < h0 * t ? t < e ? (a = s <= 13 ? u0[s] : 1, t = ae.FAST_LOG10_X(e / t, 10 / 15), e * ((c0[s] - a) * t + a)) : 13 < s ? e : e * u0[s] : e * c0[s]);}(z1, _.s3_ll[j++] * G1, j1, j1 - a, _);z1 *= .158489319246111, Q[a] = _.blocktype_old[1 & i] == te.SHORT_TYPE ? z1 : q0(Math.min(z1, Math.min(2 * _.nb_1[i][a], 16 * _.nb_2[i][a])), z1, t1), _.nb_2[i][a] = _.nb_1[i][a], _.nb_1[i][a] = z1;}for (; a <= te.CBANDS; ++a) K[a] = 0, Q[a] = 0;Y0(_, K, Q, i);}if ((e.mode == ee.STEREO || e.mode == ee.JOINT_STEREO) && 0 < e.interChRatio) {var K1 = e.interChRatio,w = e.internal_flags;if (1 < w.channels_out) {for (var T = 0; T < te.SBMAX_l; T++) {var Z1 = w.thm[0].l[T],Q1 = w.thm[1].l[T];w.thm[0].l[T] += Q1 * K1, w.thm[1].l[T] += Z1 * K1;}for (T = 0; T < te.SBMAX_s; T++) for (var U1 = 0; U1 < 3; U1++) Z1 = w.thm[0].s[T][U1], Q1 = w.thm[1].s[T][U1], w.thm[0].s[T][U1] += Q1 * K1, w.thm[1].s[T][U1] += Z1 * K1;}}if (e.mode == ee.JOINT_STEREO) {for (var W1, E, J1, k = 0; k < te.SBMAX_l; k++) _.thm[0].l[k] > 1.58 * _.thm[1].l[k] || _.thm[1].l[k] > 1.58 * _.thm[0].l[k] || (E = _.mld_l[k] * _.en[3].l[k], W1 = Math.max(_.thm[2].l[k], Math.min(_.thm[3].l[k], E)), E = _.mld_l[k] * _.en[2].l[k], J1 = Math.max(_.thm[3].l[k], Math.min(_.thm[2].l[k], E)), _.thm[2].l[k] = W1, _.thm[3].l[k] = J1);for (k = 0; k < te.SBMAX_s; k++) for (var y = 0; y < 3; y++) _.thm[0].s[k][y] > 1.58 * _.thm[1].s[k][y] || _.thm[1].s[k][y] > 1.58 * _.thm[0].s[k][y] || (E = _.mld_s[k] * _.en[3].s[k][y], W1 = Math.max(_.thm[2].s[k][y], Math.min(_.thm[3].s[k][y], E)), E = _.mld_s[k] * _.en[2].s[k][y], J1 = Math.max(_.thm[3].s[k][y], Math.min(_.thm[2].s[k][y], E)), _.thm[2].s[k][y] = W1, _.thm[3].s[k][y] = J1);if ($ = e.msfix, 0 < Math.abs($)) {var $1 = $,e0 = $1,t0 = Math.pow(10, e.ATHlower * _.ATH.adjust);$1 *= 2, e0 *= 2;for (var x = 0; x < te.SBMAX_l; x++) {var a0,P = _.ATH.cb_l[_.bm_l[x]] * t0,s0 = Math.min(Math.max(_.thm[0].l[x], P), Math.max(_.thm[1].l[x], P)),I = Math.max(_.thm[2].l[x], P),H = Math.max(_.thm[3].l[x], P);s0 * $1 < I + H && (I *= a0 = s0 * e0 / (I + H), H *= a0), _.thm[2].l[x] = Math.min(I, _.thm[2].l[x]), _.thm[3].l[x] = Math.min(H, _.thm[3].l[x]);}for (t0 *= te.BLKSIZE_s / te.BLKSIZE, x = 0; x < te.SBMAX_s; x++) for (var V = 0; V < 3; V++) P = _.ATH.cb_s[_.bm_s[x]] * t0, (s0 = Math.min(Math.max(_.thm[0].s[x][V], P), Math.max(_.thm[1].s[x][V], P))) * $1 < (I = Math.max(_.thm[2].s[x][V], P)) + (H = Math.max(_.thm[3].s[x][V], P)) && (I *= a0 = s0 * $1 / (I + H), H *= a0), _.thm[2].s[x][V] = Math.min(_.thm[2].s[x][V], I), _.thm[3].s[x][V] = Math.min(_.thm[3].s[x][V], H);}}var n0 = e.internal_flags;e.short_blocks != $0.short_block_coupled || 0 != r[0] && 0 != r[1] || (r[0] = r[1] = 0);for (var O = 0; O < n0.channels_out; O++) U[O] = te.NORM_TYPE, e.short_blocks == $0.short_block_dispensed && (r[O] = 1), e.short_blocks == $0.short_block_forced && (r[O] = 0), 0 != r[O] ? n0.blocktype_old[O] == te.SHORT_TYPE && (U[O] = te.STOP_TYPE) : (U[O] = te.SHORT_TYPE, n0.blocktype_old[O] == te.NORM_TYPE && (n0.blocktype_old[O] = te.START_TYPE), n0.blocktype_old[O] == te.STOP_TYPE && (n0.blocktype_old[O] = te.SHORT_TYPE)), F[O] = n0.blocktype_old[O], n0.blocktype_old[O] = U[O];for (i = 0; i < e1; i++) {var _0,r0,i0 = 0,o0 = 1 < i ? (_0 = q, i0 = -2, r0 = te.NORM_TYPE, F[0] != te.SHORT_TYPE && F[1] != te.SHORT_TYPE || (r0 = te.SHORT_TYPE), X[t][i - 2]) : (_0 = Y, i0 = 0, r0 = F[i], D[t][i]);_0[i0 + i] = (r0 == te.SHORT_TYPE ? C0 : F0)(o0, _.masking_lower), e.analysis && (_.pinfo.pe[t][i] = _0[i0 + i]);}return 0;}, [-1730326e-23, -.01703172, -1349528e-23, .0418072, -673278e-22, -.0876324, -30835e-21, .1863476, -1104424e-22, -.627638]);this.L3psycho_anal_vbr = function (e, L, N, t, D, X, Y, q, C, F) {for (var a = e.internal_flags, j = W0(te.HBLKSIZE), G = J0([3, te.HBLKSIZE_s]), z = J0([2, te.BLKSIZE]), K = J0([2, 3, te.BLKSIZE_s]), Z = J0([4, te.CBANDS]), Q = J0([4, te.CBANDS]), U = J0([4, 3]), s = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], n = U0(2), W = e.mode == ee.JOINT_STEREO ? 4 : a.channels_out, J = J0([2, 576]), _ = e.internal_flags, $ = _.channels_out, e1 = e.mode == ee.JOINT_STEREO ? 4 : $, r = 0; r < $; r++) {firbuf = L[r];for (var t1 = N + 576 - 350 - 21 + 192, i = 0; i < 576; i++) {for (var a1, s1 = firbuf[t1 + i + 10], o = a1 = 0; o < 9; o += 2) s1 += Q0[o] * (firbuf[t1 + i + o] + firbuf[t1 + i + 21 - o]), a1 += Q0[o + 1] * (firbuf[t1 + i + o + 1] + firbuf[t1 + i + 21 - o - 1]);J[r][i] = s1 + a1;}D[t][r].en.assign(_.en[r]), D[t][r].thm.assign(_.thm[r]), 2 < e1 && (X[t][r].en.assign(_.en[r + 2]), X[t][r].thm.assign(_.thm[r + 2]));}for (r = 0; r < e1; r++) {var n1 = W0(12),l = W0(12),_1 = [0, 0, 0, 0],r1 = J[1 & r],i1 = 0,o1 = 3 == r ? _.nsPsy.attackthre_s : _.nsPsy.attackthre,l1 = 1;if (2 == r) for (i = 0, o = 576; 0 < o; ++i, --o) {var f1 = J[0][i],h1 = J[1][i];J[0][i] = f1 + h1, J[1][i] = f1 - h1;}for (i = 0; i < 3; i++) l[i] = _.nsPsy.last_en_subshort[r][i + 6], n1[i] = l[i] / _.nsPsy.last_en_subshort[r][i + 4], _1[0] += l[i];for (i = 0; i < 9; i++) {for (var c1 = i1 + 64, f = 1; i1 < c1; i1++) f < Math.abs(r1[i1]) && (f = Math.abs(r1[i1]));_.nsPsy.last_en_subshort[r][i] = l[i + 3] = f, _1[1 + i / 3] += f, f = f > l[i + 3 - 2] ? f / l[i + 3 - 2] : l[i + 3 - 2] > 10 * f ? l[i + 3 - 2] / (10 * f) : 0, n1[i + 3] = f;}for (i = 0; i < 3; ++i) {var b1 = l[3 * i + 3] + l[3 * i + 4] + l[3 * i + 5],u1 = 1;6 * l[3 * i + 5] < b1 && (u1 *= .5, 6 * l[3 * i + 4] < b1) && (u1 *= .5), U[r][i] = u1;}if (e.analysis) {for (var p1 = n1[0], i = 1; i < 12; i++) p1 < n1[i] && (p1 = n1[i]);_.pinfo.ers[t][r] = _.pinfo.ers_save[r], _.pinfo.ers_save[r] = p1;}for (i = 0; i < 12; i++) 0 == s[r][i / 3] && n1[i] > o1 && (s[r][i / 3] = i % 3 + 1);for (i = 1; i < 4; i++) {var m1 = _1[i - 1],d1 = _1[i];Math.max(m1, d1) < 4e4 && m1 < 1.7 * d1 && d1 < 1.7 * m1 && (1 == i && s[r][0] <= s[r][i] && (s[r][0] = 0), s[r][i] = 0);}s[r][0] <= _.nsPsy.lastAttacks[r] && (s[r][0] = 0), 3 != _.nsPsy.lastAttacks[r] && 0 == s[r][0] + s[r][1] + s[r][2] + s[r][3] || ((l1 = 0) != s[r][1] && 0 != s[r][0] && (s[r][1] = 0), 0 != s[r][2] && 0 != s[r][1] && (s[r][2] = 0), 0 != s[r][3] && 0 != s[r][2] && (s[r][3] = 0)), r < 2 ? n[r] = l1 : 0 == l1 && (n[0] = n[1] = 0), C[r] = _.tot_ener[r];}var g1 = e.internal_flags;e.short_blocks != $0.short_block_coupled || 0 != n[0] && 0 != n[1] || (n[0] = n[1] = 0);for (var v1 = 0; v1 < g1.channels_out; v1++) e.short_blocks == $0.short_block_dispensed && (n[v1] = 1), e.short_blocks == $0.short_block_forced && (n[v1] = 0);for (var h = 0; h < W; h++) {var S1 = 1 & h,c = h,R1 = t,M1 = j,b = z,u = S1,A1 = (y1 = e).internal_flags;if (c < 2) K0.fft_long(A1, b[u], c, L, N);else if (2 == c) for (var p = te.BLKSIZE - 1; 0 <= p; --p) {var B1 = b[u + 0][p],w1 = b[u + 1][p];b[u + 0][p] = (B1 + w1) * ae.SQRT2 * .5, b[u + 1][p] = (B1 - w1) * ae.SQRT2 * .5;}for (M1[0] = b[u + 0][0], M1[0] *= M1[0], p = te.BLKSIZE / 2 - 1; 0 <= p; --p) {var T1 = b[u + 0][te.BLKSIZE / 2 - p],E1 = b[u + 0][te.BLKSIZE / 2 + p];M1[te.BLKSIZE / 2 - p] = .5 * (T1 * T1 + E1 * E1);}for (var k1 = 0, p = 11; p < te.HBLKSIZE; p++) k1 += M1[p];if (A1.tot_ener[c] = k1, y1.analysis) {for (p = 0; p < te.HBLKSIZE; p++) A1.pinfo.energy[R1][c][p] = A1.pinfo.energy_save[c][p], A1.pinfo.energy_save[c][p] = M1[p];A1.pinfo.pe[R1][c] = A1.pe[c];}var y1 = h,x1 = j,P1 = e.internal_flags;if (2 == e.athaa_loudapprox && y1 < 2 && (P1.loudness_sq[t][y1] = P1.loudness_sq_save[y1], P1.loudness_sq_save[y1] = N0(x1, P1)), 0 != n[S1]) {for (var m = void 0, d = a, y1 = j, I1 = Z[h], g = Q[h], v = h, H1 = W0(te.CBANDS), x1 = W0(te.CBANDS), V1 = U0(te.CBANDS + 2), O1 = (j0(d, y1, I1, H1, x1), G0(d, H1, x1, V1), 0), m = 0; m < d.npart_l; m++) {var S = d.s3ind[m][0],L1 = d.s3ind[m][1],N1 = 0,D1 = 0,N1 = V1[S],R = (D1 += 1, d.s3_ll[O1] * I1[S] * Z0[V1[S]]);for (++O1, ++S; S <= L1;) {N1 += V1[S], D1 += 1;var X1 = d.s3_ll[O1] * I1[S] * Z0[V1[S]],R = D0(R, X1, S - m);++O1, ++S;}var Y1,q1,C1,F1 = .5 * Z0[N1 = (1 + 2 * N1) / (2 * D1)];R *= F1, d.blocktype_old[1 & v] == te.SHORT_TYPE ? (Y1 = 2 * d.nb_1[v][m], g[m] = 0 < Y1 ? Math.min(R, Y1) : Math.min(R, .3 * I1[m])) : ((q1 = 16 * d.nb_2[v][m]) <= 0 && (q1 = R), (C1 = 2 * d.nb_1[v][m]) <= 0 && (C1 = R), Y1 = d.blocktype_old[1 & v] == te.NORM_TYPE ? Math.min(C1, q1) : C1, g[m] = Math.min(R, Y1)), d.nb_2[v][m] = d.nb_1[v][m], d.nb_1[v][m] = R, X1 = (X1 = H1[m]) * d.minval_l[m] * F1, g[m] > X1 && (g[m] = X1), 1 < d.masking_lower && (g[m] *= d.masking_lower), g[m] > I1[m] && (g[m] = I1[m]), d.masking_lower < 1 && (g[m] *= d.masking_lower);}for (; m < te.CBANDS; ++m) I1[m] = 0, g[m] = 0;} else for (var j1 = a, G1 = h, z1 = 0; z1 < j1.npart_l; z1++) j1.nb_2[G1][z1] = j1.nb_1[G1][z1], j1.nb_1[G1][z1] = 0;}for (2 == n[0] + n[1] && e.mode == ee.JOINT_STEREO && z0(Z, Q, a.mld_cb_l, a.ATH.cb_l, e.ATHlower * a.ATH.adjust, e.msfix, a.npart_l), h = 0; h < W; h++) 0 != n[S1 = 1 & h] && Y0(a, Z[h], Q[h], h);for (var M = 0; M < 3; M++) {for (h = 0; h < W; ++h) if (0 != n[S1 = 1 & h]) {var K1 = a,Z1 = h;if (0 == M) for (var Q1 = 0; Q1 < K1.npart_s; Q1++) K1.nb_s2[Z1][Q1] = K1.nb_s1[Z1][Q1], K1.nb_s1[Z1][Q1] = 0;} else {var U1 = h,A = M,W1 = G,B = K,J1 = S1,$1 = e.internal_flags;if (0 == A && U1 < 2 && K0.fft_short($1, B[J1], U1, L, N), 2 == U1) for (var w = te.BLKSIZE_s - 1; 0 <= w; --w) {var e0 = B[J1 + 0][A][w],t0 = B[J1 + 1][A][w];B[J1 + 0][A][w] = (e0 + t0) * ae.SQRT2 * .5, B[J1 + 1][A][w] = (e0 - t0) * ae.SQRT2 * .5;}for (W1[A][0] = B[J1 + 0][A][0], W1[A][0] *= W1[A][0], w = te.BLKSIZE_s / 2 - 1; 0 <= w; --w) {var a0 = B[J1 + 0][A][te.BLKSIZE_s / 2 - w],s0 = B[J1 + 0][A][te.BLKSIZE_s / 2 + w];W1[A][te.BLKSIZE_s / 2 - w] = .5 * (a0 * a0 + s0 * s0);}for (var T = void 0, n0 = void 0, _0 = void 0, r0 = G, i0 = Z[h], o0 = Q[h], l0 = h, f0 = M, E = e.internal_flags, h0 = new float[te.CBANDS](), c0 = W0(te.CBANDS), b0 = new int[te.CBANDS](), T = n0 = 0; T < E.npart_s; ++T) {for (var u0 = 0, p0 = 0, m0 = E.numlines_s[T], _0 = 0; _0 < m0; ++_0, ++n0) {var d0 = r0[f0][n0];u0 += d0, p0 < d0 && (p0 = d0);}i0[T] = u0, h0[T] = p0, c0[T] = u0 / m0;}for (; T < te.CBANDS; ++T) h0[T] = 0, c0[T] = 0;var k,y,g0 = E,x = h0,v0 = c0,S0 = b0,R0 = Z0.length - 1,P = 0,I = v0[P] + v0[P + 1];for (0 < I ? (R0 < (y = 0 | (I = 20 * (2 * (k = (k = x[P]) < x[P + 1] ? x[P + 1] : k) - I) / (I * (g0.numlines_s[P] + g0.numlines_s[P + 1] - 1)))) && (y = R0), S0[P] = y) : S0[P] = 0, P = 1; P < g0.npart_s - 1; P++) 0 < (I = v0[P - 1] + v0[P] + v0[P + 1]) ? (R0 < (y = 0 | (I = 20 * (3 * (k = (k = (k = x[P - 1]) < x[P] ? x[P] : k) < x[P + 1] ? x[P + 1] : k) - I) / (I * (g0.numlines_s[P - 1] + g0.numlines_s[P] + g0.numlines_s[P + 1] - 1)))) && (y = R0), S0[P] = y) : S0[P] = 0;for (0 < (I = v0[P - 1] + v0[P]) ? (R0 < (y = 0 | (I = 20 * (2 * (k = (k = x[P - 1]) < x[P] ? x[P] : k) - I) / (I * (g0.numlines_s[P - 1] + g0.numlines_s[P] - 1)))) && (y = R0), S0[P] = y) : S0[P] = 0, n0 = T = 0; T < E.npart_s; T++) {var H = E.s3ind_s[T][0],M0 = E.s3ind_s[T][1],A0 = b0[H],B0 = 1,w0 = E.s3_ss[n0] * i0[H] * Z0[b0[H]];for (++n0, ++H; H <= M0;) {A0 += b0[H], B0 += 1;var T0 = E.s3_ss[n0] * i0[H] * Z0[b0[H]],w0 = D0(w0, T0, H - T);++n0, ++H;}var E0 = .5 * Z0[A0 = (1 + 2 * A0) / (2 * B0)];w0 *= E0, o0[T] = w0, E.nb_s2[l0][T] = E.nb_s1[l0][T], E.nb_s1[l0][T] = w0, T0 = (T0 = h0[T]) * E.minval_s[T] * E0, o0[T] > T0 && (o0[T] = T0), 1 < E.masking_lower && (o0[T] *= E.masking_lower), o0[T] > i0[T] && (o0[T] = i0[T]), E.masking_lower < 1 && (o0[T] *= E.masking_lower);}for (; T < te.CBANDS; ++T) i0[T] = 0, o0[T] = 0;}for (0 == n[0] + n[1] && e.mode == ee.JOINT_STEREO && z0(Z, Q, a.mld_cb_s, a.ATH.cb_s, e.ATHlower * a.ATH.adjust, e.msfix, a.npart_s), h = 0; h < W; ++h) 0 == n[S1 = 1 & h] && X0(a, Z[h], Q[h], h, M);}for (h = 0; h < W; h++) if (0 == n[S1 = 1 & h]) for (var k0 = 0; k0 < te.SBMAX_s; k0++) {for (var y0 = W0(3), M = 0; M < 3; M++) {var x0,V = a.thm[h].s[k0][M];V *= .8, 2 <= s[h][M] || 1 == s[h][M + 1] ? (x0 = q0(a.thm[h].s[k0][0 != M ? M - 1 : 2], V, .36), V = Math.min(V, x0)) : 1 == s[h][M] ? (x0 = q0(a.thm[h].s[k0][0 != M ? M - 1 : 2], V, .18), V = Math.min(V, x0)) : (0 != M && 3 == s[h][M - 1] || 0 == M && 3 == a.nsPsy.lastAttacks[h]) && (x0 = q0(a.thm[h].s[k0][2 != M ? M + 1 : 0], V, .18), V = Math.min(V, x0)), V *= U[h][M], y0[M] = V;}for (M = 0; M < 3; M++) a.thm[h].s[k0][M] = y0[M];}for (h = 0; h < W; h++) a.nsPsy.lastAttacks[h] = s[h][2];for (var P0 = e.internal_flags, O = 0; O < P0.channels_out; O++) {var I0 = te.NORM_TYPE;0 != n[O] ? P0.blocktype_old[O] == te.SHORT_TYPE && (I0 = te.STOP_TYPE) : (I0 = te.SHORT_TYPE, P0.blocktype_old[O] == te.NORM_TYPE && (P0.blocktype_old[O] = te.START_TYPE), P0.blocktype_old[O] == te.STOP_TYPE && (P0.blocktype_old[O] = te.SHORT_TYPE)), F[O] = P0.blocktype_old[O], P0.blocktype_old[O] = I0;}for (h = 0; h < W; h++) {var H0,V0,O0,L0 = 1 < h ? (H0 = q, V0 = -2, O0 = te.NORM_TYPE, F[0] != te.SHORT_TYPE && F[1] != te.SHORT_TYPE || (O0 = te.SHORT_TYPE), X[t][h - 2]) : (H0 = Y, V0 = 0, O0 = F[h], D[t][h]);H0[V0 + h] = (O0 == te.SHORT_TYPE ? C0 : F0)(L0, a.masking_lower), e.analysis && (a.pinfo.pe[t][h] = H0[V0 + h]);}return 0;}, this.psymodel_init = function (e) {var t,a = e.internal_flags,s = !0,n = 13,_ = 0,r = 0,i = -8.25,o = -4.5,l = W0(te.CBANDS),f = W0(te.CBANDS),h = W0(te.CBANDS),c = e.out_samplerate;switch (e.experimentalZ) {default:case 0:s = !0;break;case 1:s = e.VBR != m0.vbr_mtrh && e.VBR != m0.vbr_mt;break;case 2:s = !1;break;case 3:n = 8, _ = -1.75, r = -.0125, i = -8.25, o = -2.25;}for (a.ms_ener_ratio_old = .25, a.blocktype_old[0] = a.blocktype_old[1] = te.NORM_TYPE, t = 0; t < 4; ++t) {for (var b = 0; b < te.CBANDS; ++b) a.nb_1[t][b] = 1e20, a.nb_2[t][b] = 1e20, a.nb_s1[t][b] = a.nb_s2[t][b] = 1;for (var u = 0; u < te.SBMAX_l; u++) a.en[t].l[u] = 1e20, a.thm[t].l[u] = 1e20;for (b = 0; b < 3; ++b) {for (u = 0; u < te.SBMAX_s; u++) a.en[t].s[u][b] = 1e20, a.thm[t].s[u][b] = 1e20;a.nsPsy.lastAttacks[t] = 0;}for (b = 0; b < 9; b++) a.nsPsy.last_en_subshort[t][b] = 10;}for (a.loudness_sq_save[0] = a.loudness_sq_save[1] = 0, a.npart_l = m(a.numlines_l, a.bo_l, a.bm_l, l, f, a.mld_l, a.PSY.bo_l_weight, c, te.BLKSIZE, a.scalefac_band.l, te.BLKSIZE / 1152, te.SBMAX_l), t = 0; t < a.npart_l; t++) u = _, l[t] >= n && (u = r * (l[t] - n) / (24 - n) + _ * (24 - l[t]) / (24 - n)), h[t] = Math.pow(10, u / 10), a.rnumlines_l[t] = 0 < a.numlines_l[t] ? 1 / a.numlines_l[t] : 0;for (a.s3_ll = d(a.s3ind, a.npart_l, l, f, h, s), t = b = 0; t < a.npart_l; t++) {for (r = H.MAX_VALUE, u = 0; u < a.numlines_l[t]; u++, b++) _ = this.ATHformula(1e3 * (_ = c * b / (1e3 * te.BLKSIZE)), e) - 20, _ = Math.pow(10, .1 * _), (_ *= a.numlines_l[t]) < r && (r = _);a.ATH.cb_l[t] = r, (r = 6 < (r = 20 * l[t] / 10 - 20) ? 100 : r) < -15 && (r = -15), r -= 8, a.minval_l[t] = Math.pow(10, r / 10) * a.numlines_l[t];}for (a.npart_s = m(a.numlines_s, a.bo_s, a.bm_s, l, f, a.mld_s, a.PSY.bo_s_weight, c, te.BLKSIZE_s, a.scalefac_band.s, te.BLKSIZE_s / 384, te.SBMAX_s), t = b = 0; t < a.npart_s; t++) {for (u = i, l[t] >= n && (u = o * (l[t] - n) / (24 - n) + i * (24 - l[t]) / (24 - n)), h[t] = Math.pow(10, u / 10), r = H.MAX_VALUE, u = 0; u < a.numlines_s[t]; u++, b++) _ = this.ATHformula(1e3 * (_ = c * b / (1e3 * te.BLKSIZE_s)), e) - 20, _ = Math.pow(10, .1 * _), (_ *= a.numlines_s[t]) < r && (r = _);a.ATH.cb_s[t] = r, r = 7 * l[t] / 12 - 7, 12 < l[t] && (r *= 1 + 3.1 * Math.log(1 + r)), l[t] < 12 && (r *= 1 + 2.3 * Math.log(1 - r)), r < -15 && (r = -15), r -= 8, a.minval_s[t] = Math.pow(10, r / 10) * a.numlines_s[t];}for (a.s3_ss = d(a.s3ind_s, a.npart_s, l, f, h, s), l0 = Math.pow(10, .5625), f0 = Math.pow(10, 1.5), h0 = Math.pow(10, 1.5), K0.init_fft(a), a.decay = Math.exp(-2.302585092994046 / (.01 * c / 192)), t = 3.5, 0 != (2 & e.exp_nspsytune) && (t = 1), 0 < Math.abs(e.msfix) && (t = e.msfix), e.msfix = t, s = 0; s < a.npart_l; s++) a.s3ind[s][1] > a.npart_l - 1 && (a.s3ind[s][1] = a.npart_l - 1);if (a.ATH.decay = Math.pow(10, 576 * a.mode_gr / c * -1.2), a.ATH.adjust = .01, -(a.ATH.adjustLimit = 1) != e.ATHtype) {for (b = e.out_samplerate / te.BLKSIZE, t = _ = s = 0; t < te.BLKSIZE / 2; ++t) _ += b, a.ATH.eql_w[t] = 1 / Math.pow(10, this.ATHformula(_, e) / 10), s += a.ATH.eql_w[t];for (s = 1 / s, t = te.BLKSIZE / 2; 0 <= --t;) a.ATH.eql_w[t] *= s;}for (s = b = 0; s < a.npart_s; ++s) for (t = 0; t < a.numlines_s[s]; ++t) ++b;for (s = b = 0; s < a.npart_l; ++s) for (t = 0; t < a.numlines_l[s]; ++t) ++b;for (t = b = 0; t < a.npart_l; t++) _ = c * (b + a.numlines_l[t] / 2) / +te.BLKSIZE, a.mld_cb_l[t] = g(_), b += a.numlines_l[t];for (; t < te.CBANDS; ++t) a.mld_cb_l[t] = 1;for (t = b = 0; t < a.npart_s; t++) _ = c * (b + a.numlines_s[t] / 2) / +te.BLKSIZE_s, a.mld_cb_s[t] = g(_), b += a.numlines_s[t];for (; t < te.CBANDS; ++t) a.mld_cb_s[t] = 1;return 0;}, this.ATHformula = function (e, t) {switch (t.ATHtype) {case 0:e = a(e, 9);break;case 1:e = a(e, -1);break;case 2:e = a(e, 0);break;case 3:e = a(e, 1) + 6;break;case 4:e = a(e, t.ATHcurve);break;default:e = a(e, 0);}return e;};}function I() {function o() {this.mask_adjust_short = this.mask_adjust = 0, this.bo_l_weight = W0(te.SBMAX_l), this.bo_s_weight = W0(te.SBMAX_s);}function l() {this.lowerlimit = 0;}function s(e, t) {this.lowpass = t;}function f(e) {return 1 < e ? 0 : e <= 0 ? 1 : Math.cos(Math.PI / 2 * e);}function h(e, t) {switch (e) {case 44100:return t.version = 1, 0;case 48e3:return t.version = 1;case 32e3:return t.version = 1, 2;case 22050:return t.version = 0;case 24e3:return t.version = 0, 1;case 16e3:return t.version = 0, 2;case 11025:return t.version = 0;case 12e3:return t.version = 0, 1;case 8e3:return t.version = 0, 2;default:return t.version = 0, -1;}}function c(e, t, a) {a = V.bitrate_table[t = a < 16e3 ? 2 : t][1];for (var s = 2; s <= 14; s++) 0 < V.bitrate_table[t][s] && Math.abs(V.bitrate_table[t][s] - e) < Math.abs(a - e) && (a = V.bitrate_table[t][s]);return a;}function b(e, t, a) {for (a < 16e3 && (t = 2), a = 0; a <= 14; a++) if (0 < V.bitrate_table[t][a] && V.bitrate_table[t][a] == e) return a;return -1;}function u(e, t) {var a = [new s(0, 2e3), new s(0, 3700), new s(0, 3900), new s(0, 5500), new s(0, 7e3), new s(0, 7500), new s(0, 1e4), new s(0, 11e3), new s(0, 13500), new s(0, 15100), new s(0, 15600), new s(0, 17e3), new s(0, 17500), new s(0, 18600), new s(0, 19400), new s(0, 19700), new s(0, 20500)];t = s1.nearestBitrateFullIndex(t), e.lowerlimit = a[t].lowpass;}function e1(e) {var t = te.BLKSIZE + e.framesize - te.FFTOFFSET;return Math.max(t, 512 + e.framesize - 32);}function t1() {this.n_out = this.n_in = 0;}function a1() {this.num_used = 0;}var s1 = this;I.V9 = 410, I.V8 = 420, I.V7 = 430, I.V6 = 440, I.V5 = 450, I.V4 = 460, I.V3 = 470, I.V2 = 480, I.V1 = 490, I.V0 = 500, I.R3MIX = 1e3, I.STANDARD = 1001, I.EXTREME = 1002, I.INSANE = 1003, I.STANDARD_FAST = 1004, I.EXTREME_FAST = 1005, I.MEDIUM = 1006, I.MEDIUM_FAST = 1007, I.LAME_MAXMP3BUFFER = 147456;var n1,_1,p,m,d,g,v,S,R = new x();this.enc = new te(), this.setModules = function (e, t, a, s, n, _, r, i, o) {n1 = e, _1 = t, p = a, m = s, d = n, g = _, v = i, S = o, this.enc.setModules(_1, R, m, g);}, this.lame_init = function () {var e = new _(),t = (e.class_id = 4294479419, e.internal_flags = new o1());return e.mode = ee.NOT_SET, e.original = 1, e.in_samplerate = 44100, e.num_channels = 2, e.num_samples = -1, e.bWriteVbrTag = !0, e.quality = -1, e.short_blocks = null, t.subblock_gain = -1, e.lowpassfreq = 0, e.highpassfreq = 0, e.lowpasswidth = -1, e.highpasswidth = -1, e.VBR = m0.vbr_off, e.VBR_q = 4, e.ATHcurve = -1, e.VBR_mean_bitrate_kbps = 128, e.VBR_min_bitrate_kbps = 0, e.VBR_max_bitrate_kbps = 0, e.VBR_hard_min = 0, t.VBR_min_bitrate = 1, t.VBR_max_bitrate = 13, e.quant_comp = -1, e.quant_comp_short = -1, e.msfix = -1, t.resample_ratio = 1, t.OldValue[0] = 180, t.OldValue[1] = 180, t.CurrentStep[0] = 4, t.CurrentStep[1] = 4, t.masking_lower = 1, t.nsPsy.attackthre = -1, t.nsPsy.attackthre_s = -1, e.scale = -1, e.athaa_type = -1, e.ATHtype = -1, e.athaa_loudapprox = -1, e.athaa_sensitivity = 0, e.useTemporal = null, e.interChRatio = -1, t.mf_samples_to_encode = te.ENCDELAY + te.POSTDELAY, e.encoder_padding = 0, t.mf_size = te.ENCDELAY - te.MDCTDELAY, e.findReplayGain = !1, t.decode_on_the_fly = e.decode_on_the_fly = !1, t.findReplayGain = !1, t.findPeakSample = !1, t.RadioGain = 0, t.AudiophileGain = 0, t.noclipGainChange = 0, t.noclipScale = -1, e.preset = 0, e.write_id3tag_automatic = !0, e.lame_allocated_gfp = 1, e;}, this.nearestBitrateFullIndex = function (e) {for (var t = [8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320], a = t[16], s = 16, n = t[16], _ = 16, r = 0; r < 16; r++) if (Math.max(e, t[r + 1]) != e) {a = t[r + 1], s = r + 1, n = t[r], _ = r;break;}return e - n < a - e ? _ : s;}, this.lame_init_params = function (e) {var t = e.internal_flags;if (t.Class_ID = 0, null == t.ATH && (t.ATH = new q()), null == t.PSY && (t.PSY = new o()), null == t.rgdata && (t.rgdata = new X()), t.channels_in = e.num_channels, 1 == t.channels_in && (e.mode = ee.MONO), t.channels_out = e.mode == ee.MONO ? 1 : 2, t.mode_ext = te.MPG_MD_MS_LR, e.mode == ee.MONO && (e.force_ms = !1), e.VBR == m0.vbr_off && 128 != e.VBR_mean_bitrate_kbps && 0 == e.brate && (e.brate = e.VBR_mean_bitrate_kbps), e.VBR != m0.vbr_off && e.VBR != m0.vbr_mtrh && e.VBR != m0.vbr_mt && (e.free_format = !1), e.VBR == m0.vbr_off && 0 == e.brate && i1.EQ(e.compression_ratio, 0) && (e.compression_ratio = 11.025), e.VBR == m0.vbr_off && 0 < e.compression_ratio && (0 == e.out_samplerate && (e.out_samplerate = map2MP3Frequency(int(.97 * e.in_samplerate))), e.brate = 0 | 16 * e.out_samplerate * t.channels_out / (1e3 * e.compression_ratio), t.samplerate_index = h(e.out_samplerate, e), e.free_format || (e.brate = c(e.brate, e.version, e.out_samplerate))), 0 != e.out_samplerate && (e.out_samplerate < 16e3 ? (e.VBR_mean_bitrate_kbps = Math.max(e.VBR_mean_bitrate_kbps, 8), e.VBR_mean_bitrate_kbps = Math.min(e.VBR_mean_bitrate_kbps, 64)) : e.out_samplerate < 32e3 ? (e.VBR_mean_bitrate_kbps = Math.max(e.VBR_mean_bitrate_kbps, 8), e.VBR_mean_bitrate_kbps = Math.min(e.VBR_mean_bitrate_kbps, 160)) : (e.VBR_mean_bitrate_kbps = Math.max(e.VBR_mean_bitrate_kbps, 32), e.VBR_mean_bitrate_kbps = Math.min(e.VBR_mean_bitrate_kbps, 320))), 0 == e.lowpassfreq) {switch (e.VBR) {case m0.vbr_off:u(n = new l(), e.brate), n = n.lowerlimit;break;case m0.vbr_abr:u(n = new l(), e.VBR_mean_bitrate_kbps), n = n.lowerlimit;break;case m0.vbr_rh:var a,s = [19500, 19e3, 18600, 18e3, 17500, 16e3, 15600, 14900, 12500, 1e4, 3950],n = 0 <= e.VBR_q && e.VBR_q <= 9 ? (n = s[e.VBR_q], s = s[e.VBR_q + 1], a = e.VBR_q_frac, linear_int(n, s, a)) : 19500;break;default:s = [19500, 19e3, 18500, 18e3, 17500, 16500, 15500, 14500, 12500, 9500, 3950], n = 0 <= e.VBR_q && e.VBR_q <= 9 ? (n = s[e.VBR_q], s = s[e.VBR_q + 1], a = e.VBR_q_frac, linear_int(n, s, a)) : 19500;}e.mode != ee.MONO || e.VBR != m0.vbr_off && e.VBR != m0.vbr_abr || (n *= 1.5), e.lowpassfreq = 0 | n;}if (0 == e.out_samplerate && (e.in_samplerate < 2 * e.lowpassfreq && (e.lowpassfreq = e.in_samplerate / 2), a = 44100, 48e3 <= (s = e.in_samplerate) ? a = 48e3 : 44100 <= s ? a = 44100 : 32e3 <= s ? a = 32e3 : 24e3 <= s ? a = 24e3 : 22050 <= s ? a = 22050 : 16e3 <= s ? a = 16e3 : 12e3 <= s ? a = 12e3 : 11025 <= s ? a = 11025 : 8e3 <= s && (a = 8e3), n = -1 != (n = 0 | e.lowpassfreq) && (n <= 15960 && (a = 44100), n <= 15250 && (a = 32e3), n <= 11220 && (a = 24e3), n <= 9970 && (a = 22050), n <= 7230 && (a = 16e3), n <= 5420 && (a = 12e3), n <= 4510 && (a = 11025), s < (a = n <= 3970 ? 8e3 : a)) ? 44100 < s ? 48e3 : 32e3 < s ? 44100 : 24e3 < s ? 32e3 : 22050 < s ? 24e3 : 16e3 < s ? 22050 : 12e3 < s ? 16e3 : 11025 < s ? 12e3 : 8e3 < s ? 11025 : 8e3 : a, e.out_samplerate = n), e.lowpassfreq = Math.min(20500, e.lowpassfreq), e.lowpassfreq = Math.min(e.out_samplerate / 2, e.lowpassfreq), e.VBR == m0.vbr_off && (e.compression_ratio = 16 * e.out_samplerate * t.channels_out / (1e3 * e.brate)), e.VBR == m0.vbr_abr && (e.compression_ratio = 16 * e.out_samplerate * t.channels_out / (1e3 * e.VBR_mean_bitrate_kbps)), e.bWriteVbrTag || (e.findReplayGain = !1, t.findPeakSample = e.decode_on_the_fly = !1), t.findReplayGain = e.findReplayGain, t.decode_on_the_fly = e.decode_on_the_fly, t.decode_on_the_fly && (t.findPeakSample = !0), t.findReplayGain && n1.InitGainAnalysis(t.rgdata, e.out_samplerate) == r1.INIT_GAIN_ANALYSIS_ERROR) return e.internal_flags = null, -6;switch (t.decode_on_the_fly && !e.decode_only && (null != t.hip && S.hip_decode_exit(t.hip), t.hip = S.hip_decode_init()), t.mode_gr = e.out_samplerate <= 24e3 ? 1 : 2, e.framesize = 576 * t.mode_gr, e.encoder_delay = te.ENCDELAY, t.resample_ratio = e.in_samplerate / e.out_samplerate, e.VBR) {case m0.vbr_mt:case m0.vbr_rh:case m0.vbr_mtrh:e.compression_ratio = [5.7, 6.5, 7.3, 8.2, 10, 11.9, 13, 14, 15, 16.5][e.VBR_q];break;case m0.vbr_abr:e.compression_ratio = 16 * e.out_samplerate * t.channels_out / (1e3 * e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio = 16 * e.out_samplerate * t.channels_out / (1e3 * e.brate);}e.mode == ee.NOT_SET && (e.mode = ee.JOINT_STEREO), 0 < e.highpassfreq ? (t.highpass1 = 2 * e.highpassfreq, t.highpass2 = 0 <= e.highpasswidth ? 2 * (e.highpassfreq + e.highpasswidth) : 2 * e.highpassfreq, t.highpass1 /= e.out_samplerate, t.highpass2 /= e.out_samplerate) : (t.highpass1 = 0, t.highpass2 = 0), 0 < e.lowpassfreq ? (t.lowpass2 = 2 * e.lowpassfreq, 0 <= e.lowpasswidth ? (t.lowpass1 = 2 * (e.lowpassfreq - e.lowpasswidth), t.lowpass1 < 0 && (t.lowpass1 = 0)) : t.lowpass1 = 2 * e.lowpassfreq, t.lowpass1 /= e.out_samplerate, t.lowpass2 /= e.out_samplerate) : (t.lowpass1 = 0, t.lowpass2 = 0);var _ = 32,r = -1;if (0 < (n = e.internal_flags).lowpass1) {for (var i = 999, s = 0; s <= 31; s++) (a = s / 31) >= n.lowpass2 && (_ = Math.min(_, s)), n.lowpass1 < a && a < n.lowpass2 && (i = Math.min(i, s));n.lowpass1 = 999 == i ? (_ - .75) / 31 : (i - .75) / 31, n.lowpass2 = _ / 31;}if (0 < n.highpass2 && n.highpass2 < .75 / 31 * .9 && (n.highpass1 = 0, n.highpass2 = 0, N.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")), 0 < n.highpass2) {for (_ = -1, s = 0; s <= 31; s++) (a = s / 31) <= n.highpass1 && (r = Math.max(r, s)), n.highpass1 < a && a < n.highpass2 && (_ = Math.max(_, s));n.highpass1 = r / 31, n.highpass2 = -1 == _ ? (r + .75) / 31 : (_ + .75) / 31;}for (s = 0; s < 32; s++) a = s / 31, r = n.highpass2 > n.highpass1 ? f((n.highpass2 - a) / (n.highpass2 - n.highpass1 + 1e-20)) : 1, a = n.lowpass2 > n.lowpass1 ? f((a - n.lowpass1) / (n.lowpass2 - n.lowpass1 + 1e-20)) : 1, n.amp_filter[s] = r * a;if (t.samplerate_index = h(e.out_samplerate, e), t.samplerate_index < 0) return e.internal_flags = null, -1;if (e.VBR == m0.vbr_off) {if (e.free_format) t.bitrate_index = 0;else if (e.brate = c(e.brate, e.version, e.out_samplerate), t.bitrate_index = b(e.brate, e.version, e.out_samplerate), t.bitrate_index <= 0) return e.internal_flags = null, -1;} else t.bitrate_index = 1;for (e.analysis && (e.bWriteVbrTag = !1), null != t.pinfo && (e.bWriteVbrTag = !1), _1.init_bit_stream_w(t), n = t.samplerate_index + 3 * e.version + 6 * (e.out_samplerate < 16e3 ? 1 : 0), s = 0; s < te.SBMAX_l + 1; s++) t.scalefac_band.l[s] = m.sfBandIndex[n].l[s];for (s = 0; s < te.PSFB21 + 1; s++) a = (t.scalefac_band.l[22] - t.scalefac_band.l[21]) / te.PSFB21, a = t.scalefac_band.l[21] + s * a, t.scalefac_band.psfb21[s] = a;for (t.scalefac_band.psfb21[te.PSFB21] = 576, s = 0; s < te.SBMAX_s + 1; s++) t.scalefac_band.s[s] = m.sfBandIndex[n].s[s];for (s = 0; s < te.PSFB12 + 1; s++) a = (t.scalefac_band.s[13] - t.scalefac_band.s[12]) / te.PSFB12, a = t.scalefac_band.s[12] + s * a, t.scalefac_band.psfb12[s] = a;for (t.scalefac_band.psfb12[te.PSFB12] = 192, t.sideinfo_len = 1 == e.version ? 1 == t.channels_out ? 21 : 36 : 1 == t.channels_out ? 13 : 21, e.error_protection && (t.sideinfo_len += 2), n = e.internal_flags, e.frameNum = 0, e.write_id3tag_automatic && v.id3tag_write_v2(e), n.bitrate_stereoMode_Hist = M([16, 5]), n.bitrate_blockType_Hist = M([16, 6]), n.PeakSample = 0, e.bWriteVbrTag && g.InitVbrTag(e), t.Class_ID = 4294479419, n = 0; n < 19; n++) t.nsPsy.pefirbuf[n] = 700 * t.mode_gr * t.channels_out;switch (-1 == e.ATHtype && (e.ATHtype = 4), e.VBR) {case m0.vbr_mt:e.VBR = m0.vbr_mtrh;case m0.vbr_mtrh:null == e.useTemporal && (e.useTemporal = !1), p.apply_preset(e, 500 - 10 * e.VBR_q, 0), e.quality < 0 && (e.quality = LAME_DEFAULT_QUALITY), e.quality < 5 && (e.quality = 0), 5 < e.quality && (e.quality = 5), t.PSY.mask_adjust = e.maskingadjust, t.PSY.mask_adjust_short = e.maskingadjust_short, t.sfb21_extra = !e.experimentalY && 44e3 < e.out_samplerate, t.iteration_loop = new VBRNewIterationLoop(d);break;case m0.vbr_rh:p.apply_preset(e, 500 - 10 * e.VBR_q, 0), t.PSY.mask_adjust = e.maskingadjust, t.PSY.mask_adjust_short = e.maskingadjust_short, t.sfb21_extra = !e.experimentalY && 44e3 < e.out_samplerate, 6 < e.quality && (e.quality = 6), e.quality < 0 && (e.quality = LAME_DEFAULT_QUALITY), t.iteration_loop = new VBROldIterationLoop(d);break;default:t.sfb21_extra = !1, e.quality < 0 && (e.quality = LAME_DEFAULT_QUALITY), (n = e.VBR) == m0.vbr_off && (e.VBR_mean_bitrate_kbps = e.brate), p.apply_preset(e, e.VBR_mean_bitrate_kbps, 0), e.VBR = n, t.PSY.mask_adjust = e.maskingadjust, t.PSY.mask_adjust_short = e.maskingadjust_short, t.iteration_loop = new (n == m0.vbr_off ? Y : ABRIterationLoop)(d);}if (e.VBR != m0.vbr_off) {if (t.VBR_min_bitrate = 1, t.VBR_max_bitrate = 14, e.out_samplerate < 16e3 && (t.VBR_max_bitrate = 8), 0 != e.VBR_min_bitrate_kbps && (e.VBR_min_bitrate_kbps = c(e.VBR_min_bitrate_kbps, e.version, e.out_samplerate), t.VBR_min_bitrate = b(e.VBR_min_bitrate_kbps, e.version, e.out_samplerate), t.VBR_min_bitrate < 0) || 0 != e.VBR_max_bitrate_kbps && (e.VBR_max_bitrate_kbps = c(e.VBR_max_bitrate_kbps, e.version, e.out_samplerate), t.VBR_max_bitrate = b(e.VBR_max_bitrate_kbps, e.version, e.out_samplerate), t.VBR_max_bitrate < 0)) return -1;e.VBR_min_bitrate_kbps = V.bitrate_table[e.version][t.VBR_min_bitrate], e.VBR_max_bitrate_kbps = V.bitrate_table[e.version][t.VBR_max_bitrate], e.VBR_mean_bitrate_kbps = Math.min(V.bitrate_table[e.version][t.VBR_max_bitrate], e.VBR_mean_bitrate_kbps), e.VBR_mean_bitrate_kbps = Math.max(V.bitrate_table[e.version][t.VBR_min_bitrate], e.VBR_mean_bitrate_kbps);}switch (e.tune && (t.PSY.mask_adjust += e.tune_value_a, t.PSY.mask_adjust_short += e.tune_value_a), n = e.internal_flags, e.quality) {default:case 9:n.psymodel = 0, n.noise_shaping = 0, n.noise_shaping_amp = 0, n.noise_shaping_stop = 0, n.use_best_huffman = 0, n.full_outer_loop = 0;break;case 8:e.quality = 7;case 7:n.psymodel = 1, n.noise_shaping = 0, n.noise_shaping_amp = 0, n.noise_shaping_stop = 0, n.use_best_huffman = 0, n.full_outer_loop = 0;break;case 6:case 5:n.psymodel = 1, 0 == n.noise_shaping && (n.noise_shaping = 1), n.noise_shaping_amp = 0, n.noise_shaping_stop = 0, -1 == n.subblock_gain && (n.subblock_gain = 1), n.use_best_huffman = 0, n.full_outer_loop = 0;break;case 4:n.psymodel = 1, 0 == n.noise_shaping && (n.noise_shaping = 1), n.noise_shaping_amp = 0, n.noise_shaping_stop = 0, -1 == n.subblock_gain && (n.subblock_gain = 1), n.use_best_huffman = 1, n.full_outer_loop = 0;break;case 3:n.psymodel = 1, 0 == n.noise_shaping && (n.noise_shaping = 1), n.noise_shaping_amp = 1, -(n.noise_shaping_stop = 1) == n.subblock_gain && (n.subblock_gain = 1), n.use_best_huffman = 1, n.full_outer_loop = 0;break;case 2:n.psymodel = 1, 0 == n.noise_shaping && (n.noise_shaping = 1), 0 == n.substep_shaping && (n.substep_shaping = 2), n.noise_shaping_amp = 1, -(n.noise_shaping_stop = 1) == n.subblock_gain && (n.subblock_gain = 1), n.use_best_huffman = 1, n.full_outer_loop = 0;break;case 1:case 0:n.psymodel = 1, 0 == n.noise_shaping && (n.noise_shaping = 1), 0 == n.substep_shaping && (n.substep_shaping = 2), n.noise_shaping_amp = 2, -(n.noise_shaping_stop = 1) == n.subblock_gain && (n.subblock_gain = 1), n.use_best_huffman = 1, n.full_outer_loop = 0;}return t.ATH.useAdjust = e.athaa_type < 0 ? 3 : e.athaa_type, t.ATH.aaSensitivityP = Math.pow(10, e.athaa_sensitivity / -10), null == e.short_blocks && (e.short_blocks = $0.short_block_allowed), e.short_blocks != $0.short_block_allowed || e.mode != ee.JOINT_STEREO && e.mode != ee.STEREO || (e.short_blocks = $0.short_block_coupled), e.quant_comp < 0 && (e.quant_comp = 1), e.quant_comp_short < 0 && (e.quant_comp_short = 0), e.msfix < 0 && (e.msfix = 0), e.exp_nspsytune |= 1, e.internal_flags.nsPsy.attackthre < 0 && (e.internal_flags.nsPsy.attackthre = x.NSATTACKTHRE), e.internal_flags.nsPsy.attackthre_s < 0 && (e.internal_flags.nsPsy.attackthre_s = x.NSATTACKTHRE_S), e.scale < 0 && (e.scale = 1), e.ATHtype < 0 && (e.ATHtype = 4), e.ATHcurve < 0 && (e.ATHcurve = 4), e.athaa_loudapprox < 0 && (e.athaa_loudapprox = 2), e.interChRatio < 0 && (e.interChRatio = 0), null == e.useTemporal && (e.useTemporal = !0), t.slot_lag = t.frac_SpF = 0, e.VBR == m0.vbr_off && (t.slot_lag = t.frac_SpF = 72e3 * (e.version + 1) * e.brate % e.out_samplerate | 0), m.iteration_init(e), R.psymodel_init(e), 0;}, this.lame_encode_flush = function (e, t, a, s) {var n = e.internal_flags,_ = function e(t) {if (1 == t.length) return new Int16Array(t[0]);var a = t[0];t = t.slice(1);for (var s = [], n = 0; n < a; n++) s.push(e(t));return s;}([2, 1152]),r = 0,i = n.mf_samples_to_encode - te.POSTDELAY,o = e1(e);if (n.mf_samples_to_encode < 1) return 0;var l = 0,f = (e.in_samplerate != e.out_samplerate && (i += 16 * e.out_samplerate / e.in_samplerate), e.framesize - i % e.framesize);for (f < 576 && (f += e.framesize), f = (i + (e.encoder_padding = f)) / e.framesize; 0 < f && 0 <= r;) {var h = o - n.mf_size,i = e.frameNum;(h = 1152 < (h = (h *= e.in_samplerate) / e.out_samplerate) ? 1152 : h) < 1 && (h = 1), r = s - l, a += r = this.lame_encode_buffer(e, _[0], _[1], h, t, a, r = 0 == s ? 0 : r), l += r, f -= i != e.frameNum ? 1 : 0;}if (r < (n.mf_samples_to_encode = 0)) return r;if (r = 0 == s ? 0 : s - l, _1.flush_bitstream(e), (r = _1.copy_buffer(n, t, a, r, 1)) < 0) return r;if (a += r, r = s - (l += r), 0 == s && (r = 0), e.write_id3tag_automatic) {if (v.id3tag_write_v1(e), (r = _1.copy_buffer(n, t, a, r, 0)) < 0) return r;l += r;}return l;}, this.lame_encode_buffer = function (L, N, D, e, X, Y, q) {var t = L.internal_flags,a = [null, null];if (4294479419 != t.Class_ID) return -3;if (0 == e) return 0;(null == t.in_buffer_0 || t.in_buffer_nsamples < e) && (t.in_buffer_0 = W0(e), t.in_buffer_1 = W0(e), t.in_buffer_nsamples = e), a[0] = t.in_buffer_0, a[1] = t.in_buffer_1;for (var s = 0; s < e; s++) a[0][s] = N[s], 1 < t.channels_in && (a[1][s] = D[s]);var n = L,_ = a[0],r = a[1],i = e,C = X,o = Y,l = q,f = n.internal_flags,h = 0,c = [null, null],b = [null, null];if (4294479419 != f.Class_ID) return -3;if (0 == i) return 0;var u = _1.copy_buffer(f, C, o, l, 0);if (u < 0) return u;if (o += u, h += u, b[0] = _, b[1] = r, i1.NEQ(n.scale, 0) && i1.NEQ(n.scale, 1)) for (u = 0; u < i; ++u) b[0][u] *= n.scale, 2 == f.channels_out && (b[1][u] *= n.scale);if (i1.NEQ(n.scale_left, 0) && i1.NEQ(n.scale_left, 1)) for (u = 0; u < i; ++u) b[0][u] *= n.scale_left;if (i1.NEQ(n.scale_right, 0) && i1.NEQ(n.scale_right, 1)) for (u = 0; u < i; ++u) b[1][u] *= n.scale_right;if (2 == n.num_channels && 1 == f.channels_out) for (u = 0; u < i; ++u) b[0][u] = .5 * (b[0][u] + b[1][u]), b[1][u] = 0;for (_ = e1(n), c[0] = f.mfbuf[0], c[1] = f.mfbuf[1], r = 0; 0 < i;) {var p = [null, null],m = (p[0] = b[0], p[1] = b[1], n),d = c,g = r,F = i,v = u = new t1(),S = m.internal_flags;if (S.resample_ratio < .9999 || 1.0001 < S.resample_ratio) for (var R = 0; R < S.channels_out; R++) {var j = new a1(),G = v,z = d[R],K = S.mf_size,Z = m.framesize,Q = p[R],U = g,W = F,M = j,A = R,B = m.internal_flags,w = 0,T = m.out_samplerate / function e(t, a) {return 0 != a ? e(a, t % a) : t;}(m.out_samplerate, m.in_samplerate),E = (o1.BPC < T && (T = o1.BPC), Math.abs(B.resample_ratio - Math.floor(.5 + B.resample_ratio)) < 1e-4 ? 1 : 0),k = 1 / B.resample_ratio,y = (1 < k && (k = 1), 31);if (0 == y % 2 && --y, E = (y += E) + 1, 0 == B.fill_buffer_resample_init) {for (B.inbuf_old[0] = W0(E), B.inbuf_old[1] = W0(E), I = 0; I <= 2 * T; ++I) B.blackfilt[I] = W0(E);for (B.itime[0] = 0, w = B.itime[1] = 0; w <= 2 * T; w++) {for (var x = 0, P = (w - T) / (2 * T), I = 0; I <= y; I++) {var H = B.blackfilt[w],V = I,O = I - P,J = Math.PI * k,$ = (O = 1 < (O = (O /= y) < 0 ? 0 : O) ? 1 : O) - .5,O = .42 - .5 * Math.cos(2 * O * Math.PI) + .08 * Math.cos(4 * O * Math.PI);x += H[V] = Math.abs($) < 1e-9 ? J / Math.PI : O * Math.sin(y * J * $) / (Math.PI * y * $);}for (I = 0; I <= y; I++) B.blackfilt[w][I] /= x;}B.fill_buffer_resample_init = 1;}for (x = B.inbuf_old[A], k = 0; k < Z && (I = k * B.resample_ratio, !(W <= y + (w = 0 | Math.floor(I - B.itime[A])) - y / 2)); k++) {for (P = I - B.itime[A] - (w + y % 2 * .5), P = 0 | Math.floor(2 * P * T + T + .5), I = H = 0; I <= y; ++I) H += ((V = 0 | I + w - y / 2) < 0 ? x[E + V] : Q[U + V]) * B.blackfilt[P][I];z[K + k] = H;}if (M.num_used = Math.min(W, y + w - y / 2), B.itime[A] += M.num_used - k * B.resample_ratio, M.num_used >= E) for (I = 0; I < E; I++) x[I] = Q[U + M.num_used + I - E];else {for (z = E - M.num_used, I = 0; I < z; ++I) x[I] = x[I + M.num_used];for (w = 0; I < E; ++I, ++w) x[I] = Q[U + w];}G.n_out = k, v.n_in = j.num_used;} else for (v.n_out = Math.min(m.framesize, F), v.n_in = v.n_out, m = 0; m < v.n_out; ++m) d[0][S.mf_size + m] = p[0][g + m], 2 == S.channels_out && (d[1][S.mf_size + m] = p[1][g + m]);if (d = u.n_in, u = u.n_out, f.findReplayGain && !f.decode_on_the_fly && n1.AnalyzeSamples(f.rgdata, c[0], f.mf_size, c[1], f.mf_size, u, f.channels_out) == r1.GAIN_ANALYSIS_ERROR) return -6;if (i -= d, r += d, f.mf_size += u, f.mf_samples_to_encode < 1 && (f.mf_samples_to_encode = te.ENCDELAY + te.POSTDELAY), f.mf_samples_to_encode += u, f.mf_size >= _) {if (d = l - h, d = s1.enc.lame_encode_mp3_frame(u = n, c[0], c[1], C, o, d = 0 == l ? 0 : d), u.frameNum++, (u = d) < 0) return u;for (o += u, h += u, f.mf_size -= n.framesize, f.mf_samples_to_encode -= n.framesize, d = 0; d < f.channels_out; d++) for (u = 0; u < f.mf_size; u++) c[d][u] = c[d][u + n.framesize];}}return h;};}function j() {this.setModules = function (e, t) {};}function G() {this.setModules = function (e, t, a) {};}function z() {}function K() {this.setModules = function (e, t) {};}function r() {this.sampleRate = this.channels = this.dataLen = this.dataOffset = 0;}function n(e) {return e.charCodeAt(0) << 24 | e.charCodeAt(1) << 16 | e.charCodeAt(2) << 8 | e.charCodeAt(3);}var d0 = { fill: function fill(e, t, a, s) {if (2 == arguments.length) for (var n = 0; n < e.length; n++) e[n] = t;else for (n = t; n < a; n++) e[n] = s;} },N = { arraycopy: function arraycopy(e, t, a, s, n) {for (n = t + n; t < n;) a[s++] = e[t++];} },ae = { SQRT2: 1.4142135623730951, FAST_LOG10: function FAST_LOG10(e) {return Math.log10(e);}, FAST_LOG10_X: function FAST_LOG10_X(e, t) {return Math.log10(e) * t;} },H = ($0.short_block_allowed = new $0(0), $0.short_block_coupled = new $0(1), $0.short_block_dispensed = new $0(2), $0.short_block_forced = new $0(3), { MAX_VALUE: 34028235e31 }),V = (m0.vbr_off = new m0(0), m0.vbr_mt = new m0(1), m0.vbr_rh = new m0(2), m0.vbr_abr = new m0(3), m0.vbr_mtrh = new m0(4), m0.vbr_default = m0.vbr_mtrh, ee.STEREO = new ee(0), ee.JOINT_STEREO = new ee(1), ee.DUAL_CHANNEL = new ee(2), ee.MONO = new ee(3), ee.NOT_SET = new ee(4), r1.STEPS_per_dB = 100, r1.MAX_dB = 120, r1.GAIN_NOT_ENOUGH_SAMPLES = -24601, r1.GAIN_ANALYSIS_ERROR = 0, r1.GAIN_ANALYSIS_OK = 1, r1.INIT_GAIN_ANALYSIS_ERROR = 0, r1.INIT_GAIN_ANALYSIS_OK = 1, r1.MAX_ORDER = r1.YULE_ORDER = 10, r1.MAX_SAMPLES_PER_WINDOW = (r1.MAX_SAMP_FREQ = 48e3) * (r1.RMS_WINDOW_TIME_NUMERATOR = 1) / (r1.RMS_WINDOW_TIME_DENOMINATOR = 20) + 1, i1.EQ = function (e, t) {return Math.abs(e) > Math.abs(t) ? Math.abs(e - t) <= 1e-6 * Math.abs(e) : Math.abs(e - t) <= 1e-6 * Math.abs(t);}, i1.NEQ = function (e, t) {return !i1.EQ(e, t);}, P.NUMTOCENTRIES = 100, P.MAXFRAMESIZE = 2880, { t1HB: [1, 1, 1, 0], t2HB: [1, 2, 1, 3, 1, 1, 3, 2, 0], t3HB: [3, 2, 1, 1, 1, 1, 3, 2, 0], t5HB: [1, 2, 6, 5, 3, 1, 4, 4, 7, 5, 7, 1, 6, 1, 1, 0], t6HB: [7, 3, 5, 1, 6, 2, 3, 2, 5, 4, 4, 1, 3, 3, 2, 0], t7HB: [1, 2, 10, 19, 16, 10, 3, 3, 7, 10, 5, 3, 11, 4, 13, 17, 8, 4, 12, 11, 18, 15, 11, 2, 7, 6, 9, 14, 3, 1, 6, 4, 5, 3, 2, 0], t8HB: [3, 4, 6, 18, 12, 5, 5, 1, 2, 16, 9, 3, 7, 3, 5, 14, 7, 3, 19, 17, 15, 13, 10, 4, 13, 5, 8, 11, 5, 1, 12, 4, 4, 1, 1, 0], t9HB: [7, 5, 9, 14, 15, 7, 6, 4, 5, 5, 6, 7, 7, 6, 8, 8, 8, 5, 15, 6, 9, 10, 5, 1, 11, 7, 9, 6, 4, 1, 14, 4, 6, 2, 6, 0], t10HB: [1, 2, 10, 23, 35, 30, 12, 17, 3, 3, 8, 12, 18, 21, 12, 7, 11, 9, 15, 21, 32, 40, 19, 6, 14, 13, 22, 34, 46, 23, 18, 7, 20, 19, 33, 47, 27, 22, 9, 3, 31, 22, 41, 26, 21, 20, 5, 3, 14, 13, 10, 11, 16, 6, 5, 1, 9, 8, 7, 8, 4, 4, 2, 0], t11HB: [3, 4, 10, 24, 34, 33, 21, 15, 5, 3, 4, 10, 32, 17, 11, 10, 11, 7, 13, 18, 30, 31, 20, 5, 25, 11, 19, 59, 27, 18, 12, 5, 35, 33, 31, 58, 30, 16, 7, 5, 28, 26, 32, 19, 17, 15, 8, 14, 14, 12, 9, 13, 14, 9, 4, 1, 11, 4, 6, 6, 6, 3, 2, 0], t12HB: [9, 6, 16, 33, 41, 39, 38, 26, 7, 5, 6, 9, 23, 16, 26, 11, 17, 7, 11, 14, 21, 30, 10, 7, 17, 10, 15, 12, 18, 28, 14, 5, 32, 13, 22, 19, 18, 16, 9, 5, 40, 17, 31, 29, 17, 13, 4, 2, 27, 12, 11, 15, 10, 7, 4, 1, 27, 12, 8, 12, 6, 3, 1, 0], t13HB: [1, 5, 14, 21, 34, 51, 46, 71, 42, 52, 68, 52, 67, 44, 43, 19, 3, 4, 12, 19, 31, 26, 44, 33, 31, 24, 32, 24, 31, 35, 22, 14, 15, 13, 23, 36, 59, 49, 77, 65, 29, 40, 30, 40, 27, 33, 42, 16, 22, 20, 37, 61, 56, 79, 73, 64, 43, 76, 56, 37, 26, 31, 25, 14, 35, 16, 60, 57, 97, 75, 114, 91, 54, 73, 55, 41, 48, 53, 23, 24, 58, 27, 50, 96, 76, 70, 93, 84, 77, 58, 79, 29, 74, 49, 41, 17, 47, 45, 78, 74, 115, 94, 90, 79, 69, 83, 71, 50, 59, 38, 36, 15, 72, 34, 56, 95, 92, 85, 91, 90, 86, 73, 77, 65, 51, 44, 43, 42, 43, 20, 30, 44, 55, 78, 72, 87, 78, 61, 46, 54, 37, 30, 20, 16, 53, 25, 41, 37, 44, 59, 54, 81, 66, 76, 57, 54, 37, 18, 39, 11, 35, 33, 31, 57, 42, 82, 72, 80, 47, 58, 55, 21, 22, 26, 38, 22, 53, 25, 23, 38, 70, 60, 51, 36, 55, 26, 34, 23, 27, 14, 9, 7, 34, 32, 28, 39, 49, 75, 30, 52, 48, 40, 52, 28, 18, 17, 9, 5, 45, 21, 34, 64, 56, 50, 49, 45, 31, 19, 12, 15, 10, 7, 6, 3, 48, 23, 20, 39, 36, 35, 53, 21, 16, 23, 13, 10, 6, 1, 4, 2, 16, 15, 17, 27, 25, 20, 29, 11, 17, 12, 16, 8, 1, 1, 0, 1], t15HB: [7, 12, 18, 53, 47, 76, 124, 108, 89, 123, 108, 119, 107, 81, 122, 63, 13, 5, 16, 27, 46, 36, 61, 51, 42, 70, 52, 83, 65, 41, 59, 36, 19, 17, 15, 24, 41, 34, 59, 48, 40, 64, 50, 78, 62, 80, 56, 33, 29, 28, 25, 43, 39, 63, 55, 93, 76, 59, 93, 72, 54, 75, 50, 29, 52, 22, 42, 40, 67, 57, 95, 79, 72, 57, 89, 69, 49, 66, 46, 27, 77, 37, 35, 66, 58, 52, 91, 74, 62, 48, 79, 63, 90, 62, 40, 38, 125, 32, 60, 56, 50, 92, 78, 65, 55, 87, 71, 51, 73, 51, 70, 30, 109, 53, 49, 94, 88, 75, 66, 122, 91, 73, 56, 42, 64, 44, 21, 25, 90, 43, 41, 77, 73, 63, 56, 92, 77, 66, 47, 67, 48, 53, 36, 20, 71, 34, 67, 60, 58, 49, 88, 76, 67, 106, 71, 54, 38, 39, 23, 15, 109, 53, 51, 47, 90, 82, 58, 57, 48, 72, 57, 41, 23, 27, 62, 9, 86, 42, 40, 37, 70, 64, 52, 43, 70, 55, 42, 25, 29, 18, 11, 11, 118, 68, 30, 55, 50, 46, 74, 65, 49, 39, 24, 16, 22, 13, 14, 7, 91, 44, 39, 38, 34, 63, 52, 45, 31, 52, 28, 19, 14, 8, 9, 3, 123, 60, 58, 53, 47, 43, 32, 22, 37, 24, 17, 12, 15, 10, 2, 1, 71, 37, 34, 30, 28, 20, 17, 26, 21, 16, 10, 6, 8, 6, 2, 0], t16HB: [1, 5, 14, 44, 74, 63, 110, 93, 172, 149, 138, 242, 225, 195, 376, 17, 3, 4, 12, 20, 35, 62, 53, 47, 83, 75, 68, 119, 201, 107, 207, 9, 15, 13, 23, 38, 67, 58, 103, 90, 161, 72, 127, 117, 110, 209, 206, 16, 45, 21, 39, 69, 64, 114, 99, 87, 158, 140, 252, 212, 199, 387, 365, 26, 75, 36, 68, 65, 115, 101, 179, 164, 155, 264, 246, 226, 395, 382, 362, 9, 66, 30, 59, 56, 102, 185, 173, 265, 142, 253, 232, 400, 388, 378, 445, 16, 111, 54, 52, 100, 184, 178, 160, 133, 257, 244, 228, 217, 385, 366, 715, 10, 98, 48, 91, 88, 165, 157, 148, 261, 248, 407, 397, 372, 380, 889, 884, 8, 85, 84, 81, 159, 156, 143, 260, 249, 427, 401, 392, 383, 727, 713, 708, 7, 154, 76, 73, 141, 131, 256, 245, 426, 406, 394, 384, 735, 359, 710, 352, 11, 139, 129, 67, 125, 247, 233, 229, 219, 393, 743, 737, 720, 885, 882, 439, 4, 243, 120, 118, 115, 227, 223, 396, 746, 742, 736, 721, 712, 706, 223, 436, 6, 202, 224, 222, 218, 216, 389, 386, 381, 364, 888, 443, 707, 440, 437, 1728, 4, 747, 211, 210, 208, 370, 379, 734, 723, 714, 1735, 883, 877, 876, 3459, 865, 2, 377, 369, 102, 187, 726, 722, 358, 711, 709, 866, 1734, 871, 3458, 870, 434, 0, 12, 10, 7, 11, 10, 17, 11, 9, 13, 12, 10, 7, 5, 3, 1, 3], t24HB: [15, 13, 46, 80, 146, 262, 248, 434, 426, 669, 653, 649, 621, 517, 1032, 88, 14, 12, 21, 38, 71, 130, 122, 216, 209, 198, 327, 345, 319, 297, 279, 42, 47, 22, 41, 74, 68, 128, 120, 221, 207, 194, 182, 340, 315, 295, 541, 18, 81, 39, 75, 70, 134, 125, 116, 220, 204, 190, 178, 325, 311, 293, 271, 16, 147, 72, 69, 135, 127, 118, 112, 210, 200, 188, 352, 323, 306, 285, 540, 14, 263, 66, 129, 126, 119, 114, 214, 202, 192, 180, 341, 317, 301, 281, 262, 12, 249, 123, 121, 117, 113, 215, 206, 195, 185, 347, 330, 308, 291, 272, 520, 10, 435, 115, 111, 109, 211, 203, 196, 187, 353, 332, 313, 298, 283, 531, 381, 17, 427, 212, 208, 205, 201, 193, 186, 177, 169, 320, 303, 286, 268, 514, 377, 16, 335, 199, 197, 191, 189, 181, 174, 333, 321, 305, 289, 275, 521, 379, 371, 11, 668, 184, 183, 179, 175, 344, 331, 314, 304, 290, 277, 530, 383, 373, 366, 10, 652, 346, 171, 168, 164, 318, 309, 299, 287, 276, 263, 513, 375, 368, 362, 6, 648, 322, 316, 312, 307, 302, 292, 284, 269, 261, 512, 376, 370, 364, 359, 4, 620, 300, 296, 294, 288, 282, 273, 266, 515, 380, 374, 369, 365, 361, 357, 2, 1033, 280, 278, 274, 267, 264, 259, 382, 378, 372, 367, 363, 360, 358, 356, 0, 43, 20, 19, 17, 15, 13, 11, 9, 7, 6, 4, 7, 5, 3, 1, 3], t32HB: [1, 10, 8, 20, 12, 20, 16, 32, 14, 12, 24, 0, 28, 16, 24, 16], t33HB: [15, 28, 26, 48, 22, 40, 36, 64, 14, 24, 20, 32, 12, 16, 8, 0], t1l: [1, 4, 3, 5], t2l: [1, 4, 7, 4, 5, 7, 6, 7, 8], t3l: [2, 3, 7, 4, 4, 7, 6, 7, 8], t5l: [1, 4, 7, 8, 4, 5, 8, 9, 7, 8, 9, 10, 8, 8, 9, 10], t6l: [3, 4, 6, 8, 4, 4, 6, 7, 5, 6, 7, 8, 7, 7, 8, 9], t7l: [1, 4, 7, 9, 9, 10, 4, 6, 8, 9, 9, 10, 7, 7, 9, 10, 10, 11, 8, 9, 10, 11, 11, 11, 8, 9, 10, 11, 11, 12, 9, 10, 11, 12, 12, 12], t8l: [2, 4, 7, 9, 9, 10, 4, 4, 6, 10, 10, 10, 7, 6, 8, 10, 10, 11, 9, 10, 10, 11, 11, 12, 9, 9, 10, 11, 12, 12, 10, 10, 11, 11, 13, 13], t9l: [3, 4, 6, 7, 9, 10, 4, 5, 6, 7, 8, 10, 5, 6, 7, 8, 9, 10, 7, 7, 8, 9, 9, 10, 8, 8, 9, 9, 10, 11, 9, 9, 10, 10, 11, 11], t10l: [1, 4, 7, 9, 10, 10, 10, 11, 4, 6, 8, 9, 10, 11, 10, 10, 7, 8, 9, 10, 11, 12, 11, 11, 8, 9, 10, 11, 12, 12, 11, 12, 9, 10, 11, 12, 12, 12, 12, 12, 10, 11, 12, 12, 13, 13, 12, 13, 9, 10, 11, 12, 12, 12, 13, 13, 10, 10, 11, 12, 12, 13, 13, 13], t11l: [2, 4, 6, 8, 9, 10, 9, 10, 4, 5, 6, 8, 10, 10, 9, 10, 6, 7, 8, 9, 10, 11, 10, 10, 8, 8, 9, 11, 10, 12, 10, 11, 9, 10, 10, 11, 11, 12, 11, 12, 9, 10, 11, 12, 12, 13, 12, 13, 9, 9, 9, 10, 11, 12, 12, 12, 9, 9, 10, 11, 12, 12, 12, 12], t12l: [4, 4, 6, 8, 9, 10, 10, 10, 4, 5, 6, 7, 9, 9, 10, 10, 6, 6, 7, 8, 9, 10, 9, 10, 7, 7, 8, 8, 9, 10, 10, 10, 8, 8, 9, 9, 10, 10, 10, 11, 9, 9, 10, 10, 10, 11, 10, 11, 9, 9, 9, 10, 10, 11, 11, 12, 10, 10, 10, 11, 11, 11, 11, 12], t13l: [1, 5, 7, 8, 9, 10, 10, 11, 10, 11, 12, 12, 13, 13, 14, 14, 4, 6, 8, 9, 10, 10, 11, 11, 11, 11, 12, 12, 13, 14, 14, 14, 7, 8, 9, 10, 11, 11, 12, 12, 11, 12, 12, 13, 13, 14, 15, 15, 8, 9, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 15, 15, 9, 9, 11, 11, 12, 12, 13, 13, 12, 13, 13, 14, 14, 15, 15, 16, 10, 10, 11, 12, 12, 12, 13, 13, 13, 13, 14, 13, 15, 15, 16, 16, 10, 11, 12, 12, 13, 13, 13, 13, 13, 14, 14, 14, 15, 15, 16, 16, 11, 11, 12, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 16, 18, 18, 10, 10, 11, 12, 12, 13, 13, 14, 14, 14, 14, 15, 15, 16, 17, 17, 11, 11, 12, 12, 13, 13, 13, 15, 14, 15, 15, 16, 16, 16, 18, 17, 11, 12, 12, 13, 13, 14, 14, 15, 14, 15, 16, 15, 16, 17, 18, 19, 12, 12, 12, 13, 14, 14, 14, 14, 15, 15, 15, 16, 17, 17, 17, 18, 12, 13, 13, 14, 14, 15, 14, 15, 16, 16, 17, 17, 17, 18, 18, 18, 13, 13, 14, 15, 15, 15, 16, 16, 16, 16, 16, 17, 18, 17, 18, 18, 14, 14, 14, 15, 15, 15, 17, 16, 16, 19, 17, 17, 17, 19, 18, 18, 13, 14, 15, 16, 16, 16, 17, 16, 17, 17, 18, 18, 21, 20, 21, 18], t15l: [3, 5, 6, 8, 8, 9, 10, 10, 10, 11, 11, 12, 12, 12, 13, 14, 5, 5, 7, 8, 9, 9, 10, 10, 10, 11, 11, 12, 12, 12, 13, 13, 6, 7, 7, 8, 9, 9, 10, 10, 10, 11, 11, 12, 12, 13, 13, 13, 7, 8, 8, 9, 9, 10, 10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 8, 8, 9, 9, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 13, 13, 9, 9, 9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 13, 13, 13, 14, 10, 9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 13, 14, 14, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 14, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 14, 14, 14, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 13, 14, 15, 14, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 15, 12, 12, 11, 12, 12, 12, 13, 13, 13, 13, 13, 13, 14, 14, 15, 15, 12, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 14, 15, 15, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 14, 15, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 15, 15, 15, 15], t16_5l: [1, 5, 7, 9, 10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 14, 11, 4, 6, 8, 9, 10, 11, 11, 11, 12, 12, 12, 13, 14, 13, 14, 11, 7, 8, 9, 10, 11, 11, 12, 12, 13, 12, 13, 13, 13, 14, 14, 12, 9, 9, 10, 11, 11, 12, 12, 12, 13, 13, 14, 14, 14, 15, 15, 13, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 12, 10, 10, 11, 11, 12, 13, 13, 14, 13, 14, 14, 15, 15, 15, 16, 13, 11, 11, 11, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 16, 13, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 17, 17, 13, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 13, 12, 12, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 15, 16, 15, 14, 12, 13, 12, 13, 14, 14, 14, 14, 15, 16, 16, 16, 17, 17, 16, 13, 13, 13, 13, 13, 14, 14, 15, 16, 16, 16, 16, 16, 16, 15, 16, 14, 13, 14, 14, 14, 14, 15, 15, 15, 15, 17, 16, 16, 16, 16, 18, 14, 15, 14, 14, 14, 15, 15, 16, 16, 16, 18, 17, 17, 17, 19, 17, 14, 14, 15, 13, 14, 16, 16, 15, 16, 16, 17, 18, 17, 19, 17, 16, 14, 11, 11, 11, 12, 12, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 12], t16l: [1, 5, 7, 9, 10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 14, 10, 4, 6, 8, 9, 10, 11, 11, 11, 12, 12, 12, 13, 14, 13, 14, 10, 7, 8, 9, 10, 11, 11, 12, 12, 13, 12, 13, 13, 13, 14, 14, 11, 9, 9, 10, 11, 11, 12, 12, 12, 13, 13, 14, 14, 14, 15, 15, 12, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 11, 10, 10, 11, 11, 12, 13, 13, 14, 13, 14, 14, 15, 15, 15, 16, 12, 11, 11, 11, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 16, 12, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 17, 17, 12, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 12, 12, 12, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 15, 16, 15, 13, 12, 13, 12, 13, 14, 14, 14, 14, 15, 16, 16, 16, 17, 17, 16, 12, 13, 13, 13, 13, 14, 14, 15, 16, 16, 16, 16, 16, 16, 15, 16, 13, 13, 14, 14, 14, 14, 15, 15, 15, 15, 17, 16, 16, 16, 16, 18, 13, 15, 14, 14, 14, 15, 15, 16, 16, 16, 18, 17, 17, 17, 19, 17, 13, 14, 15, 13, 14, 16, 16, 15, 16, 16, 17, 18, 17, 19, 17, 16, 13, 10, 10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 10], t24l: [4, 5, 7, 8, 9, 10, 10, 11, 11, 12, 12, 12, 12, 12, 13, 10, 5, 6, 7, 8, 9, 10, 10, 11, 11, 11, 12, 12, 12, 12, 12, 10, 7, 7, 8, 9, 9, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 9, 8, 8, 9, 9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 12, 12, 12, 12, 13, 9, 10, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 9, 10, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 9, 11, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 10, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 10, 12, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 10, 12, 12, 11, 11, 11, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 10, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 10, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 10, 13, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 10, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 6], t32l: [1, 5, 5, 7, 5, 8, 7, 9, 5, 7, 7, 9, 7, 9, 9, 10], t33l: [4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8] }),D = (V.ht = [new e(0, 0, null, null), new e(2, 0, V.t1HB, V.t1l), new e(3, 0, V.t2HB, V.t2l), new e(3, 0, V.t3HB, V.t3l), new e(0, 0, null, null), new e(4, 0, V.t5HB, V.t5l), new e(4, 0, V.t6HB, V.t6l), new e(6, 0, V.t7HB, V.t7l), new e(6, 0, V.t8HB, V.t8l), new e(6, 0, V.t9HB, V.t9l), new e(8, 0, V.t10HB, V.t10l), new e(8, 0, V.t11HB, V.t11l), new e(8, 0, V.t12HB, V.t12l), new e(16, 0, V.t13HB, V.t13l), new e(0, 0, null, V.t16_5l), new e(16, 0, V.t15HB, V.t15l), new e(1, 1, V.t16HB, V.t16l), new e(2, 3, V.t16HB, V.t16l), new e(3, 7, V.t16HB, V.t16l), new e(4, 15, V.t16HB, V.t16l), new e(6, 63, V.t16HB, V.t16l), new e(8, 255, V.t16HB, V.t16l), new e(10, 1023, V.t16HB, V.t16l), new e(13, 8191, V.t16HB, V.t16l), new e(4, 15, V.t24HB, V.t24l), new e(5, 31, V.t24HB, V.t24l), new e(6, 63, V.t24HB, V.t24l), new e(7, 127, V.t24HB, V.t24l), new e(8, 255, V.t24HB, V.t24l), new e(9, 511, V.t24HB, V.t24l), new e(11, 2047, V.t24HB, V.t24l), new e(13, 8191, V.t24HB, V.t24l), new e(0, 0, V.t32HB, V.t32l), new e(0, 0, V.t33HB, V.t33l)], V.largetbl = [65540, 327685, 458759, 589832, 655369, 655370, 720906, 720907, 786443, 786444, 786444, 851980, 851980, 851980, 917517, 655370, 262149, 393222, 524295, 589832, 655369, 720906, 720906, 720907, 786443, 786443, 786444, 851980, 917516, 851980, 917516, 655370, 458759, 524295, 589832, 655369, 720905, 720906, 786442, 786443, 851979, 786443, 851979, 851980, 851980, 917516, 917517, 720905, 589832, 589832, 655369, 720905, 720906, 786442, 786442, 786443, 851979, 851979, 917515, 917516, 917516, 983052, 983052, 786441, 655369, 655369, 720905, 720906, 786442, 786442, 851978, 851979, 851979, 917515, 917516, 917516, 983052, 983052, 983053, 720905, 655370, 655369, 720906, 720906, 786442, 851978, 851979, 917515, 851979, 917515, 917516, 983052, 983052, 983052, 1048588, 786441, 720906, 720906, 720906, 786442, 851978, 851979, 851979, 851979, 917515, 917516, 917516, 917516, 983052, 983052, 1048589, 786441, 720907, 720906, 786442, 786442, 851979, 851979, 851979, 917515, 917516, 983052, 983052, 983052, 983052, 1114125, 1114125, 786442, 720907, 786443, 786443, 851979, 851979, 851979, 917515, 917515, 983051, 983052, 983052, 983052, 1048588, 1048589, 1048589, 786442, 786443, 786443, 786443, 851979, 851979, 917515, 917515, 983052, 983052, 983052, 983052, 1048588, 983053, 1048589, 983053, 851978, 786444, 851979, 786443, 851979, 917515, 917516, 917516, 917516, 983052, 1048588, 1048588, 1048589, 1114125, 1114125, 1048589, 786442, 851980, 851980, 851979, 851979, 917515, 917516, 983052, 1048588, 1048588, 1048588, 1048588, 1048589, 1048589, 983053, 1048589, 851978, 851980, 917516, 917516, 917516, 917516, 983052, 983052, 983052, 983052, 1114124, 1048589, 1048589, 1048589, 1048589, 1179661, 851978, 983052, 917516, 917516, 917516, 983052, 983052, 1048588, 1048588, 1048589, 1179661, 1114125, 1114125, 1114125, 1245197, 1114125, 851978, 917517, 983052, 851980, 917516, 1048588, 1048588, 983052, 1048589, 1048589, 1114125, 1179661, 1114125, 1245197, 1114125, 1048589, 851978, 655369, 655369, 655369, 720905, 720905, 786441, 786441, 786441, 851977, 851977, 851977, 851978, 851978, 851978, 851978, 655366], V.table23 = [65538, 262147, 458759, 262148, 327684, 458759, 393222, 458759, 524296], V.table56 = [65539, 262148, 458758, 524296, 262148, 327684, 524294, 589831, 458757, 524294, 589831, 655368, 524295, 524295, 589832, 655369], V.bitrate_table = [[0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1], [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, -1], [0, 8, 16, 24, 32, 40, 48, 56, 64, -1, -1, -1, -1, -1, -1, -1]], V.samplerate_table = [[22050, 24e3, 16e3, -1], [44100, 48e3, 32e3, -1], [11025, 12e3, 8e3, -1]], V.scfsi_band = [0, 6, 11, 16, 21], k.Q_MAX = 257, k.Q_MAX2 = 116, k.LARGE_BITS = 1e5, k.IXMAX_VAL = 8206, {});D.SFBMAX = 3 * te.SBMAX_s, te.ENCDELAY = 576, te.POSTDELAY = 1152, te.FFTOFFSET = 224 + (te.MDCTDELAY = 48), te.DECDELAY = 528, te.SBLIMIT = 32, te.CBANDS = 64, te.SBPSY_l = 21, te.SBPSY_s = 12, te.SBMAX_l = 22, te.SBMAX_s = 13, te.PSFB21 = 6, te.PSFB12 = 6, te.HBLKSIZE = (te.BLKSIZE = 1024) / 2 + 1, te.HBLKSIZE_s = (te.BLKSIZE_s = 256) / 2 + 1, te.NORM_TYPE = 0, te.START_TYPE = 1, te.SHORT_TYPE = 2, te.STOP_TYPE = 3, te.MPG_MD_LR_LR = 0, te.MPG_MD_LR_I = 1, te.MPG_MD_MS_LR = 2, te.MPG_MD_MS_I = 3, te.fircoef = [-.1039435, -.1892065, 5 * -.0432472, -.155915, 3898045e-23, .0467745 * 5, .50455, .756825, .187098 * 5], o1.MFSIZE = 3456 + te.ENCDELAY - te.MDCTDELAY, o1.MAX_HEADER_BUF = 256, o1.MAX_BITS_PER_CHANNEL = 4095, o1.MAX_BITS_PER_GRANULE = 7680, o1.BPC = 320, r.RIFF = n("RIFF"), r.WAVE = n("WAVE"), r.fmt_ = n("fmt "), r.data = n("data"), r.readHeader = function (e) {var t = new r(),a = e.getUint32(0, !1);if (r.RIFF == a && (e.getUint32(4, !0), r.WAVE == e.getUint32(8, !1)) && r.fmt_ == e.getUint32(12, !1)) {var s = 20;switch (n = e.getUint32(16, !0)) {case 16:case 18:t.channels = e.getUint16(s + 2, !0), t.sampleRate = e.getUint32(s + 4, !0);break;default:throw "extended fmt chunk not implemented";}s += n;for (var n = r.data, _ = 0; n != a && (a = e.getUint32(s, !1), _ = e.getUint32(s + 4, !0), n != a);) s += _ + 8;return t.dataLen = _, t.dataOffset = s + 8, t;}}, D.SFBMAX = 3 * te.SBMAX_s, c.Mp3Encoder = function (a, e, t) {3 != arguments.length && (console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"), a = 1, e = 44100, t = 128);var s = new I(),n = new j(),_ = new r1(),r = new i1(),i = new A(),o = new k(),l = new F(),f = new P(),h = new R(),c = new K(),b = new B(),u = new E(),p = new G(),m = new z(),d = (s.setModules(_, r, i, o, l, f, h, c, m), r.setModules(_, m, h, f), c.setModules(r, h), i.setModules(s), l.setModules(r, b, o, u), o.setModules(u, b, s.enc.psy), b.setModules(r), u.setModules(o), f.setModules(s, r, h), n.setModules(p, m), p.setModules(h, c, i), s.lame_init()),g = (d.num_channels = a, d.in_samplerate = e, d.brate = t, d.mode = ee.STEREO, d.quality = 3, d.bWriteVbrTag = !1, d.disable_reservoir = !0, d.write_id3tag_automatic = !1, s.lame_init_params(d), 1152),v = 0 | 1.25 * g + 7200,S = new Int8Array(v);this.encodeBuffer = function (e, t) {return 1 == a && (t = e), e.length > g && (v = 0 | 1.25 * (g = e.length) + 7200, S = new Int8Array(v)), e = s.lame_encode_buffer(d, e, t, e.length, S, 0, v), new Int8Array(S.subarray(0, e));}, this.flush = function () {var e = s.lame_encode_flush(d, S, 0, v);return new Int8Array(S.subarray(0, e));};}, c.WavHeader = r;}e.window.lamejs = c, e.window.lamejs();}();

      var APP_STRINGS = {
        en: {
          title: "WAV/MP3 to MP3 Converter",
          input: "Select Audio Files (WAV or MP3)",
          output: "Output Bitrate",
          convert_to_mp3: "Convert to MP3",
          converting: "Converting...",
          converted: "Download the converted files",
        },
        es: {
          title: "Conversor de WAV/MP3 a MP3",
          input: "Seleccione archivos de audio (WAV o MP3)",
          output: "Bitrate de salida",
          convert_to_mp3: "Convertir a MP3",
          converting: "Convirtiendo...",
          converted: "Descargar archivos convertidos",
        },
      }

      var USER_LANG = window.navigator.language.substring(0, 2).toLowerCase()
      var GET_APP_STRING = APP_STRINGS[USER_LANG] || APP_STRINGS["en"]

      function t(stringName) {
        return GET_APP_STRING[stringName] || ""
      }

      window.addEventListener("load", function () {
        if (window.top === window.self) {
          var container = document.querySelector(".container")
          var pleaseWait = document.querySelector(".pleasewait")
          var audioFile = document.getElementById("audioFile")
          var audioFileGroup = document.getElementById("audioFileGroup")
          var bitrateSelect = document.getElementById("bitrate")
          var bitrateGroup = document.getElementById("bitrateGroup")
          var convertBtn = document.getElementById("convertBtn")
          var conversionStatus = document.getElementById("conversionStatus")
          var downloadLink = document.getElementById("downloadLink")
          var fileList = document.getElementById("fileList")
          var progress = document.getElementById("progress")
          var progressFill = document.getElementById("progressFill")
          var progressText = document.getElementById("progressText")
          var selectedFiles = []
          var convertedFiles = []

          pleaseWait.style.display = "none"
          container.style.display = "block"
          document.getElementsByTagName("body")[0].style.backgroundColor = "#f5f5f5"

          document.querySelector(".title").innerText = t("title")
          document.querySelector("#audioFileGroup label").innerText = t("input")
          document.querySelector("#bitrateGroup label").innerText = t("output")
          convertBtn.innerText = t("convert_to_mp3")
          conversionStatus.innerText = t("converting")

          audioFile.addEventListener("change", function (e) {
            var files = Array.from(e.target.files)
            if (files.length > 0) {
              selectedFiles = files

              fileList.innerHTML = ""
              files.forEach(function (file) {
                var sizeMB = (file.size / (1024 * 1024)).toFixed(2)
                var item = document.createElement("div")
                item.className = "file-item"
                item.id = "file-" + file.name.replace(/[^a-zA-Z0-9]/g, "_")
                item.innerHTML =
                  '<span class="file-name">' +
                  file.name +
                  '</span><span class="file-size">' +
                  sizeMB +
                  " MB</span>"
                fileList.appendChild(item)
              })
              fileList.style.display = "block"

              convertBtn.disabled = false
              downloadLink.style.display = "none"
            } else {
              selectedFiles = []
              fileList.innerHTML = ""
              convertBtn.disabled = true
            }
          })

          convertBtn.addEventListener("click", function () {
            if (selectedFiles.length === 0) {
              return
            }

            conversionStatus.style.display = "block"
            audioFileGroup.style.display = "none"
            bitrateGroup.style.display = "none"
            convertBtn.style.display = "none"
            convertedFiles = []
            progress.style.display = "block"
            progressFill.style.width = "0%"
            downloadLink.style.display = "none"

            processFilesSequentially(0)
          })

          function processFilesSequentially(index) {
            if (index >= selectedFiles.length) {
              conversionComplete()
              return
            }

            var file = selectedFiles[index]
            var fileId = "file-" + file.name.replace(/[^a-zA-Z0-9]/g, "_")
            var fileItem = document.getElementById(fileId)
            if (fileItem) {
              fileItem.className = "file-item processing"
            }

            var overallProgress = (index / selectedFiles.length) * 100
            progressFill.style.width = overallProgress + "%"
            progressText.innerText = file.name + " (0%)"

            var reader = new FileReader()
            reader.onload = function (e) {
              var arrayBuffer = e.target.result
              var audioContext = new (window.AudioContext ||
                window.webkitAudioContext)()

              audioContext.decodeAudioData(
                arrayBuffer,
                function (audioBuffer) {
                  var bitrate = parseInt(bitrateSelect.value)
                  encodeMP3(
                    audioBuffer,
                    bitrate,
                    function (encodeProgress) {
                      var fileProgress =
                        ((index + encodeProgress) / selectedFiles.length) * 100
                      progressFill.style.width = fileProgress + "%"
                      progressText.textContent =
                        file.name + " (" + Math.round(encodeProgress * 100) + "%)"
                    },
                    function (mp3Data) {
                      var blob = new Blob(mp3Data, { type: "audio/mpeg" })
                      var url = URL.createObjectURL(blob)
                      var originalName = file.name.replace(/\.(wav|mp3)$/i, "")

                      convertedFiles.push({
                        name: originalName + " (" + bitrate + " kbps).mp3",
                        url: url,
                        bitrate: bitrate,
                      })

                      if (fileItem) {
                        fileItem.className = "file-item completed"
                      }

                      processFilesSequentially(index + 1)
                    }
                  )
                },
                function (err) {
                  console.log(err)
                  if (fileItem) {
                    fileItem.className = "file-item error"
                  }
                  processFilesSequentially(index + 1)
                }
              )
            }

            reader.onerror = function () {
              if (fileItem) {
                fileItem.className = "file-item error"
              }
              processFilesSequentially(index + 1)
            }

            reader.readAsArrayBuffer(file)
          }

          function conversionComplete() {
            fileList.style.display = "none"
            progress.style.display = "none"
            conversionStatus.innerText = t("converted")

            var linksHTML = ""
            convertedFiles.forEach(function (f) {
              linksHTML =
                linksHTML +
                '<a href="' +
                f.url +
                '" download="' +
                f.name +
                '">' +
                f.name +
                "</a><br>"
            })
            downloadLink.innerHTML = linksHTML
            downloadLink.style.display = "block"
          }

          function encodeMP3(audioBuffer, bitrate, onProgress, onComplete) {
            var channels = audioBuffer.numberOfChannels
            var sampleRate = audioBuffer.sampleRate
            var mp3encoder = new lamejs.Mp3Encoder(channels, sampleRate, bitrate)
            var mp3Data = []

            var left = audioBuffer.getChannelData(0)
            var right = channels > 1 ? audioBuffer.getChannelData(1) : left

            var sampleBlockSize = 1152
            var chunksPerBatch = 100

            var leftInt16 = floatTo16BitPCM(left)
            var rightInt16 = floatTo16BitPCM(right)

            var totalSamples = leftInt16.length
            var currentIndex = 0

            function processChunk() {
              var batchEnd = Math.min(
                currentIndex + sampleBlockSize * chunksPerBatch,
                leftInt16.length
              )

              while (currentIndex < batchEnd) {
                var leftChunk = leftInt16.subarray(
                  currentIndex,
                  currentIndex + sampleBlockSize
                )
                var rightChunk = rightInt16.subarray(
                  currentIndex,
                  currentIndex + sampleBlockSize
                )
                var mp3buf

                if (channels === 1) {
                  mp3buf = mp3encoder.encodeBuffer(leftChunk)
                } else {
                  mp3buf = mp3encoder.encodeBuffer(leftChunk, rightChunk)
                }

                if (mp3buf.length > 0) {
                  mp3Data.push(mp3buf)
                }

                currentIndex = currentIndex + sampleBlockSize
              }

              if (onProgress) {
                onProgress(currentIndex / totalSamples)
              }

              if (currentIndex < leftInt16.length) {
                setTimeout(processChunk, 0)
              } else {
                var finalBuf = mp3encoder.flush()
                if (finalBuf.length > 0) {
                  mp3Data.push(finalBuf)
                }
                if (onProgress) {
                  onProgress(1)
                }
                onComplete(mp3Data)
              }
            }

            processChunk()
          }

          function floatTo16BitPCM(float32Array) {
            var int16Array = new Int16Array(float32Array.length)
            for (var i = 0; i < float32Array.length; i++) {
              var s = Math.max(-1, Math.min(1, float32Array[i]))
              int16Array[i] = s < 0 ? s * 0x8000 : s * 0x7fff
            }
            return int16Array
          }
        }
      })
    </script>
  </body>
</html>
